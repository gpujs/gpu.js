/**
 * gpu.js
 * http://gpu.rocks/
 *
 * GPU Accelerated JavaScript
 *
 * @version 1.4.3
 * @date Thu Jun 14 2018 10:52:52 GMT-0400 (EDT)
 *
 * @license MIT
 * The MIT License
 *
 * Copyright (c) 2018 gpu.js Team
 */
"use strict";!function(){function e(t,n,r){function i(a,o){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!o&&u)return u(a,!0);if(s)return s(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var s="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}return e}()({1:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=e("../function-builder-base"),o=e("./function-node");t.exports=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.Node=o,e}return s(t,e),t}(a)},{"../function-builder-base":6,"./function-node":2}],2:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../function-node-base"),u=e("../../core/utils");t.exports=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return s(t,e),a(t,[{key:"generate",value:function(){return this.debug&&console.log(this),this.functionStringArray=this.astGeneric(this.getJsAST(),[],this),this.functionString=this.functionStringArray.join("").trim(),this.functionString}},{key:"getFunctionPrototypeString",value:function(){return this.webGlFunctionPrototypeString?this.webGlFunctionPrototypeString:this.webGlFunctionPrototypeString=this.generate()}},{key:"astGeneric",value:function(e,t,n){if(null===e)throw this.astErrorOutput("NULL ast",e,n);if(Array.isArray(e)){for(var r=0;r<e.length;r++)this.astGeneric(e[r],t,n);return t}switch(e.type){case"FunctionDeclaration":return this.astFunctionDeclaration(e,t,n);case"FunctionExpression":return this.astFunctionExpression(e,t,n);case"ReturnStatement":return this.astReturnStatement(e,t,n);case"Literal":return this.astLiteral(e,t,n);case"BinaryExpression":return this.astBinaryExpression(e,t,n);case"Identifier":return this.astIdentifierExpression(e,t,n);case"AssignmentExpression":return this.astAssignmentExpression(e,t,n);case"ExpressionStatement":return this.astExpressionStatement(e,t,n);case"EmptyStatement":return this.astEmptyStatement(e,t,n);case"BlockStatement":return this.astBlockStatement(e,t,n);case"IfStatement":return this.astIfStatement(e,t,n);case"BreakStatement":return this.astBreakStatement(e,t,n);case"ContinueStatement":return this.astContinueStatement(e,t,n);case"ForStatement":return this.astForStatement(e,t,n);case"WhileStatement":return this.astWhileStatement(e,t,n);case"DoWhileStatement":return this.astDoWhileStatement(e,t,n);case"VariableDeclaration":return this.astVariableDeclaration(e,t,n);case"VariableDeclarator":return this.astVariableDeclarator(e,t,n);case"ThisExpression":return this.astThisExpression(e,t,n);case"SequenceExpression":return this.astSequenceExpression(e,t,n);case"UnaryExpression":return this.astUnaryExpression(e,t,n);case"UpdateExpression":return this.astUpdateExpression(e,t,n);case"LogicalExpression":return this.astLogicalExpression(e,t,n);case"MemberExpression":return this.astMemberExpression(e,t,n);case"CallExpression":return this.astCallExpression(e,t,n);case"ArrayExpression":return this.astArrayExpression(e,t,n);case"DebuggerStatement":return this.astDebuggerStatement(e,t,n)}throw this.astErrorOutput("Unknown ast type : "+e.type,e,n)}},{key:"astFunctionDeclaration",value:function(e,t,n){return this.addFunction&&this.addFunction(null,u.getAstString(this.jsFunctionString,e)),t}},{key:"astFunctionExpression",value:function(e,t,n){if(!n.isRootKernel){t.push("function"),n.kernalAst=e,t.push(" "),t.push(n.functionName),t.push("(");for(var r=0;r<n.paramNames.length;++r){var i=n.paramNames[r];r>0&&t.push(", "),t.push(" "),t.push("user_"),t.push(i)}t.push(") {\n")}for(var s=0;s<e.body.body.length;++s)this.astGeneric(e.body.body[s],t,n),t.push("\n");return n.isRootKernel||t.push("}\n"),t}},{key:"astReturnStatement",value:function(e,t,n){return n.isRootKernel?(t.push("kernelResult = "),this.astGeneric(e.argument,t,n),t.push(";")):n.isSubKernel?(t.push(n.functionName+"Result = "),this.astGeneric(e.argument,t,n),t.push(";"),t.push("return "+n.functionName+"Result;")):(t.push("return "),this.astGeneric(e.argument,t,n),t.push(";")),t}},{key:"astLiteral",value:function(e,t,n){if(isNaN(e.value))throw this.astErrorOutput("Non-numeric literal not supported : "+e.value,e,n);return t.push(e.value),t}},{key:"astBinaryExpression",value:function(e,t,n){return t.push("("),this.astGeneric(e.left,t,n),t.push(e.operator),this.astGeneric(e.right,t,n),t.push(")"),t}},{key:"astIdentifierExpression",value:function(e,t,n){if("Identifier"!==e.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",e,n);switch(e.name){case"gpu_threadX":t.push("threadId.x");break;case"gpu_threadY":t.push("threadId.y");break;case"gpu_threadZ":t.push("threadId.z");break;case"gpu_outputX":t.push("uOutputDim.x");break;case"gpu_outputY":t.push("uOutputDim.y");break;case"gpu_outputZ":t.push("uOutputDim.z");break;case"Infinity":t.push("Infinity");break;default:if(this.constants&&this.constants.hasOwnProperty(e.name))t.push("constants_"+e.name);else{var r=n.getUserParamName(e.name);null!==r?t.push("user_"+r):t.push("user_"+e.name)}}return t}},{key:"astForStatement",value:function(e,t,n){if("ForStatement"!==e.type)throw this.astErrorOutput("Invalid for statment",e,n);if(e.test&&"BinaryExpression"===e.test.type){if(("Identifier"===e.test.right.type||"Literal"===e.test.right.type)&&"<"===e.test.operator&&this.isIdentifierConstant(e.test.right.name)===!1){if(this.loopMaxIterations||(console.warn("Warning: loopMaxIterations is not set! Using default of 1000 which may result in unintended behavior."),console.warn("Set loopMaxIterations or use a for loop of fixed length to silence this message.")),t.push("for ("),this.astGeneric(e.init,t,n),";"!==t[t.length-1]&&t.push(";"),this.astGeneric(e.test.left,t,n),t.push(e.test.operator),t.push("LOOP_MAX"),t.push(";"),this.astGeneric(e.update,t,n),t.push(")"),t.push("{\n"),t.push("if ("),this.astGeneric(e.test.left,t,n),t.push(e.test.operator),this.astGeneric(e.test.right,t,n),t.push(") {\n"),"BlockStatement"===e.body.type)for(var r=0;r<e.body.body.length;r++)this.astGeneric(e.body.body[r],t,n);else this.astGeneric(e.body,t,n);return t.push("} else {\n"),t.push("break;\n"),t.push("}\n"),t.push("}\n"),t}if(e.init.declarations){var i=JSON.parse(JSON.stringify(e.init.declarations)),s=e.update.argument;if(!Array.isArray(i)||i.length<1)throw console.log(this.jsFunctionString),new Error("Error: Incompatible for loop declaration");if(i.length>1){for(var a=null,o=0;o<i.length;o++){var u=i[o];u.id.name===s.name?(a=u,i.splice(o,1)):(t.push("var "),this.astGeneric(u,t,n),t.push(";"))}t.push("for (let "),this.astGeneric(a,t,n),t.push(";")}else t.push("for ("),this.astGeneric(e.init,t,n);return this.astGeneric(e.test,t,n),t.push(";"),this.astGeneric(e.update,t,n),t.push(")"),this.astGeneric(e.body,t,n),t}}throw this.astErrorOutput("Invalid for statement",e,n)}},{key:"astWhileStatement",value:function(e,t,n){if("WhileStatement"!==e.type)throw this.astErrorOutput("Invalid while statment",e,n);return t.push("for (let i = 0; i < LOOP_MAX; i++) {"),t.push("if ("),this.astGeneric(e.test,t,n),t.push(") {\n"),this.astGeneric(e.body,t,n),t.push("} else {\n"),t.push("break;\n"),t.push("}\n"),t.push("}\n"),t}},{key:"astDoWhileStatement",value:function(e,t,n){if("DoWhileStatement"!==e.type)throw this.astErrorOutput("Invalid while statment",e,n);return t.push("for (let i = 0; i < LOOP_MAX; i++) {"),this.astGeneric(e.body,t,n),t.push("if (!"),this.astGeneric(e.test,t,n),t.push(") {\n"),t.push("break;\n"),t.push("}\n"),t.push("}\n"),t}},{key:"astAssignmentExpression",value:function(e,t,n){return this.astGeneric(e.left,t,n),t.push(e.operator),this.astGeneric(e.right,t,n),t}},{key:"astEmptyStatement",value:function(e,t,n){return t}},{key:"astBlockStatement",value:function(e,t,n){t.push("{\n");for(var r=0;r<e.body.length;r++)this.astGeneric(e.body[r],t,n);return t.push("}\n"),t}},{key:"astExpressionStatement",value:function(e,t,n){return this.astGeneric(e.expression,t,n),t.push(";\n"),t}},{key:"astVariableDeclaration",value:function(e,t,n){t.push("var ");for(var r=0;r<e.declarations.length;r++)r>0&&t.push(","),this.astGeneric(e.declarations[r],t,n);return t.push(";"),t}},{key:"astVariableDeclarator",value:function(e,t,n){return this.astGeneric(e.id,t,n),null!==e.init&&(t.push("="),this.astGeneric(e.init,t,n)),t}},{key:"astIfStatement",value:function(e,t,n){return t.push("if ("),this.astGeneric(e.test,t,n),t.push(")"),"BlockStatement"===e.consequent.type?this.astGeneric(e.consequent,t,n):(t.push(" {\n"),this.astGeneric(e.consequent,t,n),t.push("\n}\n")),e.alternate&&(t.push("else "),"BlockStatement"===e.alternate.type?this.astGeneric(e.alternate,t,n):(t.push(" {\n"),this.astGeneric(e.alternate,t,n),t.push("\n}\n"))),t}},{key:"astBreakStatement",value:function(e,t,n){return t.push("break;\n"),t}},{key:"astContinueStatement",value:function(e,t,n){return t.push("continue;\n"),t}},{key:"astLogicalExpression",value:function(e,t,n){return t.push("("),this.astGeneric(e.left,t,n),t.push(e.operator),this.astGeneric(e.right,t,n),t.push(")"),t}},{key:"astUpdateExpression",value:function(e,t,n){return e.prefix?(t.push(e.operator),this.astGeneric(e.argument,t,n)):(this.astGeneric(e.argument,t,n),t.push(e.operator)),t}},{key:"astUnaryExpression",value:function(e,t,n){return e.prefix?(t.push(e.operator),this.astGeneric(e.argument,t,n)):(this.astGeneric(e.argument,t,n),t.push(e.operator)),t}},{key:"astThisExpression",value:function(e,t,n){return t.push("_this"),t}},{key:"astMemberExpression",value:function(e,t,n){if(e.computed)if("Identifier"===e.object.type)this.astGeneric(e.object,t,n),t.push("["),this.astGeneric(e.property,t,n),t.push("]");else{this.astGeneric(e.object,t,n);var r=t.pop();t.push("]["),this.astGeneric(e.property,t,n),t.push(r)}else{var i=this.astMemberExpressionUnroll(e);switch("Identifier"===e.property.type&&e.computed&&(i="user_"+i),0===i.indexOf("this")&&(i="_"+i),i){case"_this.output.x":t.push(this.output[0]);break;case"_this.output.y":t.push(this.output[1]);break;case"_this.output.z":t.push(this.output[2]);break;default:t.push(i)}}return t}},{key:"astSequenceExpression",value:function(e,t,n){for(var r=0;r<e.expressions.length;r++)r>0&&t.push(","),this.astGeneric(e.expressions,t,n);return t}},{key:"astCallExpression",value:function(e,t,n){if(e.callee){var r=this.astMemberExpressionUnroll(e.callee);n.calledFunctions.indexOf(r)<0&&n.calledFunctions.push(r),n.hasOwnProperty("funcName")||(n.calledFunctionsArguments[r]=[]);var i=[];n.calledFunctionsArguments[r].push(i),t.push(r),t.push("(");for(var s=0;s<e.arguments.length;++s){var a=e.arguments[s];if(s>0&&t.push(", "),this.astGeneric(a,t,n),"Identifier"===a.type){var o=n.paramNames.indexOf(a.name);o===-1?i.push(null):i.push({name:a.name,type:n.paramTypes[o]})}else i.push(null)}return t.push(")"),t}throw this.astErrorOutput("Unknown CallExpression",e,n)}},{key:"astArrayExpression",value:function(e,t,n){var r=e.elements.length;t.push("new Float32Array(");for(var i=0;i<r;++i){i>0&&t.push(", ");var s=e.elements[i];this.astGeneric(s,t,n)}return t.push(")"),t}},{key:"astDebuggerStatement",value:function(e,t,n){return t.push("debugger;"),t}}],[{key:"astFunctionPrototype",value:function(e,t,n){if(n.isRootKernel||n.isSubKernel)return t;t.push(n.returnType),t.push(" "),t.push(n.functionName),t.push("(");for(var r=0;r<n.paramNames.length;++r)r>0&&t.push(", "),t.push(n.paramTypes[r]),t.push(" "),t.push("user_"),t.push(n.paramNames[r]);return t.push(");\n"),t}}]),t}(o)},{"../../core/utils":32,"../function-node-base":7}],3:[function(e,t,n){function r(e){return/^function /.test(e)&&(e=e.substring(9)),e.replace(/[_]typeof/g,"typeof")}function i(e){return e.replace(/[_]typeof/g,"typeof")}var s=e("../../core/utils"),a=e("../kernel-run-shortcut");t.exports=function(e,t){return"() => {\n    "+a.toString()+";\n    const utils = {\n      allPropertiesOf: "+i(s.allPropertiesOf.toString())+",\n      clone: "+i(s.clone.toString())+"\n    };\n    const Utils = utils;\n    class "+(t||"Kernel")+" {\n      constructor() {        \n        this.argumentsLength = 0;\n        this._canvas = null;\n        this._webGl = null;\n        this.built = false;\n        this.program = null;\n        this.paramNames = "+JSON.stringify(e.paramNames)+";\n        this.paramTypes = "+JSON.stringify(e.paramTypes)+";\n        this.texSize = "+JSON.stringify(e.texSize)+";\n        this.output = "+JSON.stringify(e.output)+";\n        this._kernelString = `"+e._kernelString+"`;\n        this.output = "+JSON.stringify(e.output)+";\n\t\t    this.run = function() {\n          this.run = null;\n          this.build();\n          return this.run.apply(this, arguments);\n        }.bind(this);\n        this.thread = {\n          x: 0,\n          y: 0,\n          z: 0\n        };\n      }\n      setCanvas(canvas) { this._canvas = canvas; return this; }\n      setWebGl(webGl) { this._webGl = webGl; return this; }\n      "+r(e.build.toString())+"\n      "+r(e.setupParams.toString())+"\n      run () { "+e.kernelString+" }\n      getKernelString() { return this._kernelString; }\n    };\n    return kernelRunShortcut(new Kernel());\n  };"}},{"../../core/utils":32,"../kernel-run-shortcut":9}],4:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../kernel-base"),u=e("../../core/utils"),h=e("./kernel-string");t.exports=function(e){function t(e,n){r(this,t);var s=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return s._fnBody=u.getFunctionBodyFromString(e),s._fn=null,s.run=null,s._canvasCtx=null,s._imageData=null,s._colorData=null,s._kernelString=null,s.thread={x:0,y:0,z:0},s.run=function(){return this.run=null,this.build.apply(this,arguments),this.run.apply(this,arguments)}.bind(s),s}return s(t,e),a(t,[{key:"validateOptions",value:function(){if(!this.output||0===this.output.length){if(1!==arguments.length)throw"Auto dimensions only supported for kernels with only one input";var e=u.getArgumentType(arguments[0]);if("Array"===e)this.output=u.getDimensions(e);else{if("Texture"!==e)throw"Auto dimensions not supported for input type: "+e;this.output=arguments[0].output}}}},{key:"build",value:function(){this.setupParams(arguments);for(var e=this.threadDim=u.clone(this.output);e.length<3;)e.push(1);if(this.graphical){var t=this.getCanvas();t.width=e[0],t.height=e[1],this._canvasCtx=t.getContext("2d"),this._imageData=this._canvasCtx.createImageData(e[0],e[1]),this._colorData=new Uint8ClampedArray(e[0]*e[1]*4)}var n=this.getKernelString();this.debug&&(console.log("Options:"),console.dir(this),console.log("Function output:"),console.log(n)),this.kernelString=n,this.run=new Function([],n).bind(this)()}},{key:"color",value:function(e,t,n,r){"undefined"==typeof r&&(r=1),e=Math.floor(255*e),t=Math.floor(255*t),n=Math.floor(255*n),r=Math.floor(255*r);var i=this.output[0],s=this.output[1],a=this.thread.x,o=s-this.thread.y-1,u=a+o*i;this._colorData[4*u+0]=e,this._colorData[4*u+1]=t,this._colorData[4*u+2]=n,this._colorData[4*u+3]=r}},{key:"getKernelString",value:function(){var e=this;if(null!==this._kernelString)return this._kernelString;for(var t=this.functionBuilder,n=this.threadDim||(this.threadDim=u.clone(this.output));n.length<3;)n.push(1);if(t.addKernel(this.fnString,{prototypeOnly:!1,constants:this.constants,output:this.output,debug:this.debug,loopMaxIterations:this.loopMaxIterations},this.paramNames,this.paramTypes),t.addFunctions(this.functions,{constants:this.constants,output:this.output}),null!==this.subKernels){this.subKernelOutputTextures=[],this.subKernelOutputVariableNames=[];for(var r=0;r<this.subKernels.length;r++){var i=this.subKernels[r];t.addSubKernel(i,{prototypeOnly:!1,constants:this.constants,output:this.output,debug:this.debug,loopMaxIterations:this.loopMaxIterations}),this.subKernelOutputVariableNames.push(i.name+"Result")}}else if(null!==this.subKernelProperties){this.subKernelOutputVariableNames=[];var s=0;for(var a in this.subKernelProperties)if(this.subKernelProperties.hasOwnProperty(a)){var o=this.subKernelProperties[a];t.addSubKernel(o),this.subKernelOutputVariableNames.push(o.name+"Result"),s++}}var h=t.getPrototypes(),l=null;h.length>1?h=h.filter(function(e){return/^function/.test(e)?e:(l=e,!1)}):l=h.shift();var p=this._kernelString="\n\t\tvar LOOP_MAX = "+this._getLoopMaxString()+";\n\t\tvar _this = this;\n  "+(null===this.subKernelOutputVariableNames?"":this.subKernelOutputVariableNames.map(function(e){return"  var "+e+" = null;\n"}).join(""))+"\n    return function ("+this.paramNames.map(function(e){return"user_"+e}).join(", ")+") {\n  "+this._processInputs()+"\n    var ret = new Array("+n[2]+");\n  "+(null===this.subKernelOutputVariableNames?"":this.subKernelOutputVariableNames.map(function(e){return"  "+e+"Z = new Array("+n[2]+");\n"}).join(""))+"\n    for (this.thread.z = 0; this.thread.z < "+n[2]+"; this.thread.z++) {\n      ret[this.thread.z] = new Array("+n[1]+");\n  "+(null===this.subKernelOutputVariableNames?"":this.subKernelOutputVariableNames.map(function(e){return"    "+e+"Z[this.thread.z] = new Array("+n[1]+");\n"}).join(""))+"\n      for (this.thread.y = 0; this.thread.y < "+n[1]+"; this.thread.y++) {\n        ret[this.thread.z][this.thread.y] = new Array("+n[0]+");\n  "+(null===this.subKernelOutputVariableNames?"":this.subKernelOutputVariableNames.map(function(e){return"      "+e+"Z[this.thread.z][this.thread.y] = new Array("+n[0]+");\n"}).join(""))+"\n        for (this.thread.x = 0; this.thread.x < "+n[0]+"; this.thread.x++) {\n          var kernelResult;\n          "+l+"\n          ret[this.thread.z][this.thread.y][this.thread.x] = kernelResult;\n"+(null===this.subKernelOutputVariableNames?"":this.subKernelOutputVariableNames.map(function(e){return"        "+e+"Z[this.thread.z][this.thread.y][this.thread.x] = "+e+";\n"}).join(""))+"\n          }\n        }\n      }\n      \n      if (this.graphical) {\n        this._imageData.data.set(this._colorData);\n        this._canvasCtx.putImageData(this._imageData, 0, 0);\n        return;\n      }\n      \n      if (this.output.length === 1) {\n        ret = ret[0][0];\n"+(null===this.subKernelOutputVariableNames?"":this.subKernelOutputVariableNames.map(function(e){return"    "+e+" = "+e+"Z[0][0];\n"}).join(""))+"\n      \n    } else if (this.output.length === 2) {\n      ret = ret[0];\n      "+(null===this.subKernelOutputVariableNames?"":this.subKernelOutputVariableNames.map(function(e){return"    "+e+" = "+e+"Z[0];\n"}).join(""))+"\n    }\n    \n    "+(null===this.subKernelOutputVariableNames?"return ret;\n":null!==this.subKernels?"var result = [\n        "+this.subKernelOutputVariableNames.map(function(e){return""+e}).join(",\n")+"\n      ];\n      result.result = ret;\n      return result;\n":"return {\n        result: ret,\n        "+Object.keys(this.subKernelProperties).map(function(t,n){return t+": "+e.subKernelOutputVariableNames[n]}).join(",\n")+"\n      };")+"\n    "+(h.length>0?h.join("\n"):"")+"\n    }.bind(this);";return p}},{key:"toString",value:function(){return h(this)}},{key:"precompileKernelObj",value:function(e){var t=this.threadDim||(this.threadDim=u.clone(this.output));return{threadDim:t}}},{key:"_getLoopMaxString",value:function(){return this.loopMaxIterations?" "+parseInt(this.loopMaxIterations)+";\n":" 1000;\n"}},{key:"_processInputs",value:function(){for(var e=[],t=0;t<this.paramTypes.length;t++)switch(this.paramTypes[t]){case"HTMLImage":e.push("  user_"+this.paramNames[t]+" = this._imageTo2DArray(user_"+this.paramNames[t]+")");break;case"HTMLImageArray":e.push("  user_"+this.paramNames[t]+" = this._imageTo3DArray(user_"+this.paramNames[t]+")")}return e.join(";\n")}},{key:"_imageTo2DArray",value:function(e){this._canvasCtx.drawImage(e,0,0,e.width,e.height);for(var t=this._canvasCtx.getImageData(0,0,e.width,e.height).data,n=new Array(e.height),r=0,i=e.height-1;i>=0;i--){n[i]=new Array(e.width);for(var s=0;s<e.width;s++)n[i][s]=[t[r++]/255,t[r++]/255,t[r++]/255,t[r++]/255]}return n}},{key:"_imageTo3DArray",value:function(e){for(var t=new Array(e.length),n=0;n<e.length;n++)t[n]=this._imageTo2DArray(e[n]);return t}}],[{key:"compileKernel",value:function(e){for(var t=e.threadDim;t.length<3;)t.push(1)}}]),t}(o)},{"../../core/utils":32,"../kernel-base":8,"./kernel-string":3}],5:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=(e("../../core/utils"),e("../runner-base")),u=e("./kernel"),h=e("./function-builder");t.exports=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,new h,e));return n.Kernel=u,n.kernel=null,n}return s(t,e),a(t,[{key:"getMode",value:function(){return"cpu"}}]),t}(o)},{"../../core/utils":32,"../runner-base":10,"./function-builder":1,"./kernel":4}],6:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.exports=function(){function e(t){r(this,e),this.nodeMap={},this.nativeFunctions={},this.gpu=t,this.rootKernel=null,this.Node=null}return i(e,[{key:"addNativeFunction",value:function(e,t){this.nativeFunctions[e]=t}},{key:"addFunction",value:function(e,t,n,r,i){this.addFunctionNode(new this.Node(e,t,n,r,i).setAddFunction(this.addFunction.bind(this)))}},{key:"addFunctions",value:function(e,t){if(e)if(Array.isArray(e))for(var n=0;n<e.length;n++)this.addFunction(null,e[n],t);else for(var r in e)this.addFunction(r,e[r],t)}},{key:"addNativeFunctions",value:function(e){for(var t in e)e.hasOwnProperty(t)&&this.addNativeFunction(t,e[t])}},{key:"addFunctionNode",value:function(e){this.nodeMap[e.functionName]=e,e.isRootKernel&&(this.rootKernel=e)}},{key:"traceFunctionCalls",value:function(e,t,n){e=e||"kernel",t=t||[];var r=this.nodeMap[e];if(r){var i=t.indexOf(e);if(i===-1){t.push(e),n&&(r.parent=n),r.getFunctionString();for(var s=0;s<r.calledFunctions.length;++s)this.traceFunctionCalls(r.calledFunctions[s],t,r)}else{var a=t.splice(i,1)[0];t.push(a)}}return this.nativeFunctions[e]&&(t.indexOf(e)>=0||t.push(e)),t}},{key:"addKernel",value:function(e,t,n,r){var i=new this.Node("kernel",e,t,r);return i.setAddFunction(this.addFunction.bind(this)),i.paramNames=n,i.paramTypes=r,i.isRootKernel=!0,this.addFunctionNode(i),i}},{key:"addSubKernel",value:function(e,t,n,r){var i=new this.Node(null,e,t,n,r);return i.setAddFunction(this.addFunction.bind(this)),i.isSubKernel=!0,this.addFunctionNode(i),i}},{key:"getPrototypeString",value:function(e){return this.getPrototypes(e).join("\n")}},{key:"getPrototypes",value:function(e){return this.rootKernel.generate(),e?this.getPrototypesFromFunctionNames(this.traceFunctionCalls(e,[]).reverse()):this.getPrototypesFromFunctionNames(Object.keys(this.nodeMap))}},{key:"getStringFromFunctionNames",value:function(e){for(var t=[],n=0;n<e.length;++n){var r=this.nodeMap[e[n]];r&&t.push(this.nodeMap[e[n]].getFunctionString())}return t.join("\n")}},{key:"getPrototypesFromFunctionNames",value:function(e,t){for(var n=[],r=0;r<e.length;++r){var i=e[r],s=this.nodeMap[i];s?n.push(s.getFunctionPrototypeString(t)):this.nativeFunctions[i]&&n.push(this.nativeFunctions[i])}return n}},{key:"getPrototypeStringFromFunctionNames",value:function(e,t){return this.getPrototypesFromFunctionNames(e,t).toString()}},{key:"getString",value:function(e,t){return void 0===t&&(t={}),e?this.getStringFromFunctionNames(this.traceFunctionCalls(e,[],t).reverse(),t):this.getStringFromFunctionNames(Object.keys(this.nodeMap),t)}}]),e}()},{}],7:[function(require,module,exports){function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),utils=require("../core/utils"),acorn=require("acorn");module.exports=function(){function BaseFunctionNode(e,t,n,r,i){if(_classCallCheck(this,BaseFunctionNode),this.calledFunctions=[],this.calledFunctionsArguments={},this.addFunction=null,this.isRootKernel=!1,this.isSubKernel=!1,this.parent=null,this.debug=null,this.prototypeOnly=null,this.constants=null,this.output=null,this.declarations={},n&&(n.hasOwnProperty("debug")&&(this.debug=n.debug),n.hasOwnProperty("prototypeOnly")&&(this.prototypeOnly=n.prototypeOnly),n.hasOwnProperty("constants")&&(this.constants=n.constants),n.hasOwnProperty("output")&&(this.output=n.output),n.hasOwnProperty("loopMaxIterations")&&(this.loopMaxIterations=n.loopMaxIterations)),!t)throw"jsFunction, parameter is missing";if(this.jsFunctionString=t.toString(),!utils.isFunctionString(this.jsFunctionString))throw console.error("jsFunction, to string conversion check failed: not a function?",this.jsFunctionString),"jsFunction, to string conversion check failed: not a function?";if(utils.isFunction(t)?this.jsFunction=t:this.jsFunction=null,this.functionName=e||t&&t.name||utils.getFunctionNameFromString(this.jsFunctionString),!this.functionName)throw"jsFunction, missing name argument or value";if(this.paramNames=utils.getParamNamesFromString(this.jsFunctionString),r){if(Array.isArray(r)){if(r.length!==this.paramNames.length)throw"Invalid argument type array length, against function length -> ("+r.length+","+this.paramNames.length+")";this.paramTypes=r}else if("object"===("undefined"==typeof r?"undefined":_typeof(r))){var s=Object.keys(r);if(r.hasOwnProperty("returns")&&(this.returnType=r.returns,s.splice(s.indexOf("returns"),1)),s.length>0&&s.length!==this.paramNames.length)throw"Invalid argument type array length, against function length -> ("+s.length+","+this.paramNames.length+")";this.paramTypes=this.paramNames.map(function(e){return r.hasOwnProperty(e)?r[e]:"float"})}}else this.paramTypes=[];this.returnType||(this.returnType=i||"float")}return _createClass(BaseFunctionNode,[{key:"isIdentifierConstant",value:function(e){return!!this.constants&&this.constants.hasOwnProperty(e)}},{key:"setAddFunction",value:function(e){return this.addFunction=e,this}},{key:"getJsFunction",value:function getJsFunction(){if(this.jsFunction)return this.jsFunction;if(this.jsFunctionString)return this.jsFunction=eval(this.jsFunctionString),this.jsFunction;throw"Missing jsFunction, and jsFunctionString parameter"}},{key:"astMemberExpressionUnroll",value:function(e,t){if("Identifier"===e.type)return e.name;if("ThisExpression"===e.type)return"this";if("MemberExpression"===e.type&&e.object&&e.property)return e.object.hasOwnProperty("name")&&"_"===e.object.name[0]?this.astMemberExpressionUnroll(e.property,t):this.astMemberExpressionUnroll(e.object,t)+"."+this.astMemberExpressionUnroll(e.property,t);if(e.hasOwnProperty("expressions")){var n=e.expressions[0];if("Literal"===n.type&&0===n.value&&2===e.expressions.length)return this.astMemberExpressionUnroll(e.expressions[1])}throw this.astErrorOutput("Unknown CallExpression_unroll",e,t)}},{key:"getJsAST",value:function(e){if(this.jsFunctionAST)return this.jsFunctionAST;if(e=e||acorn,null===e)throw"Missing JS to AST parser";var t=e.parse("var "+this.functionName+" = "+this.jsFunctionString+";",{locations:!0});if(null===t)throw"Failed to parse JS code";var n=t.body[0].declarations[0].init;return this.jsFunctionAST=n,n}},{key:"getFunctionString",value:function(){return this.generate(),this.functionString}},{key:"setFunctionString",value:function(e){this.functionString=e}},{key:"getParamType",value:function(e){var t=this.paramNames.indexOf(e);if(t===-1)return this.declarations.hasOwnProperty(e)?this.declarations[e]:null;if(this.parent){if(this.paramTypes[t])return this.paramTypes[t];for(var n=this.parent.calledFunctionsArguments[this.functionName],r=0;r<n.length;r++){var i=n[r];if(null!==i[t])return this.paramTypes[t]=i[t].type}}else if(this.paramTypes[t])return this.paramTypes[t];return null}},{key:"getUserParamName",value:function(e){var t=this.paramNames.indexOf(e);if(t===-1)return null;if(!this.parent)return null;for(var n=this.parent.calledFunctionsArguments[this.functionName],r=0;r<n.length;r++){var i=n[r],s=i[t];if(null!==s&&"Integer"!==s.type)return s.name}return null}},{key:"generate",value:function(e){throw new Error("generate not defined on BaseFunctionNode")}},{key:"astErrorOutput",value:function(e,t,n){return console.error(utils.getAstString(this.jsFunctionString,t)),console.error(e,t,n),e}},{key:"astDebuggerStatement",value:function(e,t,n){return t}}]),BaseFunctionNode}()},{"../core/utils":32,acorn:34}],8:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function");
}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../core/utils");t.exports=function(){function e(t,n){r(this,e),this.paramNames=s.getParamNamesFromString(t),this.fnString=t,this.output=null,this.debug=!1,this.graphical=!1,this.loopMaxIterations=0,this.constants=null,this.wraparound=null,this.hardcodeConstants=null,this.outputToTexture=null,this.outputImmutable=null,this.texSize=null,this._canvas=null,this._webGl=null,this.threadDim=null,this.floatTextures=null,this.floatOutput=null,this.floatOutputForce=null,this.addFunction=null,this.functions=null,this.nativeFunctions=null,this.subKernels=null,this.subKernelProperties=null,this.subKernelNames=null,this.subKernelOutputVariableNames=null,this.functionBuilder=null,this.paramTypes=null;for(var i in n)n.hasOwnProperty(i)&&this.hasOwnProperty(i)&&(this[i]=n[i]);n.hasOwnProperty("canvas")&&(this._canvas=n.canvas),n.hasOwnProperty("output")&&this.setOutput(n.output),this._canvas||(this._canvas=s.initCanvas())}return i(e,[{key:"build",value:function(){throw new Error('"build" not defined on Base')}},{key:"setupParams",value:function(e){for(var t=this.paramTypes=[],n=0;n<e.length;n++){var r=e[n],i=s.getArgumentType(r);t.push(i)}}},{key:"setAddFunction",value:function(e){return this.addFunction=e,this}},{key:"setFunctions",value:function(e){return this.functions=e,this}},{key:"setOutput",value:function(e){return e.hasOwnProperty("x")?e.hasOwnProperty("y")?e.hasOwnProperty("z")?this.output=[e.x,e.y,e.z]:this.output=[e.x,e.y]:this.output=[e.x]:this.output=e,this}},{key:"setDebug",value:function(e){return this.debug=e,this}},{key:"setGraphical",value:function(e){return this.graphical=e,this}},{key:"setLoopMaxIterations",value:function(e){return this.loopMaxIterations=e,this}},{key:"setConstants",value:function(e){return this.constants=e,this}},{key:"setWraparound",value:function(e){return console.warn("Wraparound mode is not supported and undocumented."),this.wraparound=e,this}},{key:"setHardcodeConstants",value:function(e){return this.hardcodeConstants=e,this}},{key:"setOutputToTexture",value:function(e){return this.outputToTexture=e,this}},{key:"setOutputImmutable",value:function(e){return this.outputImmutable=e,this}},{key:"setFloatTextures",value:function(e){return this.floatTextures=e,this}},{key:"setFloatOutput",value:function(e){return this.floatOutput=e,this}},{key:"setFloatOutputForce",value:function(e){return this.floatOutputForce=e,this}},{key:"setCanvas",value:function(e){return this._canvas=e,this}},{key:"setWebGl",value:function(e){return this._webGl=e,this}},{key:"getCanvas",value:function(){return this._canvas}},{key:"getWebGl",value:function(){return this._webGl}},{key:"validateOptions",value:function(){throw new Error("validateOptions not defined")}},{key:"exec",value:function(){return this.execute.apply(this,arguments)}},{key:"execute",value:function(){var e=this,t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);return s.newPromise(function(n,r){try{n(e.run.apply(e,t))}catch(i){r(i)}})}},{key:"addSubKernel",value:function(e){return null===this.subKernels&&(this.subKernels=[],this.subKernelNames=[]),this.subKernels.push(e),this.subKernelNames.push(s.getFunctionNameFromString(e)),this}},{key:"addSubKernelProperty",value:function(e,t){if(null===this.subKernelProperties&&(this.subKernelProperties={},this.subKernelNames=[]),this.subKernelProperties.hasOwnProperty(e))throw new Error("cannot add sub kernel "+e+", already defined");return this.subKernelProperties[e]=t,this.subKernelNames.push(s.getFunctionNameFromString(t)),this}},{key:"addNativeFunction",value:function(e,t){this.functionBuilder.addNativeFunction(e,t)}}]),e}()},{"../core/utils":32}],9:[function(e,t,n){var r=e("../core/utils");t.exports=function(e){var t=function(){return e.run.apply(e,arguments)};return r.allPropertiesOf(e).forEach(function(n){"_"===n[0]&&"_"===n[1]||("function"==typeof e[n]?"add"===n.substring(0,3)||"set"===n.substring(0,3)?t[n]=function(){return e[n].apply(e,arguments),t}:t[n]=e[n].bind(e):(t.__defineGetter__(n,function(){return e[n]}),t.__defineSetter__(n,function(t){e[n]=t})))}),t.kernel=e,t}},{"../core/utils":32}],10:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../core/utils"),a=e("./kernel-run-shortcut");t.exports=function(){function e(t,n){r(this,e),n=n||{},this.kernel=n.kernel,this.canvas=n.canvas,this.webGl=n.webGl,this.fn=null,this.functionBuilder=t,this.fnString=null,this.endianness=s.systemEndianness()}return i(e,[{key:"textureToArray",value:function(e){var t=this.createKernel(function(e){return e[this.thread.z][this.thread.y][this.thread.x]});return t(e)}},{key:"deleteTexture",value:function(e){this.webGl.deleteTexture(e.texture)}},{key:"buildPromiseKernel",value:function(){throw new Error("not yet implemented")}},{key:"getMode",value:function(){throw new Error('"mode" not implemented on BaseRunner')}},{key:"buildKernel",value:function(e,t){t=Object.assign({},t||{});var n=e.toString();return t.functionBuilder||(t.functionBuilder=this.functionBuilder),t.canvas||(t.canvas=this.canvas),t.webGl||(t.webGl=this.webgl),a(new this.Kernel(n,t))}}]),e}()},{"../core/utils":32,"./kernel-run-shortcut":9}],11:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){return Math.floor(e+.5)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("../function-builder-base"),h=e("./function-node");t.exports=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.Node=h,e}return s(t,e),o(t,[{key:"polyfillStandardFunctions",value:function(){this.addFunction("round",a)}}],[{key:"round",value:function(e){return a(e)}}]),t}(u)},{"../function-builder-base":6,"./function-node":12}],12:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){return e.replace(f,"((").replace(d,"((")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("../function-node-base"),h=e("../../core/utils"),l="Math.",p="this.",c="this.constants.",f=/decode32\(\s+encode32\(/g,d=/encode32\(\s+decode32\(/g;t.exports=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return s(t,e),o(t,[{key:"generate",value:function(){return this.debug&&console.log(this),this.prototypeOnly?t.astFunctionPrototype(this.getJsAST(),[],this).join("").trim():(this.functionStringArray=this.astGeneric(this.getJsAST(),[],this),this.functionString=a(this.functionStringArray.join("").trim()),this.functionString)}},{key:"astGeneric",value:function(e,t,n){if(null===e)throw this.astErrorOutput("NULL ast",e,n);if(Array.isArray(e)){for(var r=0;r<e.length;r++)this.astGeneric(e[r],t,n);return t}switch(e.type){case"FunctionDeclaration":return this.astFunctionDeclaration(e,t,n);case"FunctionExpression":return this.astFunctionExpression(e,t,n);case"ReturnStatement":return this.astReturnStatement(e,t,n);case"Literal":return this.astLiteral(e,t,n);case"BinaryExpression":return this.astBinaryExpression(e,t,n);case"Identifier":return this.astIdentifierExpression(e,t,n);case"AssignmentExpression":return this.astAssignmentExpression(e,t,n);case"ExpressionStatement":return this.astExpressionStatement(e,t,n);case"EmptyStatement":return this.astEmptyStatement(e,t,n);case"BlockStatement":return this.astBlockStatement(e,t,n);case"IfStatement":return this.astIfStatement(e,t,n);case"BreakStatement":return this.astBreakStatement(e,t,n);case"ContinueStatement":return this.astContinueStatement(e,t,n);case"ForStatement":return this.astForStatement(e,t,n);case"WhileStatement":return this.astWhileStatement(e,t,n);case"DoWhileStatement":return this.astDoWhileStatement(e,t,n);case"VariableDeclaration":return this.astVariableDeclaration(e,t,n);case"VariableDeclarator":return this.astVariableDeclarator(e,t,n);case"ThisExpression":return this.astThisExpression(e,t,n);case"SequenceExpression":return this.astSequenceExpression(e,t,n);case"UnaryExpression":return this.astUnaryExpression(e,t,n);case"UpdateExpression":return this.astUpdateExpression(e,t,n);case"LogicalExpression":return this.astLogicalExpression(e,t,n);case"MemberExpression":return this.astMemberExpression(e,t,n);case"CallExpression":return this.astCallExpression(e,t,n);case"ArrayExpression":return this.astArrayExpression(e,t,n);case"DebuggerStatement":return this.astDebuggerStatement(e,t,n)}throw this.astErrorOutput("Unknown ast type : "+e.type,e,n)}},{key:"astFunctionDeclaration",value:function(e,t,n){return this.addFunction&&this.addFunction(null,h.getAstString(this.jsFunctionString,e)),t}},{key:"astFunctionExpression",value:function(e,t,n){if(n.isRootKernel?(t.push("void"),n.kernalAst=e):t.push(n.returnType),t.push(" "),t.push(n.functionName),t.push("("),!n.isRootKernel)for(var r=0;r<n.paramNames.length;++r){var i=n.paramNames[r];r>0&&t.push(", ");var s=n.getParamType(i);switch(s){case"Texture":case"Input":case"Array":t.push("sampler2D");break;default:t.push("float")}t.push(" "),t.push("user_"),t.push(i)}t.push(") {\n");for(var a=0;a<e.body.body.length;++a)this.astGeneric(e.body.body[a],t,n),t.push("\n");return t.push("}\n"),t}},{key:"astReturnStatement",value:function(e,t,n){return n.isRootKernel?(t.push("kernelResult = "),this.astGeneric(e.argument,t,n),t.push(";"),t.push("return;")):n.isSubKernel?(t.push(n.functionName+"Result = "),this.astGeneric(e.argument,t,n),t.push(";"),t.push("return "+n.functionName+"Result;")):(t.push("return "),this.astGeneric(e.argument,t,n),t.push(";")),t}},{key:"astLiteral",value:function(e,t,n){if(isNaN(e.value))throw this.astErrorOutput("Non-numeric literal not supported : "+e.value,e,n);return t.push(e.value),Number.isInteger(e.value)&&t.push(".0"),t}},{key:"astBinaryExpression",value:function(e,t,n){return t.push("("),"%"===e.operator?(t.push("mod("),this.astGeneric(e.left,t,n),t.push(","),this.astGeneric(e.right,t,n),t.push(")")):"==="===e.operator?(this.astGeneric(e.left,t,n),t.push("=="),this.astGeneric(e.right,t,n)):"!=="===e.operator?(this.astGeneric(e.left,t,n),t.push("!="),this.astGeneric(e.right,t,n)):(this.astGeneric(e.left,t,n),t.push(e.operator),this.astGeneric(e.right,t,n)),t.push(")"),t}},{key:"astIdentifierExpression",value:function(e,t,n){if("Identifier"!==e.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",e,n);switch(e.name){case"gpu_threadX":t.push("threadId.x");break;case"gpu_threadY":t.push("threadId.y");break;case"gpu_threadZ":t.push("threadId.z");break;case"gpu_outputX":t.push("uOutputDim.x");break;case"gpu_outputY":t.push("uOutputDim.y");break;case"gpu_outputZ":t.push("uOutputDim.z");break;case"Infinity":t.push("3.402823466e+38");break;default:if(this.constants&&this.constants.hasOwnProperty(e.name))t.push("constants_"+e.name);else{var r=n.getUserParamName(e.name);null!==r?t.push("user_"+r):t.push("user_"+e.name)}}return t}},{key:"astForStatement",value:function(e,t,n){if("ForStatement"!==e.type)throw this.astErrorOutput("Invalid for statment",e,n);if(e.test&&"BinaryExpression"===e.test.type){if("Identifier"===e.test.right.type&&"<"===e.test.operator&&this.isIdentifierConstant(e.test.right.name)===!1){if(this.loopMaxIterations||(console.warn("Warning: loopMaxIterations is not set! Using default of 1000 which may result in unintended behavior."),console.warn("Set loopMaxIterations or use a for loop of fixed length to silence this message.")),t.push("for ("),this.astGeneric(e.init,t,n),this.astGeneric(e.test.left,t,n),t.push(e.test.operator),t.push("LOOP_MAX"),t.push(";"),this.astGeneric(e.update,t,n),t.push(")"),t.push("{\n"),t.push("if ("),this.astGeneric(e.test.left,t,n),t.push(e.test.operator),this.astGeneric(e.test.right,t,n),t.push(") {\n"),"BlockStatement"===e.body.type)for(var r=0;r<e.body.body.length;r++)this.astGeneric(e.body.body[r],t,n);else this.astGeneric(e.body,t,n);return t.push("} else {\n"),t.push("break;\n"),t.push("}\n"),t.push("}\n"),t}var i=JSON.parse(JSON.stringify(e.init.declarations)),s=e.update.argument;if(!Array.isArray(i)||i.length<1)throw console.log(this.jsFunctionString),new Error("Error: Incompatible for loop declaration");if(i.length>1){for(var a=null,o=0;o<i.length;o++){var u=i[o];u.id.name===s.name?(a=u,i.splice(o,1)):(t.push("float "),this.astGeneric(u,t,n),t.push(";"))}t.push("for (float "),this.astGeneric(a,t,n),t.push(";")}else t.push("for ("),this.astGeneric(e.init,t,n);return this.astGeneric(e.test,t,n),t.push(";"),this.astGeneric(e.update,t,n),t.push(")"),this.astGeneric(e.body,t,n),t}throw this.astErrorOutput("Invalid for statement",e,n)}},{key:"astWhileStatement",value:function(e,t,n){if("WhileStatement"!==e.type)throw this.astErrorOutput("Invalid while statment",e,n);return t.push("for (float i = 0.0; i < LOOP_MAX; i++) {"),t.push("if ("),this.astGeneric(e.test,t,n),t.push(") {\n"),this.astGeneric(e.body,t,n),t.push("} else {\n"),t.push("break;\n"),t.push("}\n"),t.push("}\n"),t}},{key:"astDoWhileStatement",value:function(e,t,n){if("DoWhileStatement"!==e.type)throw this.astErrorOutput("Invalid while statment",e,n);return t.push("for (float i = 0.0; i < LOOP_MAX; i++) {"),this.astGeneric(e.body,t,n),t.push("if (!"),this.astGeneric(e.test,t,n),t.push(") {\n"),t.push("break;\n"),t.push("}\n"),t.push("}\n"),t}},{key:"astAssignmentExpression",value:function(e,t,n){return"%="!==e.operator?(this.astGeneric(e.left,t,n),t.push(e.operator),this.astGeneric(e.right,t,n),t):(this.astGeneric(e.left,t,n),t.push("="),t.push("mod("),this.astGeneric(e.left,t,n),t.push(","),this.astGeneric(e.right,t,n),t.push(")"),void 0)}},{key:"astEmptyStatement",value:function(e,t,n){return t}},{key:"astBlockStatement",value:function(e,t,n){t.push("{\n");for(var r=0;r<e.body.length;r++)this.astGeneric(e.body[r],t,n);return t.push("}\n"),t}},{key:"astExpressionStatement",value:function(e,t,n){return this.astGeneric(e.expression,t,n),t.push(";\n"),t}},{key:"astVariableDeclaration",value:function(e,t,n){for(var r=0;r<e.declarations.length;r++){var i=e.declarations[r];r>0&&t.push(",");var s=[];this.astGeneric(i,s,n),"getImage2D("===s[2]||"getImage3D("===s[2]?(0===r&&t.push("vec4 "),this.declarations[i.id.name]="vec4"):(0===r&&t.push("float "),this.declarations[i.id.name]="float"),t.push.apply(t,s)}return t.push(";"),t}},{key:"astVariableDeclarator",value:function(e,t,n){return this.astGeneric(e.id,t,n),null!==e.init&&(t.push("="),this.astGeneric(e.init,t,n)),t}},{key:"astIfStatement",value:function(e,t,n){return t.push("if ("),this.astGeneric(e.test,t,n),t.push(")"),"BlockStatement"===e.consequent.type?this.astGeneric(e.consequent,t,n):(t.push(" {\n"),this.astGeneric(e.consequent,t,n),t.push("\n}\n")),e.alternate&&(t.push("else "),"BlockStatement"===e.alternate.type?this.astGeneric(e.alternate,t,n):(t.push(" {\n"),this.astGeneric(e.alternate,t,n),t.push("\n}\n"))),t}},{key:"astBreakStatement",value:function(e,t,n){return t.push("break;\n"),t}},{key:"astContinueStatement",value:function(e,t,n){return t.push("continue;\n"),t}},{key:"astLogicalExpression",value:function(e,t,n){return t.push("("),this.astGeneric(e.left,t,n),t.push(e.operator),this.astGeneric(e.right,t,n),t.push(")"),t}},{key:"astUpdateExpression",value:function(e,t,n){return e.prefix?(t.push(e.operator),this.astGeneric(e.argument,t,n)):(this.astGeneric(e.argument,t,n),t.push(e.operator)),t}},{key:"astUnaryExpression",value:function(e,t,n){return e.prefix?(t.push(e.operator),this.astGeneric(e.argument,t,n)):(this.astGeneric(e.argument,t,n),t.push(e.operator)),t}},{key:"astThisExpression",value:function(e,t,n){return t.push("this"),t}},{key:"astMemberExpression",value:function(e,t,n){if(e.computed)if("Identifier"===e.object.type){var r=e.object.name,i=(n.functionName||"kernel",!1);if(n.paramNames){var s=n.paramNames.indexOf(r);s>=0&&"float"===n.paramTypes[s]&&(i=!0)}if(i)this.astGeneric(e.object,t,n),t.push("[int("),this.astGeneric(e.property,t,n),t.push(")]");else switch(n.getParamType(e.object.name)){case"vec4":this.astGeneric(e.object,t,n),t.push("["),t.push(e.property.raw),t.push("]");break;case"HTMLImageArray":t.push("getImage3D("),this.astGeneric(e.object,t,n),t.push(", vec2("),this.astGeneric(e.object,t,n),t.push("Size[0],"),this.astGeneric(e.object,t,n),t.push("Size[1]), vec3("),this.astGeneric(e.object,t,n),t.push("Dim[0],"),this.astGeneric(e.object,t,n),t.push("Dim[1],"),this.astGeneric(e.object,t,n),t.push("Dim[2]"),t.push("), "),this.astGeneric(e.property,t,n),t.push(")");break;case"HTMLImage":t.push("getImage2D("),this.astGeneric(e.object,t,n),t.push(", vec2("),this.astGeneric(e.object,t,n),t.push("Size[0],"),this.astGeneric(e.object,t,n),t.push("Size[1]), vec3("),this.astGeneric(e.object,t,n),t.push("Dim[0],"),this.astGeneric(e.object,t,n),t.push("Dim[1],"),this.astGeneric(e.object,t,n),t.push("Dim[2]"),t.push("), "),this.astGeneric(e.property,t,n),t.push(")");break;default:t.push("get("),this.astGeneric(e.object,t,n),t.push(", vec2("),this.astGeneric(e.object,t,n),t.push("Size[0],"),this.astGeneric(e.object,t,n),t.push("Size[1]), vec3("),this.astGeneric(e.object,t,n),t.push("Dim[0],"),this.astGeneric(e.object,t,n),t.push("Dim[1],"),this.astGeneric(e.object,t,n),t.push("Dim[2]"),t.push("), "),this.astGeneric(e.property,t,n),t.push(")")}}else{this.astGeneric(e.object,t,n);var a=t.pop();t.push(","),this.astGeneric(e.property,t,n),t.push(a)}else{var o=this.astMemberExpressionUnroll(e),u=o.toLowerCase();switch(0===o.indexOf(c)&&(o="constants_"+o.slice(c.length)),u){case"this.thread.x":t.push("threadId.x");break;case"this.thread.y":t.push("threadId.y");break;case"this.thread.z":t.push("threadId.z");break;case"this.output.x":t.push(this.output[0]+".0");break;case"this.output.y":t.push(this.output[1]+".0");break;case"this.output.z":t.push(this.output[2]+".0");break;default:t.push(o)}}return t}},{key:"astSequenceExpression",value:function(e,t,n){for(var r=0;r<e.expressions.length;r++)r>0&&t.push(","),this.astGeneric(e.expressions,t,n);return t}},{key:"astCallExpression",value:function(e,t,n){if(e.callee){var r=this.astMemberExpressionUnroll(e.callee);0===r.indexOf(l)&&(r=r.slice(l.length)),0===r.indexOf(p)&&(r=r.slice(p.length)),"atan2"===r&&(r="atan"),n.calledFunctions.indexOf(r)<0&&n.calledFunctions.push(r),n.hasOwnProperty("funcName")||(n.calledFunctionsArguments[r]=[]);var i=[];n.calledFunctionsArguments[r].push(i),t.push(r),t.push("(");for(var s=0;s<e.arguments.length;++s){var a=e.arguments[s];if(s>0&&t.push(", "),this.astGeneric(a,t,n),"Identifier"===a.type){var o=n.paramNames.indexOf(a.name);o===-1?i.push(null):i.push({name:a.name,type:n.paramTypes[o]})}else i.push(null)}return t.push(")"),t}throw this.astErrorOutput("Unknown CallExpression",e,n)}},{key:"astArrayExpression",value:function(e,t,n){var r=e.elements.length;t.push("float["+r+"](");for(var i=0;i<r;++i){i>0&&t.push(", ");var s=e.elements[i];this.astGeneric(s,t,n)}return t.push(")"),t}},{key:"getFunctionPrototypeString",value:function(){return this.webGlFunctionPrototypeString?this.webGlFunctionPrototypeString:this.webGlFunctionPrototypeString=this.generate()}},{key:"build",value:function(){return this.getFunctionPrototypeString().length>0}}],[{key:"astFunctionPrototype",value:function(e,t,n){if(n.isRootKernel||n.isSubKernel)return t;t.push(n.returnType),t.push(" "),t.push(n.functionName),t.push("(");for(var r=0;r<n.paramNames.length;++r)r>0&&t.push(", "),t.push(n.paramTypes[r]),t.push(" "),t.push("user_"),t.push(n.paramNames[r]);return t.push(");\n"),t}}]),t}(u)},{"../../core/utils":32,"../function-node-base":7}],13:[function(e,t,n){function r(e){return/^function /.test(e)&&(e=e.substring(9)),e.replace(/[_]typeof/g,"typeof")}function i(e){return e.replace(/[_]typeof/g,"typeof")}var s=e("../../core/utils"),a=e("../kernel-run-shortcut");t.exports=function(e,t){return"() => {\n    "+a.toString()+";\n    const utils = {\n      allPropertiesOf: "+i(s.allPropertiesOf.toString())+",\n      clone: "+i(s.clone.toString())+",\n      splitArray: "+i(s.splitArray.toString())+",\n      getArgumentType: "+i(s.getArgumentType.toString())+",\n      getDimensions: "+i(s.getDimensions.toString())+",\n      dimToTexSize: "+i(s.dimToTexSize.toString())+",\n      flattenTo: "+i(s.flattenTo.toString())+",\n      flatten2dArrayTo: "+i(s.flatten2dArrayTo.toString())+",\n      flatten3dArrayTo: "+i(s.flatten3dArrayTo.toString())+",\n      systemEndianness: '"+i(s.systemEndianness())+"',\n      initWebGl: "+i(s.initWebGl.toString())+",\n      isArray: "+i(s.isArray.toString())+"\n    };\n    const Utils = utils;\n    const canvases = [];\n    const maxTexSizes = {};\n    class "+(t||"Kernel")+" {\n      constructor() {\n        this.maxTexSize = null;\n        this.argumentsLength = 0;\n        this._canvas = null;\n        this._webGl = null;\n        this.built = false;\n        this.program = null;\n        this.paramNames = "+JSON.stringify(e.paramNames)+";\n        this.paramTypes = "+JSON.stringify(e.paramTypes)+";\n        this.texSize = "+JSON.stringify(e.texSize)+";\n        this.output = "+JSON.stringify(e.output)+";\n        this.compiledFragShaderString = `"+e.compiledFragShaderString+"`;\n\t\t    this.compiledVertShaderString = `"+e.compiledVertShaderString+"`;\n\t\t    this.programUniformLocationCache = {};\n\t\t    this.textureCache = {};\n\t\t    this.subKernelOutputTextures = null;\n\t\t    this.subKernelOutputVariableNames = null;\n\t\t    this.uniform1fCache = {};\n\t\t    this.uniform1iCache = {};\n\t\t    this.uniform2fCache = {};\n\t\t    this.uniform2fvCache = {};\n\t\t    this.uniform3fvCache = {};\n      }\n      "+r(e._getFragShaderString.toString())+"\n      "+r(e._getVertShaderString.toString())+"\n      validateOptions() {}\n      setupParams() {}\n      setCanvas(canvas) { this._canvas = canvas; return this; }\n      setWebGl(webGl) { this._webGl = webGl; return this; }\n      "+r(e.getUniformLocation.toString())+"\n      "+r(e.setupParams.toString())+"\n      "+r(e.build.toString())+"\n\t\t  "+r(e.run.toString())+"\n\t\t  "+r(e._addArgument.toString())+"\n\t\t  "+r(e.getArgumentTexture.toString())+"\n\t\t  "+r(e.getTextureCache.toString())+"\n\t\t  "+r(e.getOutputTexture.toString())+"\n\t\t  "+r(e.renderOutput.toString())+"\n\t\t  "+r(e.updateMaxTexSize.toString())+"\n\t\t  "+r(e._setupOutputTexture.toString())+"\n\t\t  "+r(e.detachTextureCache.toString())+"\n\t\t  "+r(e.setUniform1f.toString())+"\n\t\t  "+r(e.setUniform1i.toString())+"\n\t\t  "+r(e.setUniform2f.toString())+"\n\t\t  "+r(e.setUniform2fv.toString())+"\n\t\t  "+r(e.setUniform3fv.toString())+" \n    };\n    return kernelRunShortcut(new Kernel());\n  };"}},{"../../core/utils":32,"../kernel-run-shortcut":9}],14:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../kernel-base"),u=e("../../core/utils"),h=e("../../core/texture"),l=e("./shader-frag"),p=e("./shader-vert"),c=e("./kernel-string"),f=[],d={};t.exports=function(e){function t(e,n){r(this,t);var s=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return s.textureCache={},s.threadDim={},s.programUniformLocationCache={},s.framebuffer=null,s.buffer=null,s.program=null,s.outputToTexture=n.outputToTexture,s.endianness=u.systemEndianness(),s.subKernelOutputTextures=null,s.subKernelOutputVariableNames=null,s.argumentsLength=0,s.compiledFragShaderString=null,s.compiledVertShaderString=null,s.drawBuffersMap=null,s.outputTexture=null,s.maxTexSize=null,s.uniform1fCache={},s.uniform1iCache={},s.uniform2fCache={},s.uniform2fvCache={},s.uniform3fvCache={},s._webGl||(s._webGl=s.initWebGl()),s}return s(t,e),a(t,null,[{key:"fragShaderString",get:function(){return l}},{key:"vertShaderString",get:function(){return p}}]),a(t,[{key:"initWebGl",value:function(){return u.initWebGl(this.getCanvas())}},{key:"validateOptions",value:function(){var e=u.isFloatReadPixelsSupported();if(this.floatTextures===!0&&!u.OES_texture_float)throw new Error("Float textures are not supported on this browser");if(this.floatOutput===!0&&this.floatOutputForce!==!0&&!e)throw new Error("Float texture outputs are not supported on this browser");if(void 0===this.floatTextures&&u.OES_texture_float&&(this.floatTextures=!0,this.floatOutput=e),!this.output||0===this.output.length){if(1!==arguments.length)throw new Error("Auto output only supported for kernels with only one input");var t=u.getArgumentType(arguments[0]);if("Array"===t)this.output=u.getDimensions(t);else{if("Texture"!==t)throw new Error("Auto output not supported for input type: "+t);this.output=arguments[0].output}}if(this.texSize=u.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},this.output,!0),this.graphical){if(2!==this.output.length)throw new Error("Output must have 2 dimensions on graphical mode");this.floatOutput&&(this.floatOutput=!1,console.warn("Cannot use graphical mode and float output at the same time")),this.texSize=u.clone(this.output)}else void 0===this.floatOutput&&u.OES_texture_float&&(this.floatOutput=!0)}},{key:"updateMaxTexSize",value:function(){var e=this.texSize,t=this._canvas;if(null===this.maxTexSize){var n=f.indexOf(t);n===-1&&(n=f.length,f.push(t),d[n]=[e[0],e[1]]),this.maxTexSize=d[n]}this.maxTexSize[0]<e[0]&&(this.maxTexSize[0]=e[0]),this.maxTexSize[1]<e[1]&&(this.maxTexSize[1]=e[1])}},{key:"build",value:function(){this.validateOptions(),this.setupParams(arguments),this.updateMaxTexSize();var e=this.texSize,t=this._webGl,n=this._canvas;t.enable(t.SCISSOR_TEST),t.viewport(0,0,this.maxTexSize[0],this.maxTexSize[1]),n.width=this.maxTexSize[0],n.height=this.maxTexSize[1];for(var r=this.threadDim=u.clone(this.output);r.length<3;)r.push(1);this.functionBuilder&&this._addKernels();var i=this._getVertShaderString(arguments),s=t.createShader(t.VERTEX_SHADER);t.shaderSource(s,i),t.compileShader(s);var a=this._getFragShaderString(arguments),o=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(o,a),t.compileShader(o),!t.getShaderParameter(s,t.COMPILE_STATUS))throw console.log(i),console.error("An error occurred compiling the shaders: "+t.getShaderInfoLog(s)),new Error("Error compiling vertex shader");if(!t.getShaderParameter(o,t.COMPILE_STATUS))throw console.log(a),console.error("An error occurred compiling the shaders: "+t.getShaderInfoLog(o)),new Error("Error compiling fragment shader");this.debug&&(console.log("Options:"),console.dir(this),console.log("GLSL Shader Output:"),console.log(a));var h=this.program=t.createProgram();t.attachShader(h,s),t.attachShader(h,o),t.linkProgram(h),this.framebuffer=t.createFramebuffer(),this.framebuffer.width=e[0],this.framebuffer.height=e[1];var l=new Float32Array([-1,-1,1,-1,-1,1,1,1]),p=new Float32Array([0,0,1,0,0,1,1,1]),c=l.byteLength,f=this.buffer;f?t.bindBuffer(t.ARRAY_BUFFER,f):(f=this.buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,f),t.bufferData(t.ARRAY_BUFFER,l.byteLength+p.byteLength,t.STATIC_DRAW)),t.bufferSubData(t.ARRAY_BUFFER,0,l),t.bufferSubData(t.ARRAY_BUFFER,c,p);var d=t.getAttribLocation(this.program,"aPos");t.enableVertexAttribArray(d),t.vertexAttribPointer(d,2,t.FLOAT,t.FALSE,0,0);var g=t.getAttribLocation(this.program,"aTexCoord");t.enableVertexAttribArray(g),t.vertexAttribPointer(g,2,t.FLOAT,t.FALSE,0,c),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer),this.outputImmutable||(this._setupOutputTexture(),null!==this.subKernelOutputVariableNames&&this.subKernelOutputVariableNames.length>0&&this._setupSubOutputTextures(this.subKernelOutputVariableNames.length))}},{key:"run",value:function(){null===this.program&&this.build.apply(this,arguments);var e=this.paramNames,t=this.paramTypes,n=this.texSize,r=this._webGl;r.useProgram(this.program),r.scissor(0,0,n[0],n[1]),this.hardcodeConstants||(this.setUniform3fv("uOutputDim",this.threadDim),this.setUniform2fv("uTexSize",n)),this.setUniform2f("ratio",n[0]/this.maxTexSize[0],n[1]/this.maxTexSize[1]),this.argumentsLength=0;for(var i=0;i<e.length;i++)this._addArgument(arguments[i],t[i],e[i]);if(this.graphical)return r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),void r.drawArrays(r.TRIANGLE_STRIP,0,4);r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer),this.outputImmutable&&this._setupOutputTexture();var s=this.outputTexture;if(null!==this.subKernelOutputVariableNames&&(this.outputImmutable&&(this.subKernelOutputTextures=[],this._setupSubOutputTextures(this.subKernelOutputVariableNames.length)),this.drawBuffers.drawBuffersWEBGL(this.drawBuffersMap)),r.drawArrays(r.TRIANGLE_STRIP,0,4),null!==this.subKernelOutputTextures){if(null!==this.subKernels){var a=[];a.result=this.renderOutput(s);for(var o=0;o<this.subKernels.length;o++)a.push(new h(this.subKernelOutputTextures[o],n,this.threadDim,this.output,this._webGl));return a}if(null!==this.subKernelProperties){var u={result:this.renderOutput(s)},l=0;for(var p in this.subKernelProperties)this.subKernelProperties.hasOwnProperty(p)&&(u[p]=new h(this.subKernelOutputTextures[l],n,this.threadDim,this.output,this._webGl),l++);return u}}return this.renderOutput(s)}},{key:"renderOutput",value:function(e){var t=this.texSize,n=this._webGl,r=this.threadDim,i=this.output;if(this.outputToTexture)return new h(e,t,this.threadDim,i,this._webGl);var s=void 0;if(this.floatOutput)s=new Float32Array(t[0]*t[1]*4),n.readPixels(0,0,t[0],t[1],n.RGBA,n.FLOAT,s);else{var a=new Uint8Array(t[0]*t[1]*4);n.readPixels(0,0,t[0],t[1],n.RGBA,n.UNSIGNED_BYTE,a),s=new Float32Array(a.buffer)}if(s=s.subarray(0,r[0]*r[1]*r[2]),1===i.length)return s;if(2===i.length)return u.splitArray(s,i[0]);
if(3===i.length){var o=u.splitArray(s,i[0]*i[1]);return o.map(function(e){return u.splitArray(e,i[0])})}}},{key:"getOutputTexture",value:function(){return this.outputTexture}},{key:"_setupOutputTexture",value:function(){var e=this._webGl,t=this.texSize,n=this.outputTexture=this._webGl.createTexture();e.activeTexture(e.TEXTURE0+this.paramNames.length),e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),this.floatOutput?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t[0],t[1],0,e.RGBA,e.FLOAT,null):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t[0],t[1],0,e.RGBA,e.UNSIGNED_BYTE,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}},{key:"_setupSubOutputTextures",value:function(e){for(var t=this._webGl,n=this.texSize,r=this.drawBuffersMap=[t.COLOR_ATTACHMENT0],i=this.subKernelOutputTextures=[],s=0;s<e;s++){var a=this._webGl.createTexture();i.push(a),r.push(t.COLOR_ATTACHMENT0+s+1),t.activeTexture(t.TEXTURE0+this.paramNames.length+s),t.bindTexture(t.TEXTURE_2D,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),this.floatOutput?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n[0],n[1],0,t.RGBA,t.FLOAT,null):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n[0],n[1],0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+s+1,t.TEXTURE_2D,a,0)}}},{key:"getArgumentTexture",value:function(e){return this.getTextureCache("ARGUMENT_"+e)}},{key:"getTextureCache",value:function(e){return this.textureCache.hasOwnProperty(e)?this.textureCache[e]:this.textureCache[e]=this._webGl.createTexture()}},{key:"detachTextureCache",value:function(e){delete this.textureCache[e]}},{key:"setUniform1f",value:function(e,t){if(this.uniform1fCache.hasOwnProperty(e)){var n=this.uniform1fCache[e];if(t===n)return}this.uniform1fCache[e]=t;var r=this.getUniformLocation(e);this._webGl.uniform1f(r,t)}},{key:"setUniform1i",value:function(e,t){if(this.uniform1iCache.hasOwnProperty(e)){var n=this.uniform1iCache[e];if(t===n)return}this.uniform1iCache[e]=t;var r=this.getUniformLocation(e);this._webGl.uniform1i(r,t)}},{key:"setUniform2f",value:function(e,t,n){if(this.uniform2fCache.hasOwnProperty(e)){var r=this.uniform2fCache[e];if(t===r[0]&&n===r[1])return}this.uniform2fCache[e]=[t,n];var i=this.getUniformLocation(e);this._webGl.uniform2f(i,t,n)}},{key:"setUniform2fv",value:function(e,t){if(this.uniform2fvCache.hasOwnProperty(e)){var n=this.uniform2fvCache[e];if(t[0]===n[0]&&t[1]===n[1])return}this.uniform2fvCache[e]=t;var r=this.getUniformLocation(e);this._webGl.uniform2fv(r,t)}},{key:"setUniform3fv",value:function(e,t){if(this.uniform3fvCache.hasOwnProperty(e)){var n=this.uniform3fvCache[e];if(t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2])return}this.uniform3fvCache[e]=t;var r=this.getUniformLocation(e);this._webGl.uniform3fv(r,t)}},{key:"getUniformLocation",value:function(e){return this.programUniformLocationCache.hasOwnProperty(e)?this.programUniformLocationCache[e]:this.programUniformLocationCache[e]=this._webGl.getUniformLocation(this.program,e)}},{key:"_getFragShaderArtifactMap",value:function(e){return{HEADER:this._getHeaderString(),LOOP_MAX:this._getLoopMaxString(),CONSTANTS:this._getConstantsString(),DECODE32_ENDIANNESS:this._getDecode32EndiannessString(),ENCODE32_ENDIANNESS:this._getEncode32EndiannessString(),GET_WRAPAROUND:this._getGetWraparoundString(),GET_TEXTURE_CHANNEL:this._getGetTextureChannelString(),GET_TEXTURE_INDEX:this._getGetTextureIndexString(),GET_RESULT:this._getGetResultString(),MAIN_PARAMS:this._getMainParamsString(e),MAIN_CONSTANTS:this._getMainConstantsString(),KERNEL:this._getKernelString(),MAIN_RESULT:this._getMainResultString()}}},{key:"_addArgument",value:function(e,t,n){var r=this._webGl,i=this.getArgumentTexture(n);switch(e instanceof h&&(t="Texture"),t){case"Array":var s=u.getDimensions(e,!0),a=u.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},s);r.activeTexture(r.TEXTURE0+this.argumentsLength),r.bindTexture(r.TEXTURE_2D,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST);var o=a[0]*a[1];this.floatTextures&&(o*=4);var l=new Float32Array(o);u.flattenTo(e,l);var p=void 0;this.floatTextures?r.texImage2D(r.TEXTURE_2D,0,r.RGBA,a[0],a[1],0,r.RGBA,r.FLOAT,l):(p=new Uint8Array(l.buffer),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,a[0],a[1],0,r.RGBA,r.UNSIGNED_BYTE,p)),this.hardcodeConstants||(this.setUniform3fv("user_"+n+"Dim",s),this.setUniform2fv("user_"+n+"Size",a)),this.setUniform1i("user_"+n,this.argumentsLength);break;case"Integer":case"Float":this.setUniform1f("user_"+n,e);break;case"Input":var c=e,f=c.size,d=u.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},f);r.activeTexture(r.TEXTURE0+this.argumentsLength),r.bindTexture(r.TEXTURE_2D,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST);var g=d[0]*d[1],m=void 0;if(this.floatTextures?(g*=4,m=new Float32Array(g),m.set(c.value)):m=c.value,this.floatTextures)r.texImage2D(r.TEXTURE_2D,0,r.RGBA,d[0],d[1],0,r.RGBA,r.FLOAT,m);else{var x=new Uint8Array(m.buffer);r.texImage2D(r.TEXTURE_2D,0,r.RGBA,d[0],d[1],0,r.RGBA,r.UNSIGNED_BYTE,x)}this.hardcodeConstants||(this.setUniform3fv("user_"+n+"Dim",f),this.setUniform2fv("user_"+n+"Size",d)),this.setUniform1i("user_"+n,this.argumentsLength);break;case"HTMLImage":var y=e,v=[y.width,y.height,1],b=[y.width,y.height];r.activeTexture(r.TEXTURE0+this.argumentsLength),r.bindTexture(r.TEXTURE_2D,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0);var _=0,E=r.RGBA,T=r.RGBA,S=r.UNSIGNED_BYTE;r.texImage2D(r.TEXTURE_2D,_,E,T,S,y),this.setUniform3fv("user_"+n+"Dim",v),this.setUniform2fv("user_"+n+"Size",b),this.setUniform1i("user_"+n,this.argumentsLength);break;case"Texture":var k=e,w=k.dimensions,A=k.size;r.activeTexture(r.TEXTURE0+this.argumentsLength),r.bindTexture(r.TEXTURE_2D,k.texture),this.setUniform3fv("user_"+n+"Dim",w),this.setUniform2fv("user_"+n+"Size",A),this.setUniform1i("user_"+n,this.argumentsLength);break;default:throw new Error("Input type not supported (WebGL): "+e)}this.argumentsLength++}},{key:"_getHeaderString",value:function(){return null!==this.subKernels||null!==this.subKernelProperties?"#extension GL_EXT_draw_buffers : require\n":""}},{key:"_getLoopMaxString",value:function(){return this.loopMaxIterations?" "+parseInt(this.loopMaxIterations)+".0;\n":" 1000.0;\n"}},{key:"_getConstantsString",value:function(){var e=[],t=this.threadDim,n=this.texSize;return this.hardcodeConstants?e.push("highp vec3 uOutputDim = vec3("+t[0]+","+t[1]+", "+t[2]+")","highp vec2 uTexSize = vec2("+n[0]+", "+n[1]+")"):e.push("uniform highp vec3 uOutputDim","uniform highp vec2 uTexSize"),this._linesToString(e)}},{key:"_getTextureCoordinate",value:function(){var e=this.subKernelOutputVariableNames;return null===e||e.length<1?"varying highp vec2 vTexCoord;\n":"out highp vec2 vTexCoord;\n"}},{key:"_getDecode32EndiannessString",value:function(){return"LE"===this.endianness?"":"  rgba.rgba = rgba.abgr;\n"}},{key:"_getEncode32EndiannessString",value:function(){return"LE"===this.endianness?"":"  rgba.rgba = rgba.abgr;\n"}},{key:"_getGetWraparoundString",value:function(){return this.wraparound?"  xyz = mod(xyz, texDim);\n":""}},{key:"_getGetTextureChannelString",value:function(){return this.floatTextures?this._linesToString(["  int channel = int(integerMod(index, 4.0))","  index = float(int(index) / 4)"]):""}},{key:"_getGetTextureIndexString",value:function(){return this.floatTextures?"  index = float(int(index)/4);\n":""}},{key:"_getGetResultString",value:function(){return this.floatTextures?this._linesToString(["  if (channel == 0) return texel.r","  if (channel == 1) return texel.g","  if (channel == 2) return texel.b","  if (channel == 3) return texel.a"]):"  return decode32(texel);\n"}},{key:"_getMainParamsString",value:function(e){for(var t=[],n=this.paramTypes,r=this.paramNames,i=0;i<r.length;i++){var s=e[i],a=r[i],o=n[i];if(this.hardcodeConstants)if("Array"===o||"Texture"===o){var h=u.getDimensions(s,!0),l=u.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},h);t.push("uniform highp sampler2D user_"+a,"highp vec2 user_"+a+"Size = vec2("+l[0]+".0, "+l[1]+".0)","highp vec3 user_"+a+"Dim = vec3("+h[0]+".0, "+h[1]+".0, "+h[2]+".0)")}else"Integer"===o?t.push("highp float user_"+a+" = "+s+".0"):"Float"===o&&t.push("highp float user_"+a+" = "+s);else if("Array"===o||"Texture"===o||"Input"===o||"HTMLImage"===o)t.push("uniform highp sampler2D user_"+a,"uniform highp vec2 user_"+a+"Size","uniform highp vec3 user_"+a+"Dim");else{if("Integer"!==o&&"Float"!==o)throw new Error("Param type "+o+" not supported in WebGL, only WebGL2");t.push("uniform highp float user_"+a)}}return this._linesToString(t)}},{key:"_getMainConstantsString",value:function(){var e=[];if(this.constants)for(var t in this.constants)if(this.constants.hasOwnProperty(t)){var n=this.constants[t],r=u.getArgumentType(n);switch(r){case"Integer":e.push("const float constants_"+t+" = "+parseInt(n)+".0");break;case"Float":e.push("const float constants_"+t+" = "+parseFloat(n));break;default:throw new Error("Unsupported constant "+t+" type "+r)}}return this._linesToString(e)}},{key:"_getKernelString",value:function(){var e=[],t=this.subKernelOutputVariableNames;if(null!==t){e.push("highp float kernelResult = 0.0");for(var n=0;n<t.length;n++)e.push("highp float "+t[n]+" = 0.0")}else e.push("highp float kernelResult = 0.0");return this._linesToString(e)+this.functionBuilder.getPrototypeString("kernel")}},{key:"_getMainResultString",value:function(){var e=this.subKernelOutputVariableNames,t=[];if(this.floatOutput&&t.push("  index *= 4.0"),this.graphical)t.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragColor = actualColor");else if(this.floatOutput)for(var n=["r","g","b","a"],r=0;r<n.length;++r){if(t.push("  threadId = indexTo3D(index, uOutputDim)"),t.push("  kernel()"),e){t.push("  gl_FragData[0]."+n[r]+" = kernelResult");for(var i=0;i<e.length;++i)t.push("  gl_FragData["+(i+1)+"]."+n[r]+" = "+e[i])}else t.push("  gl_FragColor."+n[r]+" = kernelResult");r<n.length-1&&t.push("  index += 1.0")}else if(null!==e){t.push("  threadId = indexTo3D(index, uOutputDim)"),t.push("  kernel()"),t.push("  gl_FragData[0] = encode32(kernelResult)");for(var s=0;s<e.length;s++)t.push("  gl_FragData["+(s+1)+"] = encode32("+e[s]+")")}else t.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragColor = encode32(kernelResult)");return this._linesToString(t)}},{key:"_linesToString",value:function(e){return e.length>0?e.join(";\n")+";\n":"\n"}},{key:"_replaceArtifacts",value:function(e,t){return e.replace(/[ ]*__([A-Z]+[0-9]*([_]?[A-Z])*)__;\n/g,function(e,n){if(t.hasOwnProperty(n))return t[n];throw"unhandled artifact "+n})}},{key:"_addKernels",value:function(){var e=this,t=this.functionBuilder,n=this._webGl;if(t.addFunctions(this.functions,{constants:this.constants,output:this.output}),t.addNativeFunctions(this.nativeFunctions),t.addKernel(this.fnString,{prototypeOnly:!1,constants:this.constants,output:this.output,debug:this.debug,loopMaxIterations:this.loopMaxIterations},this.paramNames,this.paramTypes),null!==this.subKernels){var r=this.drawBuffers=n.getExtension("WEBGL_draw_buffers");if(!r)throw new Error("could not instantiate draw buffers extension");this.subKernelOutputVariableNames=[],this.subKernels.forEach(function(t){return e._addSubKernel(t)})}else if(null!==this.subKernelProperties){var i=this.drawBuffers=n.getExtension("WEBGL_draw_buffers");if(!i)throw new Error("could not instantiate draw buffers extension");this.subKernelOutputVariableNames=[],Object.keys(this.subKernelProperties).forEach(function(t){return e._addSubKernel(e.subKernelProperties[t])})}}},{key:"_addSubKernel",value:function(e){this.functionBuilder.addSubKernel(e,{prototypeOnly:!1,constants:this.constants,output:this.output,debug:this.debug,loopMaxIterations:this.loopMaxIterations}),this.subKernelOutputVariableNames.push(e.name+"Result")}},{key:"_getFragShaderString",value:function(e){return null!==this.compiledFragShaderString?this.compiledFragShaderString:this.compiledFragShaderString=this._replaceArtifacts(this.constructor.fragShaderString,this._getFragShaderArtifactMap(e))}},{key:"_getVertShaderString",value:function(e){return null!==this.compiledVertShaderString?this.compiledVertShaderString:this.compiledVertShaderString=this.constructor.vertShaderString}},{key:"toString",value:function(){return c(this)}},{key:"addFunction",value:function(e){this.functionBuilder.addFunction(null,e)}}]),t}(o)},{"../../core/texture":30,"../../core/utils":32,"../kernel-base":8,"./kernel-string":13,"./shader-frag":16,"./shader-vert":17}],15:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../runner-base"),u=e("./kernel"),h=(e("../../core/utils"),e("./function-builder"));t.exports=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,new h,e));return n.Kernel=u,n.kernel=null,n}return s(t,e),a(t,[{key:"getMode",value:function(){return"gpu"}}]),t}(o)},{"../../core/utils":32,"../runner-base":10,"./function-builder":11,"./kernel":14}],16:[function(e,t,n){t.exports="__HEADER__;\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nconst float LOOP_MAX = __LOOP_MAX__;\n#define EPSILON 0.0000001;\n\n__CONSTANTS__;\n\nvarying highp vec2 vTexCoord;\n\nvec4 round(vec4 x) {\n  return floor(x + 0.5);\n}\n\nhighp float round(highp float x) {\n  return floor(x + 0.5);\n}\n\nvec2 integerMod(vec2 x, float y) {\n  vec2 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec3 integerMod(vec3 x, float y) {\n  vec3 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec4 integerMod(vec4 x, vec4 y) {\n  vec4 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nhighp float integerMod(highp float x, highp float y) {\n  highp float res = floor(mod(x, y));\n  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);\n}\n\nhighp int integerMod(highp int x, highp int y) {\n  return int(integerMod(float(x), float(y)));\n}\n\n// Here be dragons!\n// DO NOT OPTIMIZE THIS CODE\n// YOU WILL BREAK SOMETHING ON SOMEBODY'S MACHINE\n// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME\nconst vec2 MAGIC_VEC = vec2(1.0, -256.0);\nconst vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);\nconst vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536\nhighp float decode32(highp vec4 rgba) {\n  __DECODE32_ENDIANNESS__;\n  rgba *= 255.0;\n  vec2 gte128;\n  gte128.x = rgba.b >= 128.0 ? 1.0 : 0.0;\n  gte128.y = rgba.a >= 128.0 ? 1.0 : 0.0;\n  float exponent = 2.0 * rgba.a - 127.0 + dot(gte128, MAGIC_VEC);\n  float res = exp2(round(exponent));\n  rgba.b = rgba.b - 128.0 * gte128.x;\n  res = dot(rgba, SCALE_FACTOR) * exp2(round(exponent-23.0)) + res;\n  res *= gte128.y * -2.0 + 1.0;\n  return res;\n}\n\nhighp vec4 encode32(highp float f) {\n  highp float F = abs(f);\n  highp float sign = f < 0.0 ? 1.0 : 0.0;\n  highp float exponent = floor(log2(F));\n  highp float mantissa = (exp2(-exponent) * F);\n  // exponent += floor(log2(mantissa));\n  vec4 rgba = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;\n  rgba.rg = integerMod(rgba.rg, 256.0);\n  rgba.b = integerMod(rgba.b, 128.0);\n  rgba.a = exponent*0.5 + 63.5;\n  rgba.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;\n  rgba = floor(rgba);\n  rgba *= 0.003921569; // 1/255\n  __ENCODE32_ENDIANNESS__;\n  return rgba;\n}\n// Dragons end here\n\nhighp float index;\nhighp vec3 threadId;\n\nhighp vec3 indexTo3D(highp float idx, highp vec3 texDim) {\n  highp float z = floor(idx / (texDim.x * texDim.y));\n  idx -= z * texDim.x * texDim.y;\n  highp float y = floor(idx / texDim.x);\n  highp float x = integerMod(idx, texDim.x);\n  return vec3(x, y, z);\n}\n\nhighp float get(highp sampler2D tex, highp vec2 texSize, highp vec3 texDim, highp float z, highp float y, highp float x) {\n  highp vec3 xyz = vec3(x, y, z);\n  xyz = floor(xyz + 0.5);\n  __GET_WRAPAROUND__;\n  highp float index = round(xyz.x + texDim.x * (xyz.y + texDim.y * xyz.z));\n  __GET_TEXTURE_CHANNEL__;\n  highp float w = round(texSize.x);\n  vec2 st = vec2(integerMod(index, w), float(int(index) / int(w))) + 0.5;\n  __GET_TEXTURE_INDEX__;\n  highp vec4 texel = texture2D(tex, st / texSize);\n  __GET_RESULT__;\n}\n\nhighp vec4 getImage2D(highp sampler2D tex, highp vec2 texSize, highp vec3 texDim, highp float z, highp float y, highp float x) {\n  highp vec3 xyz = vec3(x, y, z);\n  xyz = floor(xyz + 0.5);\n  __GET_WRAPAROUND__;\n  highp float index = round(xyz.x + texDim.x * (xyz.y + texDim.y * xyz.z));\n  __GET_TEXTURE_CHANNEL__;\n  highp float w = round(texSize.x);\n  vec2 st = vec2(integerMod(index, w), float(int(index) / int(w))) + 0.5;\n  __GET_TEXTURE_INDEX__;\n  return texture2D(tex, st / texSize);\n}\n\nhighp float get(highp sampler2D tex, highp vec2 texSize, highp vec3 texDim, highp float y, highp float x) {\n  return get(tex, texSize, texDim, 0.0, y, x);\n}\n\nhighp vec4 getImage2D(highp sampler2D tex, highp vec2 texSize, highp vec3 texDim, highp float y, highp float x) {\n  return getImage2D(tex, texSize, texDim, 0.0, y, x);\n}\n\nhighp float get(highp sampler2D tex, highp vec2 texSize, highp vec3 texDim, highp float x) {\n  return get(tex, texSize, texDim, 0.0, 0.0, x);\n}\n\nhighp vec4 getImage2D(highp sampler2D tex, highp vec2 texSize, highp vec3 texDim, highp float x) {\n  return getImage2D(tex, texSize, texDim, 0.0, 0.0, x);\n}\n\nhighp vec4 actualColor;\nvoid color(float r, float g, float b, float a) {\n  actualColor = vec4(r,g,b,a);\n}\n\nvoid color(float r, float g, float b) {\n  color(r,g,b,1.0);\n}\n\nvoid color(sampler2D image) {\n  actualColor = texture2D(image, vTexCoord);\n}\n\n__MAIN_PARAMS__;\n__MAIN_CONSTANTS__;\n__KERNEL__;\n\nvoid main(void) {\n  index = floor(vTexCoord.s * float(uTexSize.x)) + floor(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;\n  __MAIN_RESULT__;\n}"},{}],17:[function(e,t,n){t.exports="precision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nattribute highp vec2 aPos;\nattribute highp vec2 aTexCoord;\n\nvarying highp vec2 vTexCoord;\nuniform vec2 ratio;\n\nvoid main(void) {\n  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);\n  vTexCoord = aTexCoord;\n}"},{}],18:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./kernel"),u=e("../../core/utils");t.exports=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return s(t,e),a(t,[{key:"validateOptions",value:function(){this.texSize=u.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},this.output,!0)}}]),t}(o)},{"../../core/utils":32,"./kernel":14}],19:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=e("../function-builder-base"),o=e("./function-node");t.exports=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.Node=o,e}return s(t,e),t}(a)},{"../function-builder-base":6,"./function-node":20}],20:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){return e.replace(h,"((").replace(l,"((")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("../web-gl/function-node"),h=/decode32\(\s+encode32\(/g,l=/encode32\(\s+decode32\(/g;t.exports=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return s(t,e),o(t,[{key:"generate",value:function(){return this.debug&&console.log(this),this.prototypeOnly?t.astFunctionPrototype(this.getJsAST(),[],this).join("").trim():(this.functionStringArray=this.astGeneric(this.getJsAST(),[],this),this.functionString=a(this.functionStringArray.join("").trim()),this.functionString)}},{key:"astFunctionExpression",value:function(e,t,n){if(n.isRootKernel?(t.push("void"),n.kernalAst=e):t.push(n.returnType),t.push(" "),t.push(n.functionName),t.push("("),!n.isRootKernel)for(var r=0;r<n.paramNames.length;++r){var i=n.paramNames[r];r>0&&t.push(", ");var s=n.getParamType(i);switch(s){case"Texture":case"Input":case"Array":case"HTMLImage":t.push("sampler2D");break;default:t.push("float")}t.push(" "),t.push("user_"),t.push(i)}t.push(") {\n");for(var a=0;a<e.body.body.length;++a)this.astGeneric(e.body.body[a],t,n),t.push("\n");return t.push("}\n"),t}},{key:"astIdentifierExpression",value:function(e,t,n){if("Identifier"!==e.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",e,n);switch(e.name){case"gpu_threadX":t.push("threadId.x");break;case"gpu_threadY":t.push("threadId.y");break;case"gpu_threadZ":t.push("threadId.z");break;case"gpu_outputX":t.push("uOutputDim.x");break;case"gpu_outputY":t.push("uOutputDim.y");break;case"gpu_outputZ":t.push("uOutputDim.z");break;case"Infinity":t.push("intBitsToFloat(2139095039)");break;default:if(this.constants&&this.constants.hasOwnProperty(e.name))t.push("constants_"+e.name);else{var r=n.getUserParamName(e.name);null!==r?t.push("user_"+r):t.push("user_"+e.name)}}return t}}]),t}(u)},{"../web-gl/function-node":12}],21:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../web-gl/kernel"),u=e("../../core/utils"),h=e("../../core/texture"),l=e("./shader-frag"),p=e("./shader-vert");t.exports=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return s(t,e),a(t,[{key:"initWebGl",value:function(){return u.initWebGl2(this.getCanvas())}},{key:"validateOptions",value:function(){var e=u.isFloatReadPixelsSupportedWebGL2();if(this.floatOutput===!0&&this.floatOutputForce!==!0&&!e)throw new Error("Float texture outputs are not supported on this browser");if(void 0===this.floatTextures&&(this.floatTextures=!0,this.floatOutput=e),!this.output||0===this.output.length){if(1!==arguments.length)throw new Error("Auto output only supported for kernels with only one input");var t=u.getArgumentType(arguments[0]);if("Array"===t)this.output=u.getDimensions(t);else{if("Texture"!==t)throw new Error("Auto output not supported for input type: "+t);this.output=arguments[0].output}}if(this.texSize=u.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},this.output,!0),this.graphical){if(2!==this.output.length)throw new Error("Output must have 2 dimensions on graphical mode");this.floatOutput&&(this.floatOutput=!1,console.warn("Cannot use graphical mode and float output at the same time")),this.texSize=u.clone(this.output)}else void 0===this.floatOutput&&(this.floatOutput=!0);(this.floatOutput||this.floatOutputForce)&&this._webGl.getExtension("EXT_color_buffer_float")}},{key:"run",value:function(){null===this.program&&this.build.apply(this,arguments);var e=this.paramNames,t=this.paramTypes,n=this.texSize,r=this._webGl;r.useProgram(this.program),r.scissor(0,0,n[0],n[1]),this.hardcodeConstants||(this.setUniform3fv("uOutputDim",this.threadDim),this.setUniform2fv("uTexSize",n)),this.setUniform2f("ratio",n[0]/this.maxTexSize[0],n[1]/this.maxTexSize[1]),this.argumentsLength=0;for(var i=0;i<e.length;i++)this._addArgument(arguments[i],t[i],e[i]);if(this.graphical)return r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),void r.drawArrays(r.TRIANGLE_STRIP,0,4);r.bindFramebuffer(r.FRAMEBUFFER,this.framebuffer),this.outputImmutable&&this._setupOutputTexture();var s=this.outputTexture;if(null!==this.subKernelOutputVariableNames&&(this.outputImmutable&&(this.subKernelOutputTextures=[],this._setupSubOutputTextures(this.subKernelOutputVariableNames.length)),r.drawBuffers(this.drawBuffersMap)),r.drawArrays(r.TRIANGLE_STRIP,0,4),null!==this.subKernelOutputTextures){if(null!==this.subKernels){var a=[];a.result=this.renderOutput(s);for(var o=0;o<this.subKernels.length;o++)a.push(new h(this.subKernelOutputTextures[o],n,this.threadDim,this.output,this._webGl));return a}if(null!==this.subKernelProperties){var u={result:this.renderOutput(s)},l=0;for(var p in this.subKernelProperties)this.subKernelProperties.hasOwnProperty(p)&&(u[p]=new h(this.subKernelOutputTextures[l],n,this.threadDim,this.output,this._webGl),l++);return u}}return this.renderOutput(s)}},{key:"getOutputTexture",value:function(){return this.outputTexture}},{key:"_setupOutputTexture",value:function(){var e=this._webGl,t=this.texSize,n=this.outputTexture=this._webGl.createTexture();e.activeTexture(e.TEXTURE0+this.paramNames.length),e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),this.floatOutput?e.texImage2D(e.TEXTURE_2D,0,e.RGBA32F,t[0],t[1],0,e.RGBA,e.FLOAT,null):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t[0],t[1],0,e.RGBA,e.UNSIGNED_BYTE,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}},{key:"_setupSubOutputTextures",value:function(e){for(var t=this._webGl,n=this.texSize,r=this.drawBuffersMap=[t.COLOR_ATTACHMENT0],i=this.subKernelOutputTextures=[],s=0;s<e;s++){var a=this._webGl.createTexture();i.push(a),r.push(t.COLOR_ATTACHMENT0+s+1),t.activeTexture(t.TEXTURE0+this.paramNames.length+s),t.bindTexture(t.TEXTURE_2D,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),this.floatOutput?t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,n[0],n[1],0,t.RGBA,t.FLOAT,null):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n[0],n[1],0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+s+1,t.TEXTURE_2D,a,0)}}},{key:"_addArgument",value:function(e,t,n){var r=this._webGl,i=this.getArgumentTexture(n);switch(e instanceof h&&(t="Texture"),t){case"Array":var s=u.getDimensions(e,!0),a=u.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},s);r.activeTexture(r.TEXTURE0+this.argumentsLength),r.bindTexture(r.TEXTURE_2D,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST);var o=a[0]*a[1];this.floatTextures&&(o*=4);var l=new Float32Array(o);u.flattenTo(e,l);var p=void 0;this.floatTextures?r.texImage2D(r.TEXTURE_2D,0,r.RGBA32F,a[0],a[1],0,r.RGBA,r.FLOAT,l):(p=new Uint8Array(l.buffer),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,a[0],a[1],0,r.RGBA,r.UNSIGNED_BYTE,p)),this.hardcodeConstants||(this.setUniform3fv("user_"+n+"Dim",s),this.setUniform2fv("user_"+n+"Size",a)),this.setUniform1i("user_"+n,this.argumentsLength);break;case"Integer":case"Float":this.setUniform1f("user_"+n,e);break;case"Input":var c=e,f=c.size,d=u.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},f);r.activeTexture(r.TEXTURE0+this.argumentsLength),r.bindTexture(r.TEXTURE_2D,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST);var g=d[0]*d[1],m=void 0;if(this.floatTextures?(g*=4,m=new Float32Array(g),m.set(c.value)):m=c.value,this.floatTextures)r.texImage2D(r.TEXTURE_2D,0,r.RGBA32F,d[0],d[1],0,r.RGBA,r.FLOAT,m);else{var x=new Uint8Array(m.buffer);
r.texImage2D(r.TEXTURE_2D,0,r.RGBA,d[0],d[1],0,r.RGBA,r.UNSIGNED_BYTE,x)}this.hardcodeConstants||(this.setUniform3fv("user_"+n+"Dim",f),this.setUniform2fv("user_"+n+"Size",d)),this.setUniform1i("user_"+n,this.argumentsLength);break;case"HTMLImage":var y=e,v=[y.width,y.height,1],b=[y.width,y.height];r.activeTexture(r.TEXTURE0+this.argumentsLength),r.bindTexture(r.TEXTURE_2D,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0);var _=0,E=r.RGBA,T=r.RGBA,S=r.UNSIGNED_BYTE;r.texImage2D(r.TEXTURE_2D,_,E,T,S,y),this.setUniform3fv("user_"+n+"Dim",v),this.setUniform2fv("user_"+n+"Size",b),this.setUniform1i("user_"+n,this.argumentsLength);break;case"HTMLImageArray":var k=e,w=[k[0].width,k[0].height,k.length],A=[k[0].width,k[0].height];r.activeTexture(r.TEXTURE0+this.argumentsLength),r.bindTexture(r.TEXTURE_2D_ARRAY,i),r.texParameteri(r.TEXTURE_2D_ARRAY,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D_ARRAY,r.TEXTURE_MIN_FILTER,r.NEAREST),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0);var O=0,C=r.RGBA,R=k[0].width,P=k[0].height,N=k.length,I=0,D=r.RGBA,L=r.UNSIGNED_BYTE;r.texImage3D(r.TEXTURE_2D_ARRAY,O,C,R,P,N,I,D,L,null);for(var F=0;F<k.length;F++){var G=0,U=0,M=1;r.texSubImage3D(r.TEXTURE_2D_ARRAY,O,G,U,F,k[F].width,k[F].height,M,D,L,k[F])}this.setUniform3fv("user_"+n+"Dim",w),this.setUniform2fv("user_"+n+"Size",A),this.setUniform1i("user_"+n,this.argumentsLength);break;case"Texture":var V=e,B=V.dimensions,j=V.size;r.activeTexture(r.TEXTURE0+this.argumentsLength),r.bindTexture(r.TEXTURE_2D,V.texture),this.setUniform3fv("user_"+n+"Dim",B),this.setUniform2fv("user_"+n+"Size",j),this.setUniform1i("user_"+n,this.argumentsLength);break;default:throw new Error("Input type not supported (WebGL): "+e)}this.argumentsLength++}},{key:"_getHeaderString",value:function(){return""}},{key:"_getTextureCoordinate",value:function(){var e=this.subKernelOutputVariableNames;return null===e||e.length<1?"in highp vec2 vTexCoord;\n":"out highp vec2 vTexCoord;\n"}},{key:"_getMainParamsString",value:function(e){for(var t=[],n=this.paramTypes,r=this.paramNames,i=0;i<r.length;i++){var s=e[i],a=r[i],o=n[i];if(this.hardcodeConstants)if("Array"===o||"Texture"===o){var h=u.getDimensions(s,!0),l=u.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},h);t.push("uniform highp sampler2D user_"+a,"highp vec2 user_"+a+"Size = vec2("+l[0]+".0, "+l[1]+".0)","highp vec3 user_"+a+"Dim = vec3("+h[0]+".0, "+h[1]+".0, "+h[2]+".0)")}else"Integer"===o?t.push("highp float user_"+a+" = "+s+".0"):"Float"===o&&t.push("highp float user_"+a+" = "+s);else"Array"===o||"Texture"===o||"Input"===o||"HTMLImage"===o?t.push("uniform highp sampler2D user_"+a,"uniform highp vec2 user_"+a+"Size","uniform highp vec3 user_"+a+"Dim"):"HTMLImageArray"===o?t.push("uniform highp sampler2DArray user_"+a,"uniform highp vec2 user_"+a+"Size","uniform highp vec3 user_"+a+"Dim"):"Integer"!==o&&"Float"!==o||t.push("uniform highp float user_"+a)}return this._linesToString(t)}},{key:"_getKernelString",value:function(){var e=[],t=this.subKernelOutputVariableNames;if(null!==t){e.push("highp float kernelResult = 0.0"),e.push("layout(location = 0) out highp vec4 data0");for(var n=0;n<t.length;n++)e.push("highp float "+t[n]+" = 0.0","layout(location = "+(n+1)+") out highp vec4 data"+(n+1))}else e.push("out highp vec4 data0"),e.push("highp float kernelResult = 0.0");return this._linesToString(e)+this.functionBuilder.getPrototypeString("kernel")}},{key:"_getMainResultString",value:function(){var e=this.subKernelOutputVariableNames,t=[];if(this.floatOutput&&t.push("  index *= 4.0"),this.graphical)t.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0 = actualColor");else if(this.floatOutput)for(var n=["r","g","b","a"],r=0;r<n.length;++r){if(t.push("  threadId = indexTo3D(index, uOutputDim)"),t.push("  kernel()"),e){t.push("  data0."+n[r]+" = kernelResult");for(var i=0;i<e.length;++i)t.push("  data"+(i+1)+"."+n[r]+" = "+e[i])}else t.push("  data0."+n[r]+" = kernelResult");r<n.length-1&&t.push("  index += 1.0")}else if(null!==e){t.push("  threadId = indexTo3D(index, uOutputDim)"),t.push("  kernel()"),t.push("  data0 = encode32(kernelResult)");for(var s=0;s<e.length;s++)t.push("  data"+(s+1)+" = encode32("+e[s]+")")}else t.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0 = encode32(kernelResult)");return this._linesToString(t)}},{key:"_addKernels",value:function(){var e=this,t=this.functionBuilder;this._webGl;t.addFunctions(this.functions,{constants:this.constants,output:this.output}),t.addNativeFunctions(this.nativeFunctions),t.addKernel(this.fnString,{prototypeOnly:!1,constants:this.constants,output:this.output,debug:this.debug,loopMaxIterations:this.loopMaxIterations},this.paramNames,this.paramTypes),null!==this.subKernels?(this.subKernelOutputTextures=[],this.subKernelOutputVariableNames=[],this.subKernels.forEach(function(t){return e._addSubKernel(t)})):null!==this.subKernelProperties&&(this.subKernelOutputTextures=[],this.subKernelOutputVariableNames=[],Object.keys(this.subKernelProperties).forEach(function(t){return e._addSubKernel(e.subKernelProperties[t])}))}},{key:"_getFragShaderString",value:function(e){return null!==this.compiledFragShaderString?this.compiledFragShaderString:this.compiledFragShaderString=this._replaceArtifacts(this.constructor.fragShaderString,this._getFragShaderArtifactMap(e))}},{key:"_getVertShaderString",value:function(e){return null!==this.compiledVertShaderString?this.compiledVertShaderString:this.compiledVertShaderString=this.constructor.vertShaderString}}],[{key:"fragShaderString",get:function(){return l}},{key:"vertShaderString",get:function(){return p}}]),t}(o)},{"../../core/texture":30,"../../core/utils":32,"../web-gl/kernel":14,"./shader-frag":23,"./shader-vert":24}],22:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("../runner-base"),u=e("./function-builder"),h=e("./kernel");t.exports=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,new u,e));return n.Kernel=h,n.kernel=null,n}return s(t,e),a(t,[{key:"getMode",value:function(){return"gpu"}}]),t}(o)},{"../runner-base":10,"./function-builder":19,"./kernel":21}],23:[function(e,t,n){t.exports="#version 300 es\n__HEADER__;\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nconst float LOOP_MAX = __LOOP_MAX__;\n#define EPSILON 0.0000001;\n\n__CONSTANTS__;\n\nin highp vec2 vTexCoord;\n\nvec2 integerMod(vec2 x, float y) {\n  vec2 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec3 integerMod(vec3 x, float y) {\n  vec3 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec4 integerMod(vec4 x, vec4 y) {\n  vec4 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nhighp float integerMod(highp float x, highp float y) {\n  highp float res = floor(mod(x, y));\n  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);\n}\n\nhighp int integerMod(highp int x, highp int y) {\n  return int(integerMod(float(x), float(y)));\n}\n\n// Here be dragons!\n// DO NOT OPTIMIZE THIS CODE\n// YOU WILL BREAK SOMETHING ON SOMEBODY'S MACHINE\n// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME\nconst vec2 MAGIC_VEC = vec2(1.0, -256.0);\nconst vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);\nconst vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536\nhighp float decode32(highp vec4 rgba) {\n  __DECODE32_ENDIANNESS__;\n  rgba *= 255.0;\n  vec2 gte128;\n  gte128.x = rgba.b >= 128.0 ? 1.0 : 0.0;\n  gte128.y = rgba.a >= 128.0 ? 1.0 : 0.0;\n  float exponent = 2.0 * rgba.a - 127.0 + dot(gte128, MAGIC_VEC);\n  float res = exp2(round(exponent));\n  rgba.b = rgba.b - 128.0 * gte128.x;\n  res = dot(rgba, SCALE_FACTOR) * exp2(round(exponent-23.0)) + res;\n  res *= gte128.y * -2.0 + 1.0;\n  return res;\n}\n\nhighp vec4 encode32(highp float f) {\n  highp float F = abs(f);\n  highp float sign = f < 0.0 ? 1.0 : 0.0;\n  highp float exponent = floor(log2(F));\n  highp float mantissa = (exp2(-exponent) * F);\n  // exponent += floor(log2(mantissa));\n  vec4 rgba = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;\n  rgba.rg = integerMod(rgba.rg, 256.0);\n  rgba.b = integerMod(rgba.b, 128.0);\n  rgba.a = exponent*0.5 + 63.5;\n  rgba.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;\n  rgba = floor(rgba);\n  rgba *= 0.003921569; // 1/255\n  __ENCODE32_ENDIANNESS__;\n  return rgba;\n}\n// Dragons end here\n\nhighp float index;\nhighp vec3 threadId;\n\nhighp vec3 indexTo3D(highp float idx, highp vec3 texDim) {\n  highp float z = floor(idx / (texDim.x * texDim.y));\n  idx -= z * texDim.x * texDim.y;\n  highp float y = floor(idx / texDim.x);\n  highp float x = integerMod(idx, texDim.x);\n  return vec3(x, y, z);\n}\n\nhighp float get(highp sampler2D tex, highp vec2 texSize, highp vec3 texDim, highp float z, highp float y, highp float x) {\n  highp vec3 xyz = vec3(x, y, z);\n  xyz = floor(xyz + 0.5);\n  __GET_WRAPAROUND__;\n  highp float index = round(xyz.x + texDim.x * (xyz.y + texDim.y * xyz.z));\n  __GET_TEXTURE_CHANNEL__;\n  highp float w = round(texSize.x);\n  vec2 st = vec2(integerMod(index, w), float(int(index) / int(w))) + 0.5;\n  __GET_TEXTURE_INDEX__;\n  highp vec4 texel = texture(tex, st / texSize);\n  __GET_RESULT__;\n}\n\nhighp vec4 getImage2D(highp sampler2D tex, highp vec2 texSize, highp vec3 texDim, highp float z, highp float y, highp float x) {\n  highp vec3 xyz = vec3(x, y, z);\n  xyz = floor(xyz + 0.5);\n  __GET_WRAPAROUND__;\n  highp float index = round(xyz.x + texDim.x * (xyz.y + texDim.y * xyz.z));\n  __GET_TEXTURE_CHANNEL__;\n  highp float w = round(texSize.x);\n  vec2 st = vec2(integerMod(index, w), float(int(index) / int(w))) + 0.5;\n  __GET_TEXTURE_INDEX__;\n  return texture(tex, st / texSize);\n}\n\nhighp vec4 getImage3D(highp sampler2DArray tex, highp vec2 texSize, highp vec3 texDim, highp float z, highp float y, highp float x) {\n  highp vec3 xyz = vec3(x, y, z);\n  xyz = floor(xyz + 0.5);\n  __GET_WRAPAROUND__;\n  highp float index = round(xyz.x + texDim.x * (xyz.y + texDim.y * xyz.z));\n  __GET_TEXTURE_CHANNEL__;\n  highp float w = round(texSize.x);\n  vec2 st = vec2(integerMod(index, w), float(int(index) / int(w))) + 0.5;\n  __GET_TEXTURE_INDEX__;\n  return texture(tex, vec3(st / texSize, z));\n}\n\nhighp float get(highp sampler2D tex, highp vec2 texSize, highp vec3 texDim, highp float y, highp float x) {\n  return get(tex, texSize, texDim, 0.0, y, x);\n}\n\nhighp vec4 getImage2D(highp sampler2D tex, highp vec2 texSize, highp vec3 texDim, highp float y, highp float x) {\n  return getImage2D(tex, texSize, texDim, 0.0, y, x);\n}\n\nhighp float get(highp sampler2D tex, highp vec2 texSize, highp vec3 texDim, highp float x) {\n  return get(tex, texSize, texDim, 0.0, 0.0, x);\n}\n\nhighp vec4 getImage2D(highp sampler2D tex, highp vec2 texSize, highp vec3 texDim, highp float x) {\n  return getImage2D(tex, texSize, texDim, 0.0, 0.0, x);\n}\n\nhighp vec4 actualColor;\nvoid color(float r, float g, float b, float a) {\n  actualColor = vec4(r,g,b,a);\n}\n\nvoid color(float r, float g, float b) {\n  color(r,g,b,1.0);\n}\n\n__MAIN_PARAMS__;\n__MAIN_CONSTANTS__;\n__KERNEL__;\n\nvoid main(void) {\n  index = floor(vTexCoord.s * float(uTexSize.x)) + floor(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;\n  __MAIN_RESULT__;\n}"},{}],24:[function(e,t,n){t.exports="#version 300 es\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nin highp vec2 aPos;\nin highp vec2 aTexCoord;\n\nout highp vec2 vTexCoord;\nuniform vec2 ratio;\n\nvoid main(void) {\n  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);\n  vTexCoord = aTexCoord;\n}"},{}],25:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./kernel"),u=e("../../core/utils");t.exports=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return s(t,e),a(t,[{key:"validateOptions",value:function(){this._webGl.getExtension("EXT_color_buffer_float"),this.texSize=u.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},this.output,!0)}}]),t}(o)},{"../../core/utils":32,"./kernel":21}],26:[function(e,t,n){var r=e("./utils");t.exports=function(e,t){var n=t.toString();return new Function("return function "+e+" ("+r.getParamNamesFromString(n).join(", ")+") {"+r.getFunctionBodyFromString(n)+"}")()}},{"./utils":32}],27:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();e("./utils-core");t.exports=function(){function e(){r(this,e)}return i(e,null,[{key:"validateKernelObj",value:function(e){if(null===e)throw"KernelObj being validated is NULL";if("string"==typeof e){try{e=JSON.parse(e)}catch(t){throw console.error(t),"Failed to convert KernelObj from JSON string"}if(null===e)throw"Invalid (NULL) KernelObj JSON string representation"}if(e.isKernelObj!==!0)throw"Failed missing isKernelObj flag check";return e}},{key:"loadKernelObj",value:function(e,t){e=validateKernelObj(e)}}]),e}()},{"./utils-core":31}],28:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./utils"),u=e("../backend/web-gl/runner"),h=e("../backend/web-gl2/runner"),l=e("../backend/cpu/runner"),p=e("../backend/web-gl/validator-kernel"),c=e("../backend/web-gl2/validator-kernel"),f=e("./gpu-core"),d=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));e=e||{},n._canvas=e.canvas||null,n._webGl=e.webGl||null;var s=e.mode,a=void 0;if(o.isWebGlSupported())a=s||"gpu";else{if(s&&"cpu"!==s)throw new Error('A requested mode of "'+s+'" and is not supported');console.warn("Warning: gpu not supported, falling back to cpu support"),a="cpu"}n.kernels=[];var f={canvas:n._canvas,webGl:n._webGl};switch(a){case"cpu":n._runner=new l(f);break;case"gpu":var d=n.getGPURunner();n._runner=new d(f);break;case"webgl2":n._runner=new h(f);break;case"webgl":n._runner=new u(f);break;case"webgl2-validator":n._runner=new h(f),n._runner.Kernel=c;break;case"webgl-validator":n._runner=new u(f),n._runner.Kernel=p;break;default:throw new Error('"'+s+'" mode is not defined')}return n}return s(t,e),a(t,[{key:"createKernel",value:function(e,t){if("undefined"==typeof e)throw"Missing fn parameter";if(!o.isFunction(e)&&"string"!=typeof e)throw"fn parameter not a function";var n=this._runner.buildKernel(e,t||{});return this._canvas||(this._canvas=n.getCanvas()),this._runner.canvas||(this._runner.canvas=n.getCanvas()),this.kernels.push(n),n}},{key:"createKernelMap",value:function(){var e=void 0,t=void 0;"function"==typeof arguments[arguments.length-2]?(e=arguments[arguments.length-2],t=arguments[arguments.length-1]):e=arguments[arguments.length-1],o.isWebGlDrawBuffersSupported()||(this._runner=new l(t));var n=this.createKernel(e,t);if(Array.isArray(arguments[0]))for(var r=arguments[0],i=0;i<r.length;i++)n.addSubKernel(r[i]);else{var s=arguments[0];for(var a in s)s.hasOwnProperty(a)&&n.addSubKernelProperty(a,s[a])}return n}},{key:"combineKernels",value:function(){var e=arguments[arguments.length-2],t=arguments[arguments.length-1];if("cpu"===this.getMode())return t;for(var n=arguments[0].getCanvas(),r=arguments[0].getWebGl(),i=0;i<arguments.length-1;i++)arguments[i].setCanvas(n).setWebGl(r).setOutputToTexture(!0);return function(){t.apply(null,arguments);var n=e.texSize,r=e.getWebGl(),i=e.threadDim,s=void 0;if(e.floatOutput)s=new Float32Array(n[0]*n[1]*4),r.readPixels(0,0,n[0],n[1],r.RGBA,r.FLOAT,s);else{var a=new Uint8Array(n[0]*n[1]*4);r.readPixels(0,0,n[0],n[1],r.RGBA,r.UNSIGNED_BYTE,a),s=new Float32Array(a.buffer)}if(s=s.subarray(0,i[0]*i[1]*i[2]),1===e.output.length)return s;if(2===e.output.length)return o.splitArray(s,e.output[0]);if(3===e.output.length){var u=o.splitArray(s,e.output[0]*e.output[1]);return u.map(function(t){return o.splitArray(t,e.output[0])})}}}},{key:"getGPURunner",value:function(){return"undefined"!=typeof WebGL2RenderingContext?h:"undefined"!=typeof WebGLRenderingContext?u:void 0}},{key:"addFunction",value:function(e,t,n){return this._runner.functionBuilder.addFunction(null,e,t,n),this}},{key:"addNativeFunction",value:function(e,t){return this._runner.functionBuilder.addNativeFunction(e,t),this}},{key:"getMode",value:function(){return this._runner.getMode()}},{key:"isWebGlSupported",value:function(){return o.isWebGlSupported()}},{key:"getCanvas",value:function(){return this._canvas}},{key:"getWebGl",value:function(){return this._webGl}}]),t}(f);Object.assign(d,f),t.exports=d},{"../backend/cpu/runner":5,"../backend/web-gl/runner":15,"../backend/web-gl/validator-kernel":18,"../backend/web-gl2/runner":22,"../backend/web-gl2/validator-kernel":25,"./gpu-core":27,"./utils":32}],29:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.exports=function i(e,t){if(r(this,i),this.value=e,Array.isArray(t)){this.size=[];for(var n=0;n<t.length;n++)this.size[n]=t[n];for(;this.size.length<3;)this.size.push(1)}else t.z?this.size=[t.x,t.y,t.z]:t.y?this.size=[t.x,t.y,1]:this.size=[t.x,1,1]}},{}],30:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.exports=function(){function e(t,n,i,s,a){r(this,e),this.texture=t,this.size=n,this.dimensions=i,this.output=s,this.webGl=a,this.kernel=null}return i(e,[{key:"toArray",value:function(e){if(!e)throw new Error("You need to pass the GPU object for toArray to work.");return this.kernel?this.kernel(this):(this.kernel=e.createKernel(function(e){return e[this.thread.z][this.thread.y][this.thread.x]}).setOutput(this.output),this.kernel(this))}},{key:"delete",value:function(){return this.webGl.deleteTexture(this.texture)}}]),e}()},{}],31:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(){function e(){r(this,e)}return i(e,null,[{key:"isCanvas",value:function(e){return null!==e&&e.nodeName&&e.getContext&&"CANVAS"===e.nodeName.toUpperCase()}},{key:"isCanvasSupported",value:function(){return a}},{key:"initCanvas",value:function(){if(!a)return null;var e=document.createElement("canvas");return e.width=2,e.height=2,e}},{key:"isWebGl",value:function(e){return e&&"function"==typeof e.getExtension}},{key:"isWebGlSupported",value:function(){return u}},{key:"isWebGlDrawBuffersSupported",value:function(){return h}},{key:"initWebGlDefaultOptions",value:function(){return{alpha:!1,depth:!1,antialias:!1}}},{key:"initWebGl",value:function(t){if(("undefined"!=typeof a||null===t)&&!a)return null;if(!e.isCanvas(t))throw new Error("Invalid canvas object - "+t);var n=t.getContext("experimental-webgl",e.initWebGlDefaultOptions())||t.getContext("webgl",e.initWebGlDefaultOptions());return n&&(n.OES_texture_float=n.getExtension("OES_texture_float"),n.OES_texture_float_linear=n.getExtension("OES_texture_float_linear"),n.OES_element_index_uint=n.getExtension("OES_element_index_uint")),n}},{key:"initWebGl2",value:function(t){if(("undefined"!=typeof a||null===t)&&!a)return null;if(!e.isCanvas(t))throw new Error("Invalid canvas object - "+t);return t.getContext("webgl2",e.initWebGlDefaultOptions())}}]),e}(),a="undefined"!=typeof document&&s.isCanvas(document.createElement("canvas")),o=s.initWebGl(s.initCanvas()),u=s.isWebGl(o),h=u&&Boolean(o.getExtension("WEBGL_draw_buffers"));u?(s.OES_texture_float=o.OES_texture_float,s.OES_texture_float_linear=o.OES_texture_float_linear,s.OES_element_index_uint=o.OES_element_index_uint):(s.OES_texture_float=!1,s.OES_texture_float_linear=!1,s.OES_element_index_uint=!1),t.exports=s},{}],32:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("./utils-core"),h=e("./input"),l=e("./texture"),p=/function ([^(]*)/,c=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,f=/([^\s,]+)/g,d=function(){var e=new ArrayBuffer(4),t=new Uint32Array(e),n=new Uint8Array(e);if(t[0]=3735928559,239===n[0])return"LE";if(222===n[0])return"BE";throw new Error("unknown endianness")}(),g=null,m=null,x=function(){try{return new Function("let i = 1; const j = 1;")(),!0}catch(e){return!1}}(),y=function(t){function n(){return r(this,n),i(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return s(n,t),o(n,null,[{key:"systemEndianness",value:function(){return d}},{key:"isFunction",value:function(e){return"function"==typeof e}},{key:"isFunctionString",value:function(e){return null!==e&&"function"===e.toString().slice(0,"function".length).toLowerCase()}},{key:"getFunctionNameFromString",value:function(e){return p.exec(e)[1]}},{key:"getFunctionBodyFromString",value:function(e){return e.substring(e.indexOf("{")+1,e.lastIndexOf("}"))}},{key:"getParamNamesFromString",value:function(e){var t=e.toString().replace(c,""),n=t.slice(t.indexOf("(")+1,t.indexOf(")")).match(f);return null===n&&(n=[]),n}},{key:"clone",value:function(e){if(null===e||"object"!==("undefined"==typeof e?"undefined":a(e))||e.hasOwnProperty("isActiveClone"))return e;var t=e.constructor();for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e.isActiveClone=null,t[r]=n.clone(e[r]),delete e.isActiveClone);return t}},{key:"newPromise",value:function(e){var t=Promise||small_promise;if(null===t)throw TypeError("Browser is missing Promise implementation. Consider adding small_promise.js polyfill");return new t(e)}},{key:"functionBinder",value:function(e,t){return e.bind?e.bind(t):function(){var n=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);return e.apply(t,n)}}},{key:"isArray",value:function(e){return!isNaN(e.length)}},{key:"getArgumentType",value:function(e){return n.isArray(e)?"IMG"===e[0].nodeName?"HTMLImageArray":"Array":"number"==typeof e?Number.isInteger(e)?"Integer":"Float":e instanceof l?"Texture":e instanceof h?"Input":"IMG"===e.nodeName?"HTMLImage":"Unknown"}},{key:"isFloatReadPixelsSupported",value:function(){if(null!==g)return g;var t=e("../index"),n=new t({mode:"webgl-validator"}).createKernel(function(){return 1},{output:[2],floatTextures:!0,floatOutput:!0,floatOutputForce:!0})();return g=1===n[0]}},{key:"isFloatReadPixelsSupportedWebGL2",value:function(){if(null!==m)return m;var t=e("../index"),n=new t({mode:"webgl2-validator"}).createKernel(function(){return 1},{output:[2],floatTextures:!0,floatOutput:!0,floatOutputForce:!0})();return m=1===n[0]}},{key:"isMixedIdentifiersSupported",value:function(){return x}},{key:"dimToTexSize",value:function(e,t,n){for(var r=t[0],i=1;i<t.length;i++)r*=t[i];!e.floatTextures||n&&!e.floatOutput||(r=Math.ceil(r/4));var s=Math.ceil(Math.sqrt(r));return[s,s]}},{key:"getDimensions",value:function(e,t){var r=void 0;if(n.isArray(e)){for(var i=[],s=e;n.isArray(s);)i.push(s.length),s=s[0];r=i.reverse()}else if(e instanceof l)r=e.output;else{if(!(e instanceof h))throw"Unknown dimensions of "+e;r=e.size}if(t)for(r=n.clone(r);r.length<3;)r.push(1);return r}},{key:"pad",value:function(e,t){function n(e){return Array.apply(null,new Array(e)).map(Number.prototype.valueOf,0)}for(var r=e.length+2*t,i=e.map(function(e){return[].concat(n(t),e,n(t))}),s=0;s<t;s++)i=[].concat([n(r)],i,[n(r)]);return i}},{key:"flatten2dArrayTo",value:function(e,t){for(var n=0,r=0;r<e.length;r++)t.set(e[r],n),n+=e[r].length}},{key:"flatten3dArrayTo",value:function(e,t){for(var n=0,r=0;r<e.length;r++)for(var i=0;i<e[r].length;i++)t.set(e[r][i],n),n+=e[r][i].length}},{key:"flattenTo",value:function(e,t){n.isArray(e[0])?n.isArray(e[0][0])?n.flatten3dArrayTo(e,t):n.flatten2dArrayTo(e,t):t.set(e)}},{key:"splitArray",value:function(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(Array.prototype.slice.call(e,r,r+t));return n}},{key:"getAstString",value:function(e,t){var n=Array.isArray(e)?e:e.split(/\r?\n/g),r=t.loc.start,i=t.loc.end,s=[];s.push(n[r.line-1].slice(r.column));for(var a=r.line;a<i.line-1;a++)s.push(n[a]);return s.push(n[i.line-1].slice(0,i.column)),s.join("\n")}},{key:"allPropertiesOf",value:function(e){var t=[];do t.push.apply(t,Object.getOwnPropertyNames(e));while(e=Object.getPrototypeOf(e));return t}}]),n}(u);Object.assign(y,u),t.exports=y},{"../index":33,"./input":29,"./texture":30,"./utils-core":31}],33:[function(e,t,n){var r=e("./core/gpu"),i=e("./core/alias"),s=e("./core/utils"),a=e("./core/input"),o=e("./core/texture"),u=e("./backend/cpu/function-builder"),h=e("./backend/cpu/function-node"),l=e("./backend/cpu/kernel"),p=e("./backend/cpu/runner"),c=e("./backend/web-gl/function-builder"),f=e("./backend/web-gl/function-node"),d=e("./backend/web-gl/kernel"),g=e("./backend/web-gl/runner"),m=e("./backend/web-gl2/function-builder"),x=e("./backend/web-gl2/function-node"),y=e("./backend/web-gl2/kernel"),v=e("./backend/web-gl2/runner");r.alias=i,r.utils=s,r.Texture=o,r.Input=a,r.input=function(e,t){return new a(e,t)},r.CPUFunctionBuilder=u,r.CPUFunctionNode=h,r.CPUKernel=l,r.CPURunner=p,r.WebGLFunctionBuilder=c,r.WebGLFunctionNode=f,r.WebGLKernel=d,r.WebGLRunner=g,r.WebGL2FunctionBuilder=m,r.WebGL2FunctionNode=x,r.WebGL2Kernel=y,r.WebGL2Runner=v,"undefined"!=typeof t&&(t.exports=r),"undefined"!=typeof window&&(window.GPU=r)},{"./backend/cpu/function-builder":1,"./backend/cpu/function-node":2,"./backend/cpu/kernel":4,"./backend/cpu/runner":5,"./backend/web-gl/function-builder":11,"./backend/web-gl/function-node":12,"./backend/web-gl/kernel":14,"./backend/web-gl/runner":15,"./backend/web-gl2/function-builder":19,"./backend/web-gl2/function-node":20,"./backend/web-gl2/kernel":21,"./backend/web-gl2/runner":22,"./core/alias":26,"./core/gpu":28,"./core/input":29,"./core/texture":30,"./core/utils":32}],34:[function(e,t,n){!function(e,r){"object"==typeof n&&"undefined"!=typeof t?r(n):"function"==typeof define&&define.amd?define(["exports"],r):r(e.acorn={})}(this,function(e){function t(e,t){for(var n=65536,r=0;r<t.length;r+=2){if(n+=t[r],n>e)return!1;if(n+=t[r+1],n>=e)return!0}}function n(e,n){return e<65?36===e:e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&U.test(String.fromCharCode(e)):n!==!1&&t(e,V)))}function r(e,n){return e<48?36===e:e<58||!(e<65)&&(e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&M.test(String.fromCharCode(e)):n!==!1&&(t(e,V)||t(e,B)))))}function i(e,t){return new j(e,{beforeExpr:!0,binop:t})}function s(e,t){return void 0===t&&(t={}),t.keyword=e,X[e]=new j(e,t)}function a(e){return 10===e||13===e||8232===e||8233===e}function o(e,t){return Z.call(e,t)}function u(e,t){for(var n=1,r=0;;){q.lastIndex=r;var i=q.exec(e);if(!(i&&i.index<t))return new te(n,t-r);++n,r=i.index+i[0].length}}function h(e){var t={};for(var n in re)t[n]=e&&o(e,n)?e[n]:re[n];if(t.ecmaVersion>=2015&&(t.ecmaVersion-=2009),null==t.allowReserved&&(t.allowReserved=t.ecmaVersion<5),ee(t.onToken)){var r=t.onToken;t.onToken=function(e){return r.push(e)}}return ee(t.onComment)&&(t.onComment=l(t,t.onComment)),t}function l(e,t){return function(n,r,i,s,a,o){var u={type:n?"Block":"Line",value:r,start:i,end:s};e.locations&&(u.loc=new ne(this,a,o)),e.ranges&&(u.range=[i,s]),t.push(u)}}function p(e){return new RegExp("^(?:"+e.replace(/ /g,"|")+")$")}function c(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}function f(e,t,n,r){return e.type=t,e.end=n,this.options.locations&&(e.loc.end=r),this.options.ranges&&(e.range[1]=n),e}function d(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode((e>>10)+55296,(1023&e)+56320))}function g(e){return 36===e||e>=40&&e<=43||46===e||63===e||e>=91&&e<=94||e>=123&&e<=125}function m(e){return n(e,!0)||36===e||95===e}function x(e){return r(e,!0)||36===e||95===e||8204===e||8205===e}function y(e){return e>=65&&e<=90||e>=97&&e<=122}function v(e){return e>=0&&e<=1114111}function b(e){return 100===e||68===e||115===e||83===e||119===e||87===e}function _(e){return y(e)||95===e}function E(e){
return _(e)||T(e)}function T(e){return e>=48&&e<=57}function S(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102}function k(e){return e>=65&&e<=70?10+(e-65):e>=97&&e<=102?10+(e-97):e-48}function w(e){return e>=48&&e<=55}function A(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode((e>>10)+55296,(1023&e)+56320))}function O(e,t){return new se(t,e).parse()}function C(e,t,n){var r=new se(n,e,t);return r.nextToken(),r.parseExpression()}function R(e,t){return new se(t,e)}function P(t,n,r){e.parse_dammit=t,e.LooseParser=n,e.pluginsLoose=r}var N={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},I="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",D={5:I,6:I+" const class extends export import super"},L=/^in(stanceof)?$/,F="--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",G="---------------------------------------------------------------------------------------------------------------------------------------------------",U=new RegExp("["+F+"]"),M=new RegExp("["+F+G+"]");F=G=null;var V=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,26,45,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,785,52,76,44,33,24,27,35,42,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,54,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,86,25,391,63,32,0,257,0,11,39,8,0,22,0,12,39,3,3,55,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,698,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,881,68,12,0,67,12,65,1,31,6124,20,754,9486,286,82,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,4149,196,60,67,1213,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42710,42,4148,12,221,3,5761,15,7472,3104,541],B=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,1306,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,52,0,13,2,49,13,10,2,4,9,83,11,7,0,161,11,6,9,7,3,57,0,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,87,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,423,9,280,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,19719,9,135,4,60,6,26,9,1016,45,17,3,19723,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,2214,6,110,6,6,9,792487,239],j=function(e,t){void 0===t&&(t={}),this.label=e,this.keyword=t.keyword,this.beforeExpr=!!t.beforeExpr,this.startsExpr=!!t.startsExpr,this.isLoop=!!t.isLoop,this.isAssign=!!t.isAssign,this.prefix=!!t.prefix,this.postfix=!!t.postfix,this.binop=t.binop||null,this.updateContext=null},z={beforeExpr:!0},K={startsExpr:!0},X={},W={num:new j("num",K),regexp:new j("regexp",K),string:new j("string",K),name:new j("name",K),eof:new j("eof"),bracketL:new j("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new j("]"),braceL:new j("{",{beforeExpr:!0,startsExpr:!0}),braceR:new j("}"),parenL:new j("(",{beforeExpr:!0,startsExpr:!0}),parenR:new j(")"),comma:new j(",",z),semi:new j(";",z),colon:new j(":",z),dot:new j("."),question:new j("?",z),arrow:new j("=>",z),template:new j("template"),invalidTemplate:new j("invalidTemplate"),ellipsis:new j("...",z),backQuote:new j("`",K),dollarBraceL:new j("${",{beforeExpr:!0,startsExpr:!0}),eq:new j("=",{beforeExpr:!0,isAssign:!0}),assign:new j("_=",{beforeExpr:!0,isAssign:!0}),incDec:new j("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new j("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:i("||",1),logicalAND:i("&&",2),bitwiseOR:i("|",3),bitwiseXOR:i("^",4),bitwiseAND:i("&",5),equality:i("==/!=/===/!==",6),relational:i("</>/<=/>=",7),bitShift:i("<</>>/>>>",8),plusMin:new j("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:i("%",10),star:i("*",10),slash:i("/",10),starstar:new j("**",{beforeExpr:!0}),_break:s("break"),_case:s("case",z),_catch:s("catch"),_continue:s("continue"),_debugger:s("debugger"),_default:s("default",z),_do:s("do",{isLoop:!0,beforeExpr:!0}),_else:s("else",z),_finally:s("finally"),_for:s("for",{isLoop:!0}),_function:s("function",K),_if:s("if"),_return:s("return",z),_switch:s("switch"),_throw:s("throw",z),_try:s("try"),_var:s("var"),_const:s("const"),_while:s("while",{isLoop:!0}),_with:s("with"),_new:s("new",{beforeExpr:!0,startsExpr:!0}),_this:s("this",K),_super:s("super",K),_class:s("class",K),_extends:s("extends",z),_export:s("export"),_import:s("import"),_null:s("null",K),_true:s("true",K),_false:s("false",K),_in:s("in",{beforeExpr:!0,binop:7}),_instanceof:s("instanceof",{beforeExpr:!0,binop:7}),_typeof:s("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:s("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:s("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},H=/\r\n?|\n|\u2028|\u2029/,q=new RegExp(H.source,"g"),Y=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,J=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Q=Object.prototype,Z=Q.hasOwnProperty,$=Q.toString,ee=Array.isArray||function(e){return"[object Array]"===$.call(e)},te=function(e,t){this.line=e,this.column=t};te.prototype.offset=function(e){return new te(this.line,this.column+e)};var ne=function(e,t,n){this.start=t,this.end=n,null!==e.sourceFile&&(this.source=e.sourceFile)},re={ecmaVersion:7,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1,plugins:{}},ie={},se=function(e,t,n){this.options=e=h(e),this.sourceFile=e.sourceFile,this.keywords=p(D[e.ecmaVersion>=6?6:5]);var r="";if(!e.allowReserved){for(var i=e.ecmaVersion;!(r=N[i]);i--);"module"==e.sourceType&&(r+=" await")}this.reservedWords=p(r);var s=(r?r+" ":"")+N.strict;this.reservedWordsStrict=p(s),this.reservedWordsStrictBind=p(s+" "+N.strictBind),this.input=String(t),this.containsEsc=!1,this.loadPlugins(e.plugins),n?(this.pos=n,this.lineStart=this.input.lastIndexOf("\n",n-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(H).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=W.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===e.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.inFunction=this.inGenerator=this.inAsync=!1,this.yieldPos=this.awaitPos=0,this.labels=[],0===this.pos&&e.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterFunctionScope(),this.regexpState=null};se.prototype.isKeyword=function(e){return this.keywords.test(e)},se.prototype.isReservedWord=function(e){return this.reservedWords.test(e)},se.prototype.extend=function(e,t){this[e]=t(this[e])},se.prototype.loadPlugins=function(e){var t=this;for(var n in e){var r=ie[n];if(!r)throw new Error("Plugin '"+n+"' not found");r(t,e[n])}},se.prototype.parse=function(){var e=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(e)};var ae=se.prototype,oe=/^(?:'((?:\\.|[^'])*?)'|"((?:\\.|[^"])*?)"|;)/;ae.strictDirective=function(e){for(var t=this;;){J.lastIndex=e,e+=J.exec(t.input)[0].length;var n=oe.exec(t.input.slice(e));if(!n)return!1;if("use strict"==(n[1]||n[2]))return!0;e+=n[0].length}},ae.eat=function(e){return this.type===e&&(this.next(),!0)},ae.isContextual=function(e){return this.type===W.name&&this.value===e&&!this.containsEsc},ae.eatContextual=function(e){return!!this.isContextual(e)&&(this.next(),!0)},ae.expectContextual=function(e){this.eatContextual(e)||this.unexpected()},ae.canInsertSemicolon=function(){return this.type===W.eof||this.type===W.braceR||H.test(this.input.slice(this.lastTokEnd,this.start))},ae.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},ae.semicolon=function(){this.eat(W.semi)||this.insertSemicolon()||this.unexpected()},ae.afterTrailingComma=function(e,t){if(this.type==e)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),t||this.next(),!0},ae.expect=function(e){this.eat(e)||this.unexpected()},ae.unexpected=function(e){this.raise(null!=e?e:this.start,"Unexpected token")},ae.checkPatternErrors=function(e,t){if(e){e.trailingComma>-1&&this.raiseRecoverable(e.trailingComma,"Comma is not permitted after the rest element");var n=t?e.parenthesizedAssign:e.parenthesizedBind;n>-1&&this.raiseRecoverable(n,"Parenthesized pattern")}},ae.checkExpressionErrors=function(e,t){if(!e)return!1;var n=e.shorthandAssign,r=e.doubleProto;return t?(n>=0&&this.raise(n,"Shorthand property assignments are valid only in destructuring patterns"),void(r>=0&&this.raiseRecoverable(r,"Redefinition of __proto__ property"))):n>=0||r>=0},ae.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},ae.isSimpleAssignTarget=function(e){return"ParenthesizedExpression"===e.type?this.isSimpleAssignTarget(e.expression):"Identifier"===e.type||"MemberExpression"===e.type};var ue=se.prototype;ue.parseTopLevel=function(e){var t=this,n={};for(e.body||(e.body=[]);this.type!==W.eof;){var r=t.parseStatement(!0,!0,n);e.body.push(r)}return this.adaptDirectivePrologue(e.body),this.next(),this.options.ecmaVersion>=6&&(e.sourceType=this.options.sourceType),this.finishNode(e,"Program")};var he={kind:"loop"},le={kind:"switch"};ue.isLet=function(){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;J.lastIndex=this.pos;var e=J.exec(this.input),t=this.pos+e[0].length,i=this.input.charCodeAt(t);if(91===i||123==i)return!0;if(n(i,!0)){for(var s=t+1;r(this.input.charCodeAt(s),!0);)++s;var a=this.input.slice(t,s);if(!L.test(a))return!0}return!1},ue.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;J.lastIndex=this.pos;var e=J.exec(this.input),t=this.pos+e[0].length;return!(H.test(this.input.slice(this.pos,t))||"function"!==this.input.slice(t,t+8)||t+8!=this.input.length&&r(this.input.charAt(t+8)))},ue.parseStatement=function(e,t,n){var r,i=this.type,s=this.startNode();switch(this.isLet()&&(i=W._var,r="let"),i){case W._break:case W._continue:return this.parseBreakContinueStatement(s,i.keyword);case W._debugger:return this.parseDebuggerStatement(s);case W._do:return this.parseDoStatement(s);case W._for:return this.parseForStatement(s);case W._function:return!e&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(s,!1);case W._class:return e||this.unexpected(),this.parseClass(s,!0);case W._if:return this.parseIfStatement(s);case W._return:return this.parseReturnStatement(s);case W._switch:return this.parseSwitchStatement(s);case W._throw:return this.parseThrowStatement(s);case W._try:return this.parseTryStatement(s);case W._const:case W._var:return r=r||this.value,e||"var"==r||this.unexpected(),this.parseVarStatement(s,r);case W._while:return this.parseWhileStatement(s);case W._with:return this.parseWithStatement(s);case W.braceL:return this.parseBlock();case W.semi:return this.parseEmptyStatement(s);case W._export:case W._import:return this.options.allowImportExportEverywhere||(t||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===W._import?this.parseImport(s):this.parseExport(s,n);default:if(this.isAsyncFunction())return e||this.unexpected(),this.next(),this.parseFunctionStatement(s,!0);var a=this.value,o=this.parseExpression();return i===W.name&&"Identifier"===o.type&&this.eat(W.colon)?this.parseLabeledStatement(s,a,o):this.parseExpressionStatement(s,o)}},ue.parseBreakContinueStatement=function(e,t){var n=this,r="break"==t;this.next(),this.eat(W.semi)||this.insertSemicolon()?e.label=null:this.type!==W.name?this.unexpected():(e.label=this.parseIdent(),this.semicolon());for(var i=0;i<this.labels.length;++i){var s=n.labels[i];if(null==e.label||s.name===e.label.name){if(null!=s.kind&&(r||"loop"===s.kind))break;if(e.label&&r)break}}return i===this.labels.length&&this.raise(e.start,"Unsyntactic "+t),this.finishNode(e,r?"BreakStatement":"ContinueStatement")},ue.parseDebuggerStatement=function(e){return this.next(),this.semicolon(),this.finishNode(e,"DebuggerStatement")},ue.parseDoStatement=function(e){return this.next(),this.labels.push(he),e.body=this.parseStatement(!1),this.labels.pop(),this.expect(W._while),e.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(W.semi):this.semicolon(),this.finishNode(e,"DoWhileStatement")},ue.parseForStatement=function(e){this.next();var t=this.options.ecmaVersion>=9&&this.inAsync&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(he),this.enterLexicalScope(),this.expect(W.parenL),this.type===W.semi)return t>-1&&this.unexpected(t),this.parseFor(e,null);var n=this.isLet();if(this.type===W._var||this.type===W._const||n){var r=this.startNode(),i=n?"let":this.value;return this.next(),this.parseVar(r,!0,i),this.finishNode(r,"VariableDeclaration"),!(this.type===W._in||this.options.ecmaVersion>=6&&this.isContextual("of"))||1!==r.declarations.length||"var"!==i&&r.declarations[0].init?(t>-1&&this.unexpected(t),this.parseFor(e,r)):(this.options.ecmaVersion>=9&&(this.type===W._in?t>-1&&this.unexpected(t):e.await=t>-1),this.parseForIn(e,r))}var s=new c,a=this.parseExpression(!0,s);return this.type===W._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===W._in?t>-1&&this.unexpected(t):e.await=t>-1),this.toAssignable(a,!1,s),this.checkLVal(a),this.parseForIn(e,a)):(this.checkExpressionErrors(s,!0),t>-1&&this.unexpected(t),this.parseFor(e,a))},ue.parseFunctionStatement=function(e,t){return this.next(),this.parseFunction(e,!0,!1,t)},ue.parseIfStatement=function(e){return this.next(),e.test=this.parseParenExpression(),e.consequent=this.parseStatement(!this.strict&&this.type==W._function),e.alternate=this.eat(W._else)?this.parseStatement(!this.strict&&this.type==W._function):null,this.finishNode(e,"IfStatement")},ue.parseReturnStatement=function(e){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(W.semi)||this.insertSemicolon()?e.argument=null:(e.argument=this.parseExpression(),this.semicolon()),this.finishNode(e,"ReturnStatement")},ue.parseSwitchStatement=function(e){var t=this;this.next(),e.discriminant=this.parseParenExpression(),e.cases=[],this.expect(W.braceL),this.labels.push(le),this.enterLexicalScope();for(var n,r=!1;this.type!=W.braceR;)if(t.type===W._case||t.type===W._default){var i=t.type===W._case;n&&t.finishNode(n,"SwitchCase"),e.cases.push(n=t.startNode()),n.consequent=[],t.next(),i?n.test=t.parseExpression():(r&&t.raiseRecoverable(t.lastTokStart,"Multiple default clauses"),r=!0,n.test=null),t.expect(W.colon)}else n||t.unexpected(),n.consequent.push(t.parseStatement(!0));return this.exitLexicalScope(),n&&this.finishNode(n,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(e,"SwitchStatement")},ue.parseThrowStatement=function(e){return this.next(),H.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),e.argument=this.parseExpression(),this.semicolon(),this.finishNode(e,"ThrowStatement")};var pe=[];ue.parseTryStatement=function(e){if(this.next(),e.block=this.parseBlock(),e.handler=null,this.type===W._catch){var t=this.startNode();this.next(),this.expect(W.parenL),t.param=this.parseBindingAtom(),this.enterLexicalScope(),this.checkLVal(t.param,"let"),this.expect(W.parenR),t.body=this.parseBlock(!1),this.exitLexicalScope(),e.handler=this.finishNode(t,"CatchClause")}return e.finalizer=this.eat(W._finally)?this.parseBlock():null,e.handler||e.finalizer||this.raise(e.start,"Missing catch or finally clause"),this.finishNode(e,"TryStatement")},ue.parseVarStatement=function(e,t){return this.next(),this.parseVar(e,!1,t),this.semicolon(),this.finishNode(e,"VariableDeclaration")},ue.parseWhileStatement=function(e){return this.next(),e.test=this.parseParenExpression(),this.labels.push(he),e.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(e,"WhileStatement")},ue.parseWithStatement=function(e){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),e.object=this.parseParenExpression(),e.body=this.parseStatement(!1),this.finishNode(e,"WithStatement")},ue.parseEmptyStatement=function(e){return this.next(),this.finishNode(e,"EmptyStatement")},ue.parseLabeledStatement=function(e,t,n){for(var r=this,i=0,s=r.labels;i<s.length;i+=1){var a=s[i];a.name===t&&r.raise(n.start,"Label '"+t+"' is already declared")}for(var o=this.type.isLoop?"loop":this.type===W._switch?"switch":null,u=this.labels.length-1;u>=0;u--){var h=r.labels[u];if(h.statementStart!=e.start)break;h.statementStart=r.start,h.kind=o}return this.labels.push({name:t,kind:o,statementStart:this.start}),e.body=this.parseStatement(!0),("ClassDeclaration"==e.body.type||"VariableDeclaration"==e.body.type&&"var"!=e.body.kind||"FunctionDeclaration"==e.body.type&&(this.strict||e.body.generator))&&this.raiseRecoverable(e.body.start,"Invalid labeled declaration"),this.labels.pop(),e.label=n,this.finishNode(e,"LabeledStatement")},ue.parseExpressionStatement=function(e,t){return e.expression=t,this.semicolon(),this.finishNode(e,"ExpressionStatement")},ue.parseBlock=function(e){var t=this;void 0===e&&(e=!0);var n=this.startNode();for(n.body=[],this.expect(W.braceL),e&&this.enterLexicalScope();!this.eat(W.braceR);){var r=t.parseStatement(!0);n.body.push(r)}return e&&this.exitLexicalScope(),this.finishNode(n,"BlockStatement")},ue.parseFor=function(e,t){return e.init=t,this.expect(W.semi),e.test=this.type===W.semi?null:this.parseExpression(),this.expect(W.semi),e.update=this.type===W.parenR?null:this.parseExpression(),this.expect(W.parenR),this.exitLexicalScope(),e.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(e,"ForStatement")},ue.parseForIn=function(e,t){var n=this.type===W._in?"ForInStatement":"ForOfStatement";return this.next(),"ForInStatement"==n&&("AssignmentPattern"===t.type||"VariableDeclaration"===t.type&&null!=t.declarations[0].init&&(this.strict||"Identifier"!==t.declarations[0].id.type))&&this.raise(t.start,"Invalid assignment in for-in loop head"),e.left=t,e.right="ForInStatement"==n?this.parseExpression():this.parseMaybeAssign(),this.expect(W.parenR),this.exitLexicalScope(),e.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(e,n)},ue.parseVar=function(e,t,n){var r=this;for(e.declarations=[],e.kind=n;;){var i=r.startNode();if(r.parseVarId(i,n),r.eat(W.eq)?i.init=r.parseMaybeAssign(t):"const"!==n||r.type===W._in||r.options.ecmaVersion>=6&&r.isContextual("of")?"Identifier"==i.id.type||t&&(r.type===W._in||r.isContextual("of"))?i.init=null:r.raise(r.lastTokEnd,"Complex binding patterns require an initialization value"):r.unexpected(),e.declarations.push(r.finishNode(i,"VariableDeclarator")),!r.eat(W.comma))break}return e},ue.parseVarId=function(e,t){e.id=this.parseBindingAtom(t),this.checkLVal(e.id,t,!1)},ue.parseFunction=function(e,t,n,r){this.initFunction(e),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!r)&&(e.generator=this.eat(W.star)),this.options.ecmaVersion>=8&&(e.async=!!r),t&&(e.id="nullableID"===t&&this.type!=W.name?null:this.parseIdent(),e.id&&this.checkLVal(e.id,"var"));var i=this.inGenerator,s=this.inAsync,a=this.yieldPos,o=this.awaitPos,u=this.inFunction;return this.inGenerator=e.generator,this.inAsync=e.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,this.enterFunctionScope(),t||(e.id=this.type==W.name?this.parseIdent():null),this.parseFunctionParams(e),this.parseFunctionBody(e,n),this.inGenerator=i,this.inAsync=s,this.yieldPos=a,this.awaitPos=o,this.inFunction=u,this.finishNode(e,t?"FunctionDeclaration":"FunctionExpression")},ue.parseFunctionParams=function(e){this.expect(W.parenL),e.params=this.parseBindingList(W.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},ue.parseClass=function(e,t){var n=this;this.next(),this.parseClassId(e,t),this.parseClassSuper(e);var r=this.startNode(),i=!1;for(r.body=[],this.expect(W.braceL);!this.eat(W.braceR);){var s=n.parseClassMember(r);s&&"MethodDefinition"===s.type&&"constructor"===s.kind&&(i&&n.raise(s.start,"Duplicate constructor in the same class"),i=!0)}return e.body=this.finishNode(r,"ClassBody"),this.finishNode(e,t?"ClassDeclaration":"ClassExpression")},ue.parseClassMember=function(e){var t=this;if(this.eat(W.semi))return null;var n=this.startNode(),r=function(e,r){void 0===r&&(r=!1);var i=t.start,s=t.startLoc;return!!t.eatContextual(e)&&(!(t.type===W.parenL||r&&t.canInsertSemicolon())||(n.key&&t.unexpected(),n.computed=!1,n.key=t.startNodeAt(i,s),n.key.name=e,t.finishNode(n.key,"Identifier"),!1))};n.kind="method",n["static"]=r("static");var i=this.eat(W.star),s=!1;i||(this.options.ecmaVersion>=8&&r("async",!0)?(s=!0,i=this.options.ecmaVersion>=9&&this.eat(W.star)):r("get")?n.kind="get":r("set")&&(n.kind="set")),n.key||this.parsePropertyName(n);var a=n.key;return n.computed||n["static"]||!("Identifier"===a.type&&"constructor"===a.name||"Literal"===a.type&&"constructor"===a.value)?n["static"]&&"Identifier"===a.type&&"prototype"===a.name&&this.raise(a.start,"Classes may not have a static property named prototype"):("method"!==n.kind&&this.raise(a.start,"Constructor can't have get/set modifier"),i&&this.raise(a.start,"Constructor can't be a generator"),s&&this.raise(a.start,"Constructor can't be an async method"),n.kind="constructor"),this.parseClassMethod(e,n,i,s),"get"===n.kind&&0!==n.value.params.length&&this.raiseRecoverable(n.value.start,"getter should have no params"),"set"===n.kind&&1!==n.value.params.length&&this.raiseRecoverable(n.value.start,"setter should have exactly one param"),"set"===n.kind&&"RestElement"===n.value.params[0].type&&this.raiseRecoverable(n.value.params[0].start,"Setter cannot use rest params"),n},ue.parseClassMethod=function(e,t,n,r){t.value=this.parseMethod(n,r),e.body.push(this.finishNode(t,"MethodDefinition"))},ue.parseClassId=function(e,t){e.id=this.type===W.name?this.parseIdent():t===!0?this.unexpected():null},ue.parseClassSuper=function(e){e.superClass=this.eat(W._extends)?this.parseExprSubscripts():null},ue.parseExport=function(e,t){var n=this;if(this.next(),this.eat(W.star))return this.expectContextual("from"),this.type!==W.string&&this.unexpected(),e.source=this.parseExprAtom(),this.semicolon(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(W._default)){this.checkExport(t,"default",this.lastTokStart);var r;if(this.type===W._function||(r=this.isAsyncFunction())){var i=this.startNode();this.next(),r&&this.next(),e.declaration=this.parseFunction(i,"nullableID",!1,r)}else if(this.type===W._class){var s=this.startNode();e.declaration=this.parseClass(s,"nullableID")}else e.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(e,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())e.declaration=this.parseStatement(!0),"VariableDeclaration"===e.declaration.type?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id.name,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual("from"))this.type!==W.string&&this.unexpected(),e.source=this.parseExprAtom();else{for(var a=0,o=e.specifiers;a<o.length;a+=1){var u=o[a];n.checkUnreserved(u.local)}e.source=null}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")},ue.checkExport=function(e,t,n){e&&(o(e,t)&&this.raiseRecoverable(n,"Duplicate export '"+t+"'"),e[t]=!0)},ue.checkPatternExport=function(e,t){var n=this,r=t.type;if("Identifier"==r)this.checkExport(e,t.name,t.start);else if("ObjectPattern"==r)for(var i=0,s=t.properties;i<s.length;i+=1){var a=s[i];n.checkPatternExport(e,a)}else if("ArrayPattern"==r)for(var o=0,u=t.elements;o<u.length;o+=1){var h=u[o];h&&n.checkPatternExport(e,h)}else"Property"==r?this.checkPatternExport(e,t.value):"AssignmentPattern"==r?this.checkPatternExport(e,t.left):"RestElement"==r?this.checkPatternExport(e,t.argument):"ParenthesizedExpression"==r&&this.checkPatternExport(e,t.expression)},ue.checkVariableExport=function(e,t){var n=this;if(e)for(var r=0,i=t;r<i.length;r+=1){var s=i[r];n.checkPatternExport(e,s.id)}},ue.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},ue.parseExportSpecifiers=function(e){var t=this,n=[],r=!0;for(this.expect(W.braceL);!this.eat(W.braceR);){if(r)r=!1;else if(t.expect(W.comma),t.afterTrailingComma(W.braceR))break;var i=t.startNode();i.local=t.parseIdent(!0),i.exported=t.eatContextual("as")?t.parseIdent(!0):i.local,t.checkExport(e,i.exported.name,i.exported.start),n.push(t.finishNode(i,"ExportSpecifier"))}return n},ue.parseImport=function(e){return this.next(),this.type===W.string?(e.specifiers=pe,e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===W.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(e,"ImportDeclaration")},ue.parseImportSpecifiers=function(){var e=this,t=[],n=!0;if(this.type===W.name){var r=this.startNode();if(r.local=this.parseIdent(),this.checkLVal(r.local,"let"),t.push(this.finishNode(r,"ImportDefaultSpecifier")),!this.eat(W.comma))return t}if(this.type===W.star){var i=this.startNode();return this.next(),this.expectContextual("as"),i.local=this.parseIdent(),this.checkLVal(i.local,"let"),t.push(this.finishNode(i,"ImportNamespaceSpecifier")),t}for(this.expect(W.braceL);!this.eat(W.braceR);){if(n)n=!1;else if(e.expect(W.comma),e.afterTrailingComma(W.braceR))break;var s=e.startNode();s.imported=e.parseIdent(!0),e.eatContextual("as")?s.local=e.parseIdent():(e.checkUnreserved(s.imported),s.local=s.imported),e.checkLVal(s.local,"let"),t.push(e.finishNode(s,"ImportSpecifier"))}return t},ue.adaptDirectivePrologue=function(e){for(var t=0;t<e.length&&this.isDirectiveCandidate(e[t]);++t)e[t].directive=e[t].expression.raw.slice(1,-1)},ue.isDirectiveCandidate=function(e){return"ExpressionStatement"===e.type&&"Literal"===e.expression.type&&"string"==typeof e.expression.value&&('"'===this.input[e.start]||"'"===this.input[e.start])};var ce=se.prototype;ce.toAssignable=function(e,t,n){var r=this;if(this.options.ecmaVersion>=6&&e)switch(e.type){case"Identifier":this.inAsync&&"await"===e.name&&this.raise(e.start,"Can not use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":e.type="ObjectPattern",n&&this.checkPatternErrors(n,!0);for(var i=0,s=e.properties;i<s.length;i+=1){var a=s[i];r.toAssignable(a,t),"RestElement"!==a.type||"ArrayPattern"!==a.argument.type&&"ObjectPattern"!==a.argument.type||r.raise(a.argument.start,"Unexpected token")}break;case"Property":"init"!==e.kind&&this.raise(e.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(e.value,t);break;case"ArrayExpression":e.type="ArrayPattern",n&&this.checkPatternErrors(n,!0),this.toAssignableList(e.elements,t);break;case"SpreadElement":e.type="RestElement",this.toAssignable(e.argument,t),"AssignmentPattern"===e.argument.type&&this.raise(e.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":"="!==e.operator&&this.raise(e.left.end,"Only '=' operator can be used for specifying default value."),e.type="AssignmentPattern",delete e.operator,this.toAssignable(e.left,t);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(e.expression,t);break;case"MemberExpression":if(!t)break;default:this.raise(e.start,"Assigning to rvalue")}else n&&this.checkPatternErrors(n,!0);return e},ce.toAssignableList=function(e,t){for(var n=this,r=e.length,i=0;i<r;i++){var s=e[i];s&&n.toAssignable(s,t)}if(r){var a=e[r-1];6===this.options.ecmaVersion&&t&&a&&"RestElement"===a.type&&"Identifier"!==a.argument.type&&this.unexpected(a.argument.start)}return e},ce.parseSpread=function(e){var t=this.startNode();return this.next(),t.argument=this.parseMaybeAssign(!1,e),this.finishNode(t,"SpreadElement")},ce.parseRestBinding=function(){var e=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==W.name&&this.unexpected(),e.argument=this.parseBindingAtom(),this.finishNode(e,"RestElement")},ce.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case W.bracketL:var e=this.startNode();return this.next(),e.elements=this.parseBindingList(W.bracketR,!0,!0),this.finishNode(e,"ArrayPattern");case W.braceL:return this.parseObj(!0)}return this.parseIdent()},ce.parseBindingList=function(e,t,n){for(var r=this,i=[],s=!0;!this.eat(e);)if(s?s=!1:r.expect(W.comma),t&&r.type===W.comma)i.push(null);else{if(n&&r.afterTrailingComma(e))break;if(r.type===W.ellipsis){var a=r.parseRestBinding();r.parseBindingListItem(a),i.push(a),r.type===W.comma&&r.raise(r.start,"Comma is not permitted after the rest element"),r.expect(e);break}var o=r.parseMaybeDefault(r.start,r.startLoc);r.parseBindingListItem(o),i.push(o)}return i},ce.parseBindingListItem=function(e){return e},ce.parseMaybeDefault=function(e,t,n){if(n=n||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(W.eq))return n;var r=this.startNodeAt(e,t);return r.left=n,r.right=this.parseMaybeAssign(),this.finishNode(r,"AssignmentPattern")},ce.checkLVal=function(e,t,n){
var r=this;switch(e.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(e.name)&&this.raiseRecoverable(e.start,(t?"Binding ":"Assigning to ")+e.name+" in strict mode"),n&&(o(n,e.name)&&this.raiseRecoverable(e.start,"Argument name clash"),n[e.name]=!0),t&&"none"!==t&&(("var"===t&&!this.canDeclareVarName(e.name)||"var"!==t&&!this.canDeclareLexicalName(e.name))&&this.raiseRecoverable(e.start,"Identifier '"+e.name+"' has already been declared"),"var"===t?this.declareVarName(e.name):this.declareLexicalName(e.name));break;case"MemberExpression":t&&this.raiseRecoverable(e.start,"Binding member expression");break;case"ObjectPattern":for(var i=0,s=e.properties;i<s.length;i+=1){var a=s[i];r.checkLVal(a,t,n)}break;case"Property":this.checkLVal(e.value,t,n);break;case"ArrayPattern":for(var u=0,h=e.elements;u<h.length;u+=1){var l=h[u];l&&r.checkLVal(l,t,n)}break;case"AssignmentPattern":this.checkLVal(e.left,t,n);break;case"RestElement":this.checkLVal(e.argument,t,n);break;case"ParenthesizedExpression":this.checkLVal(e.expression,t,n);break;default:this.raise(e.start,(t?"Binding":"Assigning to")+" rvalue")}};var fe=se.prototype;fe.checkPropClash=function(e,t,n){if(!(this.options.ecmaVersion>=9&&"SpreadElement"===e.type||this.options.ecmaVersion>=6&&(e.computed||e.method||e.shorthand))){var r,i=e.key;switch(i.type){case"Identifier":r=i.name;break;case"Literal":r=String(i.value);break;default:return}var s=e.kind;if(this.options.ecmaVersion>=6)return void("__proto__"===r&&"init"===s&&(t.proto&&(n&&n.doubleProto<0?n.doubleProto=i.start:this.raiseRecoverable(i.start,"Redefinition of __proto__ property")),t.proto=!0));r="$"+r;var a=t[r];if(a){var o;o="init"===s?this.strict&&a.init||a.get||a.set:a.init||a[s],o&&this.raiseRecoverable(i.start,"Redefinition of property")}else a=t[r]={init:!1,get:!1,set:!1};a[s]=!0}},fe.parseExpression=function(e,t){var n=this,r=this.start,i=this.startLoc,s=this.parseMaybeAssign(e,t);if(this.type===W.comma){var a=this.startNodeAt(r,i);for(a.expressions=[s];this.eat(W.comma);)a.expressions.push(n.parseMaybeAssign(e,t));return this.finishNode(a,"SequenceExpression")}return s},fe.parseMaybeAssign=function(e,t,n){if(this.inGenerator&&this.isContextual("yield"))return this.parseYield();var r=!1,i=-1,s=-1;t?(i=t.parenthesizedAssign,s=t.trailingComma,t.parenthesizedAssign=t.trailingComma=-1):(t=new c,r=!0);var a=this.start,o=this.startLoc;this.type!=W.parenL&&this.type!=W.name||(this.potentialArrowAt=this.start);var u=this.parseMaybeConditional(e,t);if(n&&(u=n.call(this,u,a,o)),this.type.isAssign){var h=this.startNodeAt(a,o);return h.operator=this.value,h.left=this.type===W.eq?this.toAssignable(u,!1,t):u,r||c.call(t),t.shorthandAssign=-1,this.checkLVal(u),this.next(),h.right=this.parseMaybeAssign(e),this.finishNode(h,"AssignmentExpression")}return r&&this.checkExpressionErrors(t,!0),i>-1&&(t.parenthesizedAssign=i),s>-1&&(t.trailingComma=s),u},fe.parseMaybeConditional=function(e,t){var n=this.start,r=this.startLoc,i=this.parseExprOps(e,t);if(this.checkExpressionErrors(t))return i;if(this.eat(W.question)){var s=this.startNodeAt(n,r);return s.test=i,s.consequent=this.parseMaybeAssign(),this.expect(W.colon),s.alternate=this.parseMaybeAssign(e),this.finishNode(s,"ConditionalExpression")}return i},fe.parseExprOps=function(e,t){var n=this.start,r=this.startLoc,i=this.parseMaybeUnary(t,!1);return this.checkExpressionErrors(t)?i:i.start==n&&"ArrowFunctionExpression"===i.type?i:this.parseExprOp(i,n,r,-1,e)},fe.parseExprOp=function(e,t,n,r,i){var s=this.type.binop;if(null!=s&&(!i||this.type!==W._in)&&s>r){var a=this.type===W.logicalOR||this.type===W.logicalAND,o=this.value;this.next();var u=this.start,h=this.startLoc,l=this.parseExprOp(this.parseMaybeUnary(null,!1),u,h,s,i),p=this.buildBinary(t,n,e,l,o,a);return this.parseExprOp(p,t,n,r,i)}return e},fe.buildBinary=function(e,t,n,r,i,s){var a=this.startNodeAt(e,t);return a.left=n,a.operator=i,a.right=r,this.finishNode(a,s?"LogicalExpression":"BinaryExpression")},fe.parseMaybeUnary=function(e,t){var n,r=this,i=this.start,s=this.startLoc;if(this.inAsync&&this.isContextual("await"))n=this.parseAwait(),t=!0;else if(this.type.prefix){var a=this.startNode(),o=this.type===W.incDec;a.operator=this.value,a.prefix=!0,this.next(),a.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(e,!0),o?this.checkLVal(a.argument):this.strict&&"delete"===a.operator&&"Identifier"===a.argument.type?this.raiseRecoverable(a.start,"Deleting local variable in strict mode"):t=!0,n=this.finishNode(a,o?"UpdateExpression":"UnaryExpression")}else{if(n=this.parseExprSubscripts(e),this.checkExpressionErrors(e))return n;for(;this.type.postfix&&!this.canInsertSemicolon();){var u=r.startNodeAt(i,s);u.operator=r.value,u.prefix=!1,u.argument=n,r.checkLVal(n),r.next(),n=r.finishNode(u,"UpdateExpression")}}return!t&&this.eat(W.starstar)?this.buildBinary(i,s,n,this.parseMaybeUnary(null,!1),"**",!1):n},fe.parseExprSubscripts=function(e){var t=this.start,n=this.startLoc,r=this.parseExprAtom(e),i="ArrowFunctionExpression"===r.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd);if(this.checkExpressionErrors(e)||i)return r;var s=this.parseSubscripts(r,t,n);return e&&"MemberExpression"===s.type&&(e.parenthesizedAssign>=s.start&&(e.parenthesizedAssign=-1),e.parenthesizedBind>=s.start&&(e.parenthesizedBind=-1)),s},fe.parseSubscripts=function(e,t,n,r){for(var i=this,s=this.options.ecmaVersion>=8&&"Identifier"===e.type&&"async"===e.name&&this.lastTokEnd==e.end&&!this.canInsertSemicolon()&&"async"===this.input.slice(e.start,e.end),a=void 0;;)if((a=i.eat(W.bracketL))||i.eat(W.dot)){var o=i.startNodeAt(t,n);o.object=e,o.property=a?i.parseExpression():i.parseIdent(!0),o.computed=!!a,a&&i.expect(W.bracketR),e=i.finishNode(o,"MemberExpression")}else if(!r&&i.eat(W.parenL)){var u=new c,h=i.yieldPos,l=i.awaitPos;i.yieldPos=0,i.awaitPos=0;var p=i.parseExprList(W.parenR,i.options.ecmaVersion>=8,!1,u);if(s&&!i.canInsertSemicolon()&&i.eat(W.arrow))return i.checkPatternErrors(u,!1),i.checkYieldAwaitInDefaultParams(),i.yieldPos=h,i.awaitPos=l,i.parseArrowExpression(i.startNodeAt(t,n),p,!0);i.checkExpressionErrors(u,!0),i.yieldPos=h||i.yieldPos,i.awaitPos=l||i.awaitPos;var f=i.startNodeAt(t,n);f.callee=e,f.arguments=p,e=i.finishNode(f,"CallExpression")}else{if(i.type!==W.backQuote)return e;var d=i.startNodeAt(t,n);d.tag=e,d.quasi=i.parseTemplate({isTagged:!0}),e=i.finishNode(d,"TaggedTemplateExpression")}},fe.parseExprAtom=function(e){var t,n=this.potentialArrowAt==this.start;switch(this.type){case W._super:return this.inFunction||this.raise(this.start,"'super' outside of function or class"),t=this.startNode(),this.next(),this.type!==W.dot&&this.type!==W.bracketL&&this.type!==W.parenL&&this.unexpected(),this.finishNode(t,"Super");case W._this:return t=this.startNode(),this.next(),this.finishNode(t,"ThisExpression");case W.name:var r=this.start,i=this.startLoc,s=this.containsEsc,a=this.parseIdent(this.type!==W.name);if(this.options.ecmaVersion>=8&&!s&&"async"===a.name&&!this.canInsertSemicolon()&&this.eat(W._function))return this.parseFunction(this.startNodeAt(r,i),!1,!1,!0);if(n&&!this.canInsertSemicolon()){if(this.eat(W.arrow))return this.parseArrowExpression(this.startNodeAt(r,i),[a],!1);if(this.options.ecmaVersion>=8&&"async"===a.name&&this.type===W.name&&!s)return a=this.parseIdent(),!this.canInsertSemicolon()&&this.eat(W.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(r,i),[a],!0)}return a;case W.regexp:var o=this.value;return t=this.parseLiteral(o.value),t.regex={pattern:o.pattern,flags:o.flags},t;case W.num:case W.string:return this.parseLiteral(this.value);case W._null:case W._true:case W._false:return t=this.startNode(),t.value=this.type===W._null?null:this.type===W._true,t.raw=this.type.keyword,this.next(),this.finishNode(t,"Literal");case W.parenL:var u=this.start,h=this.parseParenAndDistinguishExpression(n);return e&&(e.parenthesizedAssign<0&&!this.isSimpleAssignTarget(h)&&(e.parenthesizedAssign=u),e.parenthesizedBind<0&&(e.parenthesizedBind=u)),h;case W.bracketL:return t=this.startNode(),this.next(),t.elements=this.parseExprList(W.bracketR,!0,!0,e),this.finishNode(t,"ArrayExpression");case W.braceL:return this.parseObj(!1,e);case W._function:return t=this.startNode(),this.next(),this.parseFunction(t,!1);case W._class:return this.parseClass(this.startNode(),!1);case W._new:return this.parseNew();case W.backQuote:return this.parseTemplate();default:this.unexpected()}},fe.parseLiteral=function(e){var t=this.startNode();return t.value=e,t.raw=this.input.slice(this.start,this.end),this.next(),this.finishNode(t,"Literal")},fe.parseParenExpression=function(){this.expect(W.parenL);var e=this.parseExpression();return this.expect(W.parenR),e},fe.parseParenAndDistinguishExpression=function(e){var t,n=this,r=this.start,i=this.startLoc,s=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var a,o=this.start,u=this.startLoc,h=[],l=!0,p=!1,f=new c,d=this.yieldPos,g=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==W.parenR;){if(l?l=!1:n.expect(W.comma),s&&n.afterTrailingComma(W.parenR,!0)){p=!0;break}if(n.type===W.ellipsis){a=n.start,h.push(n.parseParenItem(n.parseRestBinding())),n.type===W.comma&&n.raise(n.start,"Comma is not permitted after the rest element");break}h.push(n.parseMaybeAssign(!1,f,n.parseParenItem))}var m=this.start,x=this.startLoc;if(this.expect(W.parenR),e&&!this.canInsertSemicolon()&&this.eat(W.arrow))return this.checkPatternErrors(f,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=d,this.awaitPos=g,this.parseParenArrowList(r,i,h);h.length&&!p||this.unexpected(this.lastTokStart),a&&this.unexpected(a),this.checkExpressionErrors(f,!0),this.yieldPos=d||this.yieldPos,this.awaitPos=g||this.awaitPos,h.length>1?(t=this.startNodeAt(o,u),t.expressions=h,this.finishNodeAt(t,"SequenceExpression",m,x)):t=h[0]}else t=this.parseParenExpression();if(this.options.preserveParens){var y=this.startNodeAt(r,i);return y.expression=t,this.finishNode(y,"ParenthesizedExpression")}return t},fe.parseParenItem=function(e){return e},fe.parseParenArrowList=function(e,t,n){return this.parseArrowExpression(this.startNodeAt(e,t),n)};var de=[];fe.parseNew=function(){var e=this.startNode(),t=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(W.dot)){e.meta=t;var n=this.containsEsc;return e.property=this.parseIdent(!0),("target"!==e.property.name||n)&&this.raiseRecoverable(e.property.start,"The only valid meta property for new is new.target"),this.inFunction||this.raiseRecoverable(e.start,"new.target can only be used in functions"),this.finishNode(e,"MetaProperty")}var r=this.start,i=this.startLoc;return e.callee=this.parseSubscripts(this.parseExprAtom(),r,i,!0),this.eat(W.parenL)?e.arguments=this.parseExprList(W.parenR,this.options.ecmaVersion>=8,!1):e.arguments=de,this.finishNode(e,"NewExpression")},fe.parseTemplateElement=function(e){var t=e.isTagged,n=this.startNode();return this.type===W.invalidTemplate?(t||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),n.value={raw:this.value,cooked:null}):n.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),n.tail=this.type===W.backQuote,this.finishNode(n,"TemplateElement")},fe.parseTemplate=function(e){var t=this;void 0===e&&(e={});var n=e.isTagged;void 0===n&&(n=!1);var r=this.startNode();this.next(),r.expressions=[];var i=this.parseTemplateElement({isTagged:n});for(r.quasis=[i];!i.tail;)t.expect(W.dollarBraceL),r.expressions.push(t.parseExpression()),t.expect(W.braceR),r.quasis.push(i=t.parseTemplateElement({isTagged:n}));return this.next(),this.finishNode(r,"TemplateLiteral")},fe.isAsyncProp=function(e){return!e.computed&&"Identifier"===e.key.type&&"async"===e.key.name&&(this.type===W.name||this.type===W.num||this.type===W.string||this.type===W.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===W.star)&&!H.test(this.input.slice(this.lastTokEnd,this.start))},fe.parseObj=function(e,t){var n=this,r=this.startNode(),i=!0,s={};for(r.properties=[],this.next();!this.eat(W.braceR);){if(i)i=!1;else if(n.expect(W.comma),n.afterTrailingComma(W.braceR))break;var a=n.parseProperty(e,t);e||n.checkPropClash(a,s,t),r.properties.push(a)}return this.finishNode(r,e?"ObjectPattern":"ObjectExpression")},fe.parseProperty=function(e,t){var n,r,i,s,a=this.startNode();if(this.options.ecmaVersion>=9&&this.eat(W.ellipsis))return e?(a.argument=this.parseIdent(!1),this.type===W.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(a,"RestElement")):(this.type===W.parenL&&t&&(t.parenthesizedAssign<0&&(t.parenthesizedAssign=this.start),t.parenthesizedBind<0&&(t.parenthesizedBind=this.start)),a.argument=this.parseMaybeAssign(!1,t),this.type===W.comma&&t&&t.trailingComma<0&&(t.trailingComma=this.start),this.finishNode(a,"SpreadElement"));this.options.ecmaVersion>=6&&(a.method=!1,a.shorthand=!1,(e||t)&&(i=this.start,s=this.startLoc),e||(n=this.eat(W.star)));var o=this.containsEsc;return this.parsePropertyName(a),!e&&!o&&this.options.ecmaVersion>=8&&!n&&this.isAsyncProp(a)?(r=!0,n=this.options.ecmaVersion>=9&&this.eat(W.star),this.parsePropertyName(a,t)):r=!1,this.parsePropertyValue(a,e,n,r,i,s,t,o),this.finishNode(a,"Property")},fe.parsePropertyValue=function(e,t,n,r,i,s,a,o){if((n||r)&&this.type===W.colon&&this.unexpected(),this.eat(W.colon))e.value=t?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,a),e.kind="init";else if(this.options.ecmaVersion>=6&&this.type===W.parenL)t&&this.unexpected(),e.kind="init",e.method=!0,e.value=this.parseMethod(n,r);else if(t||o||!(this.options.ecmaVersion>=5)||e.computed||"Identifier"!==e.key.type||"get"!==e.key.name&&"set"!==e.key.name||this.type==W.comma||this.type==W.braceR)this.options.ecmaVersion>=6&&!e.computed&&"Identifier"===e.key.type?(this.checkUnreserved(e.key),e.kind="init",t?e.value=this.parseMaybeDefault(i,s,e.key):this.type===W.eq&&a?(a.shorthandAssign<0&&(a.shorthandAssign=this.start),e.value=this.parseMaybeDefault(i,s,e.key)):e.value=e.key,e.shorthand=!0):this.unexpected();else{(n||r)&&this.unexpected(),e.kind=e.key.name,this.parsePropertyName(e),e.value=this.parseMethod(!1);var u="get"===e.kind?0:1;if(e.value.params.length!==u){var h=e.value.start;"get"===e.kind?this.raiseRecoverable(h,"getter should have no params"):this.raiseRecoverable(h,"setter should have exactly one param")}else"set"===e.kind&&"RestElement"===e.value.params[0].type&&this.raiseRecoverable(e.value.params[0].start,"Setter cannot use rest params")}},fe.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(W.bracketL))return e.computed=!0,e.key=this.parseMaybeAssign(),this.expect(W.bracketR),e.key;e.computed=!1}return e.key=this.type===W.num||this.type===W.string?this.parseExprAtom():this.parseIdent(!0)},fe.initFunction=function(e){e.id=null,this.options.ecmaVersion>=6&&(e.generator=!1,e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)},fe.parseMethod=function(e,t){var n=this.startNode(),r=this.inGenerator,i=this.inAsync,s=this.yieldPos,a=this.awaitPos,o=this.inFunction;return this.initFunction(n),this.options.ecmaVersion>=6&&(n.generator=e),this.options.ecmaVersion>=8&&(n.async=!!t),this.inGenerator=n.generator,this.inAsync=n.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,this.enterFunctionScope(),this.expect(W.parenL),n.params=this.parseBindingList(W.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(n,!1),this.inGenerator=r,this.inAsync=i,this.yieldPos=s,this.awaitPos=a,this.inFunction=o,this.finishNode(n,"FunctionExpression")},fe.parseArrowExpression=function(e,t,n){var r=this.inGenerator,i=this.inAsync,s=this.yieldPos,a=this.awaitPos,o=this.inFunction;return this.enterFunctionScope(),this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!n),this.inGenerator=!1,this.inAsync=e.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,e.params=this.toAssignableList(t,!0),this.parseFunctionBody(e,!0),this.inGenerator=r,this.inAsync=i,this.yieldPos=s,this.awaitPos=a,this.inFunction=o,this.finishNode(e,"ArrowFunctionExpression")},fe.parseFunctionBody=function(e,t){var n=t&&this.type!==W.braceL,r=this.strict,i=!1;if(n)e.body=this.parseMaybeAssign(),e.expression=!0,this.checkParams(e,!1);else{var s=this.options.ecmaVersion>=7&&!this.isSimpleParamList(e.params);r&&!s||(i=this.strictDirective(this.end),i&&s&&this.raiseRecoverable(e.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var a=this.labels;this.labels=[],i&&(this.strict=!0),this.checkParams(e,!r&&!i&&!t&&this.isSimpleParamList(e.params)),e.body=this.parseBlock(!1),e.expression=!1,this.adaptDirectivePrologue(e.body.body),this.labels=a}this.exitFunctionScope(),this.strict&&e.id&&this.checkLVal(e.id,"none"),this.strict=r},fe.isSimpleParamList=function(e){for(var t=0,n=e;t<n.length;t+=1){var r=n[t];if("Identifier"!==r.type)return!1}return!0},fe.checkParams=function(e,t){for(var n=this,r={},i=0,s=e.params;i<s.length;i+=1){var a=s[i];n.checkLVal(a,"var",t?null:r)}},fe.parseExprList=function(e,t,n,r){for(var i=this,s=[],a=!0;!this.eat(e);){if(a)a=!1;else if(i.expect(W.comma),t&&i.afterTrailingComma(e))break;var o=void 0;n&&i.type===W.comma?o=null:i.type===W.ellipsis?(o=i.parseSpread(r),r&&i.type===W.comma&&r.trailingComma<0&&(r.trailingComma=i.start)):o=i.parseMaybeAssign(!1,r),s.push(o)}return s},fe.checkUnreserved=function(e){var t=e.start,n=e.end,r=e.name;if(this.inGenerator&&"yield"===r&&this.raiseRecoverable(t,"Can not use 'yield' as identifier inside a generator"),this.inAsync&&"await"===r&&this.raiseRecoverable(t,"Can not use 'await' as identifier inside an async function"),this.isKeyword(r)&&this.raise(t,"Unexpected keyword '"+r+"'"),!(this.options.ecmaVersion<6&&this.input.slice(t,n).indexOf("\\")!=-1)){var i=this.strict?this.reservedWordsStrict:this.reservedWords;i.test(r)&&(this.inAsync||"await"!==r||this.raiseRecoverable(t,"Can not use keyword 'await' outside an async function"),this.raiseRecoverable(t,"The keyword '"+r+"' is reserved"))}},fe.parseIdent=function(e,t){var n=this.startNode();return e&&"never"==this.options.allowReserved&&(e=!1),this.type===W.name?n.name=this.value:this.type.keyword?(n.name=this.type.keyword,"class"!==n.name&&"function"!==n.name||this.lastTokEnd===this.lastTokStart+1&&46===this.input.charCodeAt(this.lastTokStart)||this.context.pop()):this.unexpected(),this.next(),this.finishNode(n,"Identifier"),e||this.checkUnreserved(n),n},fe.parseYield=function(){this.yieldPos||(this.yieldPos=this.start);var e=this.startNode();return this.next(),this.type==W.semi||this.canInsertSemicolon()||this.type!=W.star&&!this.type.startsExpr?(e.delegate=!1,e.argument=null):(e.delegate=this.eat(W.star),e.argument=this.parseMaybeAssign()),this.finishNode(e,"YieldExpression")},fe.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!0),this.finishNode(e,"AwaitExpression")};var ge=se.prototype;ge.raise=function(e,t){var n=u(this.input,e);t+=" ("+n.line+":"+n.column+")";var r=new SyntaxError(t);throw r.pos=e,r.loc=n,r.raisedAt=this.pos,r},ge.raiseRecoverable=ge.raise,ge.curPosition=function(){if(this.options.locations)return new te(this.curLine,this.pos-this.lineStart)};var me=se.prototype,xe=Object.assign||function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];for(var r=0,i=t;r<i.length;r+=1){var s=i[r];for(var a in s)o(s,a)&&(e[a]=s[a])}return e};me.enterFunctionScope=function(){this.scopeStack.push({"var":{},lexical:{},childVar:{},parentLexical:{}})},me.exitFunctionScope=function(){this.scopeStack.pop()},me.enterLexicalScope=function(){var e=this.scopeStack[this.scopeStack.length-1],t={"var":{},lexical:{},childVar:{},parentLexical:{}};this.scopeStack.push(t),xe(t.parentLexical,e.lexical,e.parentLexical)},me.exitLexicalScope=function(){var e=this.scopeStack.pop(),t=this.scopeStack[this.scopeStack.length-1];xe(t.childVar,e["var"],e.childVar)},me.canDeclareVarName=function(e){var t=this.scopeStack[this.scopeStack.length-1];return!o(t.lexical,e)&&!o(t.parentLexical,e)},me.canDeclareLexicalName=function(e){var t=this.scopeStack[this.scopeStack.length-1];return!o(t.lexical,e)&&!o(t["var"],e)&&!o(t.childVar,e)},me.declareVarName=function(e){this.scopeStack[this.scopeStack.length-1]["var"][e]=!0},me.declareLexicalName=function(e){this.scopeStack[this.scopeStack.length-1].lexical[e]=!0};var ye=function(e,t,n){this.type="",this.start=t,this.end=0,e.options.locations&&(this.loc=new ne(e,n)),e.options.directSourceFile&&(this.sourceFile=e.options.directSourceFile),e.options.ranges&&(this.range=[t,0])},ve=se.prototype;ve.startNode=function(){return new ye(this,this.start,this.startLoc)},ve.startNodeAt=function(e,t){return new ye(this,e,t)},ve.finishNode=function(e,t){return f.call(this,e,t,this.lastTokEnd,this.lastTokEndLoc)},ve.finishNodeAt=function(e,t,n,r){return f.call(this,e,t,n,r)};var be=function(e,t,n,r,i){this.token=e,this.isExpr=!!t,this.preserveSpace=!!n,this.override=r,this.generator=!!i},_e={b_stat:new be("{",(!1)),b_expr:new be("{",(!0)),b_tmpl:new be("${",(!1)),p_stat:new be("(",(!1)),p_expr:new be("(",(!0)),q_tmpl:new be("`",(!0),(!0),function(e){return e.tryReadTemplateToken()}),f_stat:new be("function",(!1)),f_expr:new be("function",(!0)),f_expr_gen:new be("function",(!0),(!1),null,(!0)),f_gen:new be("function",(!1),(!1),null,(!0))},Ee=se.prototype;Ee.initialContext=function(){return[_e.b_stat]},Ee.braceIsBlock=function(e){var t=this.curContext();return t===_e.f_expr||t===_e.f_stat||(e!==W.colon||t!==_e.b_stat&&t!==_e.b_expr?e===W._return||e==W.name&&this.exprAllowed?H.test(this.input.slice(this.lastTokEnd,this.start)):e===W._else||e===W.semi||e===W.eof||e===W.parenR||e==W.arrow||(e==W.braceL?t===_e.b_stat:e!=W._var&&e!=W.name&&!this.exprAllowed):!t.isExpr)},Ee.inGeneratorContext=function(){for(var e=this,t=this.context.length-1;t>=1;t--){var n=e.context[t];if("function"===n.token)return n.generator}return!1},Ee.updateContext=function(e){var t,n=this.type;n.keyword&&e==W.dot?this.exprAllowed=!1:(t=n.updateContext)?t.call(this,e):this.exprAllowed=n.beforeExpr},W.parenR.updateContext=W.braceR.updateContext=function(){if(1==this.context.length)return void(this.exprAllowed=!0);var e=this.context.pop();e===_e.b_stat&&"function"===this.curContext().token&&(e=this.context.pop()),this.exprAllowed=!e.isExpr},W.braceL.updateContext=function(e){this.context.push(this.braceIsBlock(e)?_e.b_stat:_e.b_expr),this.exprAllowed=!0},W.dollarBraceL.updateContext=function(){this.context.push(_e.b_tmpl),this.exprAllowed=!0},W.parenL.updateContext=function(e){var t=e===W._if||e===W._for||e===W._with||e===W._while;this.context.push(t?_e.p_stat:_e.p_expr),this.exprAllowed=!0},W.incDec.updateContext=function(){},W._function.updateContext=W._class.updateContext=function(e){e.beforeExpr&&e!==W.semi&&e!==W._else&&(e!==W.colon&&e!==W.braceL||this.curContext()!==_e.b_stat)?this.context.push(_e.f_expr):this.context.push(_e.f_stat),this.exprAllowed=!1},W.backQuote.updateContext=function(){this.curContext()===_e.q_tmpl?this.context.pop():this.context.push(_e.q_tmpl),this.exprAllowed=!1},W.star.updateContext=function(e){if(e==W._function){var t=this.context.length-1;this.context[t]===_e.f_expr?this.context[t]=_e.f_expr_gen:this.context[t]=_e.f_gen}this.exprAllowed=!0},W.name.updateContext=function(e){var t=!1;this.options.ecmaVersion>=6&&("of"==this.value&&!this.exprAllowed||"yield"==this.value&&this.inGeneratorContext())&&(t=!0),this.exprAllowed=t};var Te={$LONE:["ASCII","ASCII_Hex_Digit","AHex","Alphabetic","Alpha","Any","Assigned","Bidi_Control","Bidi_C","Bidi_Mirrored","Bidi_M","Case_Ignorable","CI","Cased","Changes_When_Casefolded","CWCF","Changes_When_Casemapped","CWCM","Changes_When_Lowercased","CWL","Changes_When_NFKC_Casefolded","CWKCF","Changes_When_Titlecased","CWT","Changes_When_Uppercased","CWU","Dash","Default_Ignorable_Code_Point","DI","Deprecated","Dep","Diacritic","Dia","Emoji","Emoji_Component","Emoji_Modifier","Emoji_Modifier_Base","Emoji_Presentation","Extender","Ext","Grapheme_Base","Gr_Base","Grapheme_Extend","Gr_Ext","Hex_Digit","Hex","IDS_Binary_Operator","IDSB","IDS_Trinary_Operator","IDST","ID_Continue","IDC","ID_Start","IDS","Ideographic","Ideo","Join_Control","Join_C","Logical_Order_Exception","LOE","Lowercase","Lower","Math","Noncharacter_Code_Point","NChar","Pattern_Syntax","Pat_Syn","Pattern_White_Space","Pat_WS","Quotation_Mark","QMark","Radical","Regional_Indicator","RI","Sentence_Terminal","STerm","Soft_Dotted","SD","Terminal_Punctuation","Term","Unified_Ideograph","UIdeo","Uppercase","Upper","Variation_Selector","VS","White_Space","space","XID_Continue","XIDC","XID_Start","XIDS"],General_Category:["Cased_Letter","LC","Close_Punctuation","Pe","Connector_Punctuation","Pc","Control","Cc","cntrl","Currency_Symbol","Sc","Dash_Punctuation","Pd","Decimal_Number","Nd","digit","Enclosing_Mark","Me","Final_Punctuation","Pf","Format","Cf","Initial_Punctuation","Pi","Letter","L","Letter_Number","Nl","Line_Separator","Zl","Lowercase_Letter","Ll","Mark","M","Combining_Mark","Math_Symbol","Sm","Modifier_Letter","Lm","Modifier_Symbol","Sk","Nonspacing_Mark","Mn","Number","N","Open_Punctuation","Ps","Other","C","Other_Letter","Lo","Other_Number","No","Other_Punctuation","Po","Other_Symbol","So","Paragraph_Separator","Zp","Private_Use","Co","Punctuation","P","punct","Separator","Z","Space_Separator","Zs","Spacing_Mark","Mc","Surrogate","Cs","Symbol","S","Titlecase_Letter","Lt","Unassigned","Cn","Uppercase_Letter","Lu"],Script:["Adlam","Adlm","Ahom","Anatolian_Hieroglyphs","Hluw","Arabic","Arab","Armenian","Armn","Avestan","Avst","Balinese","Bali","Bamum","Bamu","Bassa_Vah","Bass","Batak","Batk","Bengali","Beng","Bhaiksuki","Bhks","Bopomofo","Bopo","Brahmi","Brah","Braille","Brai","Buginese","Bugi","Buhid","Buhd","Canadian_Aboriginal","Cans","Carian","Cari","Caucasian_Albanian","Aghb","Chakma","Cakm","Cham","Cherokee","Cher","Common","Zyyy","Coptic","Copt","Qaac","Cuneiform","Xsux","Cypriot","Cprt","Cyrillic","Cyrl","Deseret","Dsrt","Devanagari","Deva","Duployan","Dupl","Egyptian_Hieroglyphs","Egyp","Elbasan","Elba","Ethiopic","Ethi","Georgian","Geor","Glagolitic","Glag","Gothic","Goth","Grantha","Gran","Greek","Grek","Gujarati","Gujr","Gurmukhi","Guru","Han","Hani","Hangul","Hang","Hanunoo","Hano","Hatran","Hatr","Hebrew","Hebr","Hiragana","Hira","Imperial_Aramaic","Armi","Inherited","Zinh","Qaai","Inscriptional_Pahlavi","Phli","Inscriptional_Parthian","Prti","Javanese","Java","Kaithi","Kthi","Kannada","Knda","Katakana","Kana","Kayah_Li","Kali","Kharoshthi","Khar","Khmer","Khmr","Khojki","Khoj","Khudawadi","Sind","Lao","Laoo","Latin","Latn","Lepcha","Lepc","Limbu","Limb","Linear_A","Lina","Linear_B","Linb","Lisu","Lycian","Lyci","Lydian","Lydi","Mahajani","Mahj","Malayalam","Mlym","Mandaic","Mand","Manichaean","Mani","Marchen","Marc","Masaram_Gondi","Gonm","Meetei_Mayek","Mtei","Mende_Kikakui","Mend","Meroitic_Cursive","Merc","Meroitic_Hieroglyphs","Mero","Miao","Plrd","Modi","Mongolian","Mong","Mro","Mroo","Multani","Mult","Myanmar","Mymr","Nabataean","Nbat","New_Tai_Lue","Talu","Newa","Nko","Nkoo","Nushu","Nshu","Ogham","Ogam","Ol_Chiki","Olck","Old_Hungarian","Hung","Old_Italic","Ital","Old_North_Arabian","Narb","Old_Permic","Perm","Old_Persian","Xpeo","Old_South_Arabian","Sarb","Old_Turkic","Orkh","Oriya","Orya","Osage","Osge","Osmanya","Osma","Pahawh_Hmong","Hmng","Palmyrene","Palm","Pau_Cin_Hau","Pauc","Phags_Pa","Phag","Phoenician","Phnx","Psalter_Pahlavi","Phlp","Rejang","Rjng","Runic","Runr","Samaritan","Samr","Saurashtra","Saur","Sharada","Shrd","Shavian","Shaw","Siddham","Sidd","SignWriting","Sgnw","Sinhala","Sinh","Sora_Sompeng","Sora","Soyombo","Soyo","Sundanese","Sund","Syloti_Nagri","Sylo","Syriac","Syrc","Tagalog","Tglg","Tagbanwa","Tagb","Tai_Le","Tale","Tai_Tham","Lana","Tai_Viet","Tavt","Takri","Takr","Tamil","Taml","Tangut","Tang","Telugu","Telu","Thaana","Thaa","Thai","Tibetan","Tibt","Tifinagh","Tfng","Tirhuta","Tirh","Ugaritic","Ugar","Vai","Vaii","Warang_Citi","Wara","Yi","Yiii","Zanabazar_Square","Zanb"]};Array.prototype.push.apply(Te.$LONE,Te.General_Category),Te.gc=Te.General_Category,Te.sc=Te.Script_Extensions=Te.scx=Te.Script;var Se=se.prototype,ke=function(e){this.parser=e,this.validFlags="gim"+(e.options.ecmaVersion>=6?"uy":"")+(e.options.ecmaVersion>=9?"s":""),this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};ke.prototype.reset=function(e,t,n){var r=n.indexOf("u")!==-1;this.start=0|e,this.source=t+"",this.flags=n,this.switchU=r&&this.parser.options.ecmaVersion>=6,this.switchN=r&&this.parser.options.ecmaVersion>=9},ke.prototype.raise=function(e){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+e)},ke.prototype.at=function(e){var t=this.source,n=t.length;if(e>=n)return-1;var r=t.charCodeAt(e);return!this.switchU||r<=55295||r>=57344||e+1>=n?r:(r<<10)+t.charCodeAt(e+1)-56613888},ke.prototype.nextIndex=function(e){var t=this.source,n=t.length;if(e>=n)return n;var r=t.charCodeAt(e);return!this.switchU||r<=55295||r>=57344||e+1>=n?e+1:e+2},ke.prototype.current=function(){return this.at(this.pos)},ke.prototype.lookahead=function(){return this.at(this.nextIndex(this.pos))},ke.prototype.advance=function(){this.pos=this.nextIndex(this.pos)},ke.prototype.eat=function(e){return this.current()===e&&(this.advance(),!0)},Se.validateRegExpFlags=function(e){for(var t=this,n=e.validFlags,r=e.flags,i=0;i<r.length;i++){var s=r.charAt(i);n.indexOf(s)==-1&&t.raise(e.start,"Invalid regular expression flag"),r.indexOf(s,i+1)>-1&&t.raise(e.start,"Duplicate regular expression flag")}},Se.validateRegExpPattern=function(e){this.regexp_pattern(e),!e.switchN&&this.options.ecmaVersion>=9&&e.groupNames.length>0&&(e.switchN=!0,this.regexp_pattern(e))},Se.regexp_pattern=function(e){e.pos=0,e.lastIntValue=0,e.lastStringValue="",e.lastAssertionIsQuantifiable=!1,e.numCapturingParens=0,e.maxBackReference=0,e.groupNames.length=0,e.backReferenceNames.length=0,this.regexp_disjunction(e),e.pos!==e.source.length&&(e.eat(41)&&e.raise("Unmatched ')'"),(e.eat(93)||e.eat(125))&&e.raise("Lone quantifier brackets")),e.maxBackReference>e.numCapturingParens&&e.raise("Invalid escape");for(var t=0,n=e.backReferenceNames;t<n.length;t+=1){var r=n[t];e.groupNames.indexOf(r)===-1&&e.raise("Invalid named capture referenced")}},Se.regexp_disjunction=function(e){var t=this;for(this.regexp_alternative(e);e.eat(124);)t.regexp_alternative(e);this.regexp_eatQuantifier(e,!0)&&e.raise("Nothing to repeat"),e.eat(123)&&e.raise("Lone quantifier brackets")},Se.regexp_alternative=function(e){for(;e.pos<e.source.length&&this.regexp_eatTerm(e););},Se.regexp_eatTerm=function(e){return this.regexp_eatAssertion(e)?(e.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(e)&&e.switchU&&e.raise("Invalid quantifier"),!0):!(e.switchU?!this.regexp_eatAtom(e):!this.regexp_eatExtendedAtom(e))&&(this.regexp_eatQuantifier(e),!0)},Se.regexp_eatAssertion=function(e){var t=e.pos;if(e.lastAssertionIsQuantifiable=!1,e.eat(94)||e.eat(36))return!0;if(e.eat(92)){if(e.eat(66)||e.eat(98))return!0;e.pos=t}if(e.eat(40)&&e.eat(63)){var n=!1;if(this.options.ecmaVersion>=9&&(n=e.eat(60)),e.eat(61)||e.eat(33))return this.regexp_disjunction(e),e.eat(41)||e.raise("Unterminated group"),e.lastAssertionIsQuantifiable=!n,!0}return e.pos=t,!1},Se.regexp_eatQuantifier=function(e,t){return void 0===t&&(t=!1),!!this.regexp_eatQuantifierPrefix(e,t)&&(e.eat(63),!0)},Se.regexp_eatQuantifierPrefix=function(e,t){return e.eat(42)||e.eat(43)||e.eat(63)||this.regexp_eatBracedQuantifier(e,t)},Se.regexp_eatBracedQuantifier=function(e,t){var n=e.pos;if(e.eat(123)){var r=0,i=-1;
if(this.regexp_eatDecimalDigits(e)&&(r=e.lastIntValue,e.eat(44)&&this.regexp_eatDecimalDigits(e)&&(i=e.lastIntValue),e.eat(125)))return i!==-1&&i<r&&!t&&e.raise("numbers out of order in {} quantifier"),!0;e.switchU&&!t&&e.raise("Incomplete quantifier"),e.pos=n}return!1},Se.regexp_eatAtom=function(e){return this.regexp_eatPatternCharacters(e)||e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)},Se.regexp_eatReverseSolidusAtomEscape=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatAtomEscape(e))return!0;e.pos=t}return!1},Se.regexp_eatUncapturingGroup=function(e){var t=e.pos;if(e.eat(40)){if(e.eat(63)&&e.eat(58)){if(this.regexp_disjunction(e),e.eat(41))return!0;e.raise("Unterminated group")}e.pos=t}return!1},Se.regexp_eatCapturingGroup=function(e){if(e.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(e):63===e.current()&&e.raise("Invalid group"),this.regexp_disjunction(e),e.eat(41))return e.numCapturingParens+=1,!0;e.raise("Unterminated group")}return!1},Se.regexp_eatExtendedAtom=function(e){return e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)||this.regexp_eatInvalidBracedQuantifier(e)||this.regexp_eatExtendedPatternCharacter(e)},Se.regexp_eatInvalidBracedQuantifier=function(e){return this.regexp_eatBracedQuantifier(e,!0)&&e.raise("Nothing to repeat"),!1},Se.regexp_eatSyntaxCharacter=function(e){var t=e.current();return!!g(t)&&(e.lastIntValue=t,e.advance(),!0)},Se.regexp_eatPatternCharacters=function(e){for(var t=e.pos,n=0;(n=e.current())!==-1&&!g(n);)e.advance();return e.pos!==t},Se.regexp_eatExtendedPatternCharacter=function(e){var t=e.current();return!(t===-1||36===t||t>=40&&t<=43||46===t||63===t||91===t||94===t||124===t)&&(e.advance(),!0)},Se.regexp_groupSpecifier=function(e){if(e.eat(63)){if(this.regexp_eatGroupName(e))return e.groupNames.indexOf(e.lastStringValue)!==-1&&e.raise("Duplicate capture group name"),void e.groupNames.push(e.lastStringValue);e.raise("Invalid group")}},Se.regexp_eatGroupName=function(e){if(e.lastStringValue="",e.eat(60)){if(this.regexp_eatRegExpIdentifierName(e)&&e.eat(62))return!0;e.raise("Invalid capture group name")}return!1},Se.regexp_eatRegExpIdentifierName=function(e){if(e.lastStringValue="",this.regexp_eatRegExpIdentifierStart(e)){for(e.lastStringValue+=d(e.lastIntValue);this.regexp_eatRegExpIdentifierPart(e);)e.lastStringValue+=d(e.lastIntValue);return!0}return!1},Se.regexp_eatRegExpIdentifierStart=function(e){var t=e.pos,n=e.current();return e.advance(),92===n&&this.regexp_eatRegExpUnicodeEscapeSequence(e)&&(n=e.lastIntValue),m(n)?(e.lastIntValue=n,!0):(e.pos=t,!1)},Se.regexp_eatRegExpIdentifierPart=function(e){var t=e.pos,n=e.current();return e.advance(),92===n&&this.regexp_eatRegExpUnicodeEscapeSequence(e)&&(n=e.lastIntValue),x(n)?(e.lastIntValue=n,!0):(e.pos=t,!1)},Se.regexp_eatAtomEscape=function(e){return!!(this.regexp_eatBackReference(e)||this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)||e.switchN&&this.regexp_eatKGroupName(e))||(e.switchU&&(99===e.current()&&e.raise("Invalid unicode escape"),e.raise("Invalid escape")),!1)},Se.regexp_eatBackReference=function(e){var t=e.pos;if(this.regexp_eatDecimalEscape(e)){var n=e.lastIntValue;if(e.switchU)return n>e.maxBackReference&&(e.maxBackReference=n),!0;if(n<=e.numCapturingParens)return!0;e.pos=t}return!1},Se.regexp_eatKGroupName=function(e){if(e.eat(107)){if(this.regexp_eatGroupName(e))return e.backReferenceNames.push(e.lastStringValue),!0;e.raise("Invalid named reference")}return!1},Se.regexp_eatCharacterEscape=function(e){return this.regexp_eatControlEscape(e)||this.regexp_eatCControlLetter(e)||this.regexp_eatZero(e)||this.regexp_eatHexEscapeSequence(e)||this.regexp_eatRegExpUnicodeEscapeSequence(e)||!e.switchU&&this.regexp_eatLegacyOctalEscapeSequence(e)||this.regexp_eatIdentityEscape(e)},Se.regexp_eatCControlLetter=function(e){var t=e.pos;if(e.eat(99)){if(this.regexp_eatControlLetter(e))return!0;e.pos=t}return!1},Se.regexp_eatZero=function(e){return 48===e.current()&&!T(e.lookahead())&&(e.lastIntValue=0,e.advance(),!0)},Se.regexp_eatControlEscape=function(e){var t=e.current();return 116===t?(e.lastIntValue=9,e.advance(),!0):110===t?(e.lastIntValue=10,e.advance(),!0):118===t?(e.lastIntValue=11,e.advance(),!0):102===t?(e.lastIntValue=12,e.advance(),!0):114===t&&(e.lastIntValue=13,e.advance(),!0)},Se.regexp_eatControlLetter=function(e){var t=e.current();return!!y(t)&&(e.lastIntValue=t%32,e.advance(),!0)},Se.regexp_eatRegExpUnicodeEscapeSequence=function(e){var t=e.pos;if(e.eat(117)){if(this.regexp_eatFixedHexDigits(e,4)){var n=e.lastIntValue;if(e.switchU&&n>=55296&&n<=56319){var r=e.pos;if(e.eat(92)&&e.eat(117)&&this.regexp_eatFixedHexDigits(e,4)){var i=e.lastIntValue;if(i>=56320&&i<=57343)return e.lastIntValue=1024*(n-55296)+(i-56320)+65536,!0}e.pos=r,e.lastIntValue=n}return!0}if(e.switchU&&e.eat(123)&&this.regexp_eatHexDigits(e)&&e.eat(125)&&v(e.lastIntValue))return!0;e.switchU&&e.raise("Invalid unicode escape"),e.pos=t}return!1},Se.regexp_eatIdentityEscape=function(e){if(e.switchU)return!!this.regexp_eatSyntaxCharacter(e)||!!e.eat(47)&&(e.lastIntValue=47,!0);var t=e.current();return!(99===t||e.switchN&&107===t)&&(e.lastIntValue=t,e.advance(),!0)},Se.regexp_eatDecimalEscape=function(e){e.lastIntValue=0;var t=e.current();if(t>=49&&t<=57){do e.lastIntValue=10*e.lastIntValue+(t-48),e.advance();while((t=e.current())>=48&&t<=57);return!0}return!1},Se.regexp_eatCharacterClassEscape=function(e){var t=e.current();if(b(t))return e.lastIntValue=-1,e.advance(),!0;if(e.switchU&&this.options.ecmaVersion>=9&&(80===t||112===t)){if(e.lastIntValue=-1,e.advance(),e.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(e)&&e.eat(125))return!0;e.raise("Invalid property name")}return!1},Se.regexp_eatUnicodePropertyValueExpression=function(e){var t=e.pos;if(this.regexp_eatUnicodePropertyName(e)&&e.eat(61)){var n=e.lastStringValue;if(this.regexp_eatUnicodePropertyValue(e)){var r=e.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(e,n,r),!0}}if(e.pos=t,this.regexp_eatLoneUnicodePropertyNameOrValue(e)){var i=e.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(e,i),!0}return!1},Se.regexp_validateUnicodePropertyNameAndValue=function(e,t,n){Te.hasOwnProperty(t)&&Te[t].indexOf(n)!==-1||e.raise("Invalid property name")},Se.regexp_validateUnicodePropertyNameOrValue=function(e,t){Te.$LONE.indexOf(t)===-1&&e.raise("Invalid property name")},Se.regexp_eatUnicodePropertyName=function(e){var t=0;for(e.lastStringValue="";_(t=e.current());)e.lastStringValue+=d(t),e.advance();return""!==e.lastStringValue},Se.regexp_eatUnicodePropertyValue=function(e){var t=0;for(e.lastStringValue="";E(t=e.current());)e.lastStringValue+=d(t),e.advance();return""!==e.lastStringValue},Se.regexp_eatLoneUnicodePropertyNameOrValue=function(e){return this.regexp_eatUnicodePropertyValue(e)},Se.regexp_eatCharacterClass=function(e){if(e.eat(91)){if(e.eat(94),this.regexp_classRanges(e),e.eat(93))return!0;e.raise("Unterminated character class")}return!1},Se.regexp_classRanges=function(e){for(var t=this;this.regexp_eatClassAtom(e);){var n=e.lastIntValue;if(e.eat(45)&&t.regexp_eatClassAtom(e)){var r=e.lastIntValue;!e.switchU||n!==-1&&r!==-1||e.raise("Invalid character class"),n!==-1&&r!==-1&&n>r&&e.raise("Range out of order in character class")}}},Se.regexp_eatClassAtom=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatClassEscape(e))return!0;if(e.switchU){var n=e.current();(99===n||w(n))&&e.raise("Invalid class escape"),e.raise("Invalid escape")}e.pos=t}var r=e.current();return 93!==r&&(e.lastIntValue=r,e.advance(),!0)},Se.regexp_eatClassEscape=function(e){var t=e.pos;if(e.eat(98))return e.lastIntValue=8,!0;if(e.switchU&&e.eat(45))return e.lastIntValue=45,!0;if(!e.switchU&&e.eat(99)){if(this.regexp_eatClassControlLetter(e))return!0;e.pos=t}return this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)},Se.regexp_eatClassControlLetter=function(e){var t=e.current();return!(!T(t)&&95!==t)&&(e.lastIntValue=t%32,e.advance(),!0)},Se.regexp_eatHexEscapeSequence=function(e){var t=e.pos;if(e.eat(120)){if(this.regexp_eatFixedHexDigits(e,2))return!0;e.switchU&&e.raise("Invalid escape"),e.pos=t}return!1},Se.regexp_eatDecimalDigits=function(e){var t=e.pos,n=0;for(e.lastIntValue=0;T(n=e.current());)e.lastIntValue=10*e.lastIntValue+(n-48),e.advance();return e.pos!==t},Se.regexp_eatHexDigits=function(e){var t=e.pos,n=0;for(e.lastIntValue=0;S(n=e.current());)e.lastIntValue=16*e.lastIntValue+k(n),e.advance();return e.pos!==t},Se.regexp_eatLegacyOctalEscapeSequence=function(e){if(this.regexp_eatOctalDigit(e)){var t=e.lastIntValue;if(this.regexp_eatOctalDigit(e)){var n=e.lastIntValue;t<=3&&this.regexp_eatOctalDigit(e)?e.lastIntValue=64*t+8*n+e.lastIntValue:e.lastIntValue=8*t+n}else e.lastIntValue=t;return!0}return!1},Se.regexp_eatOctalDigit=function(e){var t=e.current();return w(t)?(e.lastIntValue=t-48,e.advance(),!0):(e.lastIntValue=0,!1)},Se.regexp_eatFixedHexDigits=function(e,t){var n=e.pos;e.lastIntValue=0;for(var r=0;r<t;++r){var i=e.current();if(!S(i))return e.pos=n,!1;e.lastIntValue=16*e.lastIntValue+k(i),e.advance()}return!0};var we=function(e){this.type=e.type,this.value=e.value,this.start=e.start,this.end=e.end,e.options.locations&&(this.loc=new ne(e,e.startLoc,e.endLoc)),e.options.ranges&&(this.range=[e.start,e.end])},Ae=se.prototype;Ae.next=function(){this.options.onToken&&this.options.onToken(new we(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Ae.getToken=function(){return this.next(),new we(this)},"undefined"!=typeof Symbol&&(Ae[Symbol.iterator]=function(){var e=this;return{next:function(){var t=e.getToken();return{done:t.type===W.eof,value:t}}}}),Ae.curContext=function(){return this.context[this.context.length-1]},Ae.nextToken=function(){var e=this.curContext();return e&&e.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(W.eof):e.override?e.override(this):void this.readToken(this.fullCharCodeAtPos())},Ae.readToken=function(e){return n(e,this.options.ecmaVersion>=6)||92===e?this.readWord():this.getTokenFromCode(e)},Ae.fullCharCodeAtPos=function(){var e=this.input.charCodeAt(this.pos);if(e<=55295||e>=57344)return e;var t=this.input.charCodeAt(this.pos+1);return(e<<10)+t-56613888},Ae.skipBlockComment=function(){var e=this,t=this.options.onComment&&this.curPosition(),n=this.pos,r=this.input.indexOf("*/",this.pos+=2);if(r===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=r+2,this.options.locations){q.lastIndex=n;for(var i;(i=q.exec(this.input))&&i.index<this.pos;)++e.curLine,e.lineStart=i.index+i[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(n+2,r),n,this.pos,t,this.curPosition())},Ae.skipLineComment=function(e){for(var t=this,n=this.pos,r=this.options.onComment&&this.curPosition(),i=this.input.charCodeAt(this.pos+=e);this.pos<this.input.length&&!a(i);)i=t.input.charCodeAt(++t.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(n+e,this.pos),n,this.pos,r,this.curPosition())},Ae.skipSpace=function(){var e=this;e:for(;this.pos<this.input.length;){var t=e.input.charCodeAt(e.pos);switch(t){case 32:case 160:++e.pos;break;case 13:10===e.input.charCodeAt(e.pos+1)&&++e.pos;case 10:case 8232:case 8233:++e.pos,e.options.locations&&(++e.curLine,e.lineStart=e.pos);break;case 47:switch(e.input.charCodeAt(e.pos+1)){case 42:e.skipBlockComment();break;case 47:e.skipLineComment(2);break;default:break e}break;default:if(!(t>8&&t<14||t>=5760&&Y.test(String.fromCharCode(t))))break e;++e.pos}}},Ae.finishToken=function(e,t){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var n=this.type;this.type=e,this.value=t,this.updateContext(n)},Ae.readToken_dot=function(){var e=this.input.charCodeAt(this.pos+1);if(e>=48&&e<=57)return this.readNumber(!0);var t=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===e&&46===t?(this.pos+=3,this.finishToken(W.ellipsis)):(++this.pos,this.finishToken(W.dot))},Ae.readToken_slash=function(){var e=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===e?this.finishOp(W.assign,2):this.finishOp(W.slash,1)},Ae.readToken_mult_modulo_exp=function(e){var t=this.input.charCodeAt(this.pos+1),n=1,r=42===e?W.star:W.modulo;return this.options.ecmaVersion>=7&&42==e&&42===t&&(++n,r=W.starstar,t=this.input.charCodeAt(this.pos+2)),61===t?this.finishOp(W.assign,n+1):this.finishOp(r,n)},Ae.readToken_pipe_amp=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?this.finishOp(124===e?W.logicalOR:W.logicalAND,2):61===t?this.finishOp(W.assign,2):this.finishOp(124===e?W.bitwiseOR:W.bitwiseAND,1)},Ae.readToken_caret=function(){var e=this.input.charCodeAt(this.pos+1);return 61===e?this.finishOp(W.assign,2):this.finishOp(W.bitwiseXOR,1)},Ae.readToken_plus_min=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?45!=t||this.inModule||62!=this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!H.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(W.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===t?this.finishOp(W.assign,2):this.finishOp(W.plusMin,1)},Ae.readToken_lt_gt=function(e){var t=this.input.charCodeAt(this.pos+1),n=1;return t===e?(n=62===e&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+n)?this.finishOp(W.assign,n+1):this.finishOp(W.bitShift,n)):33!=t||60!=e||this.inModule||45!=this.input.charCodeAt(this.pos+2)||45!=this.input.charCodeAt(this.pos+3)?(61===t&&(n=2),this.finishOp(W.relational,n)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},Ae.readToken_eq_excl=function(e){var t=this.input.charCodeAt(this.pos+1);return 61===t?this.finishOp(W.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===e&&62===t&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(W.arrow)):this.finishOp(61===e?W.eq:W.prefix,1)},Ae.getTokenFromCode=function(e){switch(e){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(W.parenL);case 41:return++this.pos,this.finishToken(W.parenR);case 59:return++this.pos,this.finishToken(W.semi);case 44:return++this.pos,this.finishToken(W.comma);case 91:return++this.pos,this.finishToken(W.bracketL);case 93:return++this.pos,this.finishToken(W.bracketR);case 123:return++this.pos,this.finishToken(W.braceL);case 125:return++this.pos,this.finishToken(W.braceR);case 58:return++this.pos,this.finishToken(W.colon);case 63:return++this.pos,this.finishToken(W.question);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(W.backQuote);case 48:var t=this.input.charCodeAt(this.pos+1);if(120===t||88===t)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===t||79===t)return this.readRadixNumber(8);if(98===t||66===t)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(e);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(e);case 124:case 38:return this.readToken_pipe_amp(e);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(e);case 60:case 62:return this.readToken_lt_gt(e);case 61:case 33:return this.readToken_eq_excl(e);case 126:return this.finishOp(W.prefix,1)}this.raise(this.pos,"Unexpected character '"+A(e)+"'")},Ae.finishOp=function(e,t){var n=this.input.slice(this.pos,this.pos+t);return this.pos+=t,this.finishToken(e,n)},Ae.readRegexp=function(){for(var e,t,n=this,r=this.pos;;){n.pos>=n.input.length&&n.raise(r,"Unterminated regular expression");var i=n.input.charAt(n.pos);if(H.test(i)&&n.raise(r,"Unterminated regular expression"),e)e=!1;else{if("["===i)t=!0;else if("]"===i&&t)t=!1;else if("/"===i&&!t)break;e="\\"===i}++n.pos}var s=this.input.slice(r,this.pos);++this.pos;var a=this.pos,o=this.readWord1();this.containsEsc&&this.unexpected(a);var u=this.regexpState||(this.regexpState=new ke(this));u.reset(r,s,o),this.validateRegExpFlags(u),this.validateRegExpPattern(u);var h=null;try{h=new RegExp(s,o)}catch(l){}return this.finishToken(W.regexp,{pattern:s,flags:o,value:h})},Ae.readInt=function(e,t){for(var n=this,r=this.pos,i=0,s=0,a=null==t?1/0:t;s<a;++s){var o=n.input.charCodeAt(n.pos),u=void 0;if(u=o>=97?o-97+10:o>=65?o-65+10:o>=48&&o<=57?o-48:1/0,u>=e)break;++n.pos,i=i*e+u}return this.pos===r||null!=t&&this.pos-r!==t?null:i},Ae.readRadixNumber=function(e){this.pos+=2;var t=this.readInt(e);return null==t&&this.raise(this.start+2,"Expected number in radix "+e),n(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(W.num,t)},Ae.readNumber=function(e){var t=this.pos;e||null!==this.readInt(10)||this.raise(t,"Invalid number");var r=this.pos-t>=2&&48===this.input.charCodeAt(t);r&&this.strict&&this.raise(t,"Invalid number"),r&&/[89]/.test(this.input.slice(t,this.pos))&&(r=!1);var i=this.input.charCodeAt(this.pos);46!==i||r||(++this.pos,this.readInt(10),i=this.input.charCodeAt(this.pos)),69!==i&&101!==i||r||(i=this.input.charCodeAt(++this.pos),43!==i&&45!==i||++this.pos,null===this.readInt(10)&&this.raise(t,"Invalid number")),n(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var s=this.input.slice(t,this.pos),a=r?parseInt(s,8):parseFloat(s);return this.finishToken(W.num,a)},Ae.readCodePoint=function(){var e,t=this.input.charCodeAt(this.pos);if(123===t){this.options.ecmaVersion<6&&this.unexpected();var n=++this.pos;e=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,e>1114111&&this.invalidStringToken(n,"Code point out of bounds")}else e=this.readHexChar(4);return e},Ae.readString=function(e){for(var t=this,n="",r=++this.pos;;){t.pos>=t.input.length&&t.raise(t.start,"Unterminated string constant");var i=t.input.charCodeAt(t.pos);if(i===e)break;92===i?(n+=t.input.slice(r,t.pos),n+=t.readEscapedChar(!1),r=t.pos):(a(i)&&t.raise(t.start,"Unterminated string constant"),++t.pos)}return n+=this.input.slice(r,this.pos++),this.finishToken(W.string,n)};var Oe={};Ae.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(e){if(e!==Oe)throw e;this.readInvalidTemplateToken()}this.inTemplateElement=!1},Ae.invalidStringToken=function(e,t){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Oe;this.raise(e,t)},Ae.readTmplToken=function(){for(var e=this,t="",n=this.pos;;){e.pos>=e.input.length&&e.raise(e.start,"Unterminated template");var r=e.input.charCodeAt(e.pos);if(96===r||36===r&&123===e.input.charCodeAt(e.pos+1))return e.pos!==e.start||e.type!==W.template&&e.type!==W.invalidTemplate?(t+=e.input.slice(n,e.pos),e.finishToken(W.template,t)):36===r?(e.pos+=2,e.finishToken(W.dollarBraceL)):(++e.pos,e.finishToken(W.backQuote));if(92===r)t+=e.input.slice(n,e.pos),t+=e.readEscapedChar(!0),n=e.pos;else if(a(r)){switch(t+=e.input.slice(n,e.pos),++e.pos,r){case 13:10===e.input.charCodeAt(e.pos)&&++e.pos;case 10:t+="\n";break;default:t+=String.fromCharCode(r)}e.options.locations&&(++e.curLine,e.lineStart=e.pos),n=e.pos}else++e.pos}},Ae.readInvalidTemplateToken=function(){for(var e=this;this.pos<this.input.length;this.pos++)switch(e.input[e.pos]){case"\\":++e.pos;break;case"$":if("{"!==e.input[e.pos+1])break;case"`":return e.finishToken(W.invalidTemplate,e.input.slice(e.start,e.pos))}this.raise(this.start,"Unterminated template")},Ae.readEscapedChar=function(e){var t=this.input.charCodeAt(++this.pos);switch(++this.pos,t){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return A(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\x0B";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";default:if(t>=48&&t<=55){var n=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],r=parseInt(n,8);return r>255&&(n=n.slice(0,-1),r=parseInt(n,8)),this.pos+=n.length-1,t=this.input.charCodeAt(this.pos),"0"===n&&56!=t&&57!=t||!this.strict&&!e||this.invalidStringToken(this.pos-1-n.length,"Octal literal in strict mode"),String.fromCharCode(r)}return String.fromCharCode(t)}},Ae.readHexChar=function(e){var t=this.pos,n=this.readInt(16,e);return null===n&&this.invalidStringToken(t,"Bad character escape sequence"),n},Ae.readWord1=function(){var e=this;this.containsEsc=!1;for(var t="",i=!0,s=this.pos,a=this.options.ecmaVersion>=6;this.pos<this.input.length;){var o=e.fullCharCodeAtPos();if(r(o,a))e.pos+=o<=65535?1:2;else{if(92!==o)break;e.containsEsc=!0,t+=e.input.slice(s,e.pos);var u=e.pos;117!=e.input.charCodeAt(++e.pos)&&e.invalidStringToken(e.pos,"Expecting Unicode escape sequence \\uXXXX"),++e.pos;var h=e.readCodePoint();(i?n:r)(h,a)||e.invalidStringToken(u,"Invalid Unicode escape"),t+=A(h),s=e.pos}i=!1}return t+this.input.slice(s,this.pos)},Ae.readWord=function(){var e=this.readWord1(),t=W.name;return this.keywords.test(e)&&(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+e),t=X[e]),this.finishToken(t,e)};var Ce="5.5.0";e.version=Ce,e.parse=O,e.parseExpressionAt=C,e.tokenizer=R,e.addLooseExports=P,e.Parser=se,e.plugins=ie,e.defaultOptions=re,e.Position=te,e.SourceLocation=ne,e.getLineInfo=u,e.Node=ye,e.TokenType=j,e.tokTypes=W,e.keywordTypes=X,e.TokContext=be,e.tokContexts=_e,e.isIdentifierChar=r,e.isIdentifierStart=n,e.Token=we,e.isNewLine=a,e.lineBreak=H,e.lineBreakG=q,e.nonASCIIwhitespace=Y,Object.defineProperty(e,"__esModule",{value:!0})})},{}]},{},[33]);